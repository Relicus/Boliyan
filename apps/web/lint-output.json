[{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\e2e\\image-audit.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\playwright.local.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\scripts\\index-features.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\scripts\\validate-features.js","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":17,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":17,"endColumn":25,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":18,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":18,"endColumn":29,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'execSync' is assigned a value but never used.","line":19,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":17,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":19,"column":22,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":19,"endColumn":46,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\(auth)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\(auth)\\signin\\SignInClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\(auth)\\signin\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\(auth)\\signup\\SignUpClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\(auth)\\signup\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\auth\\callback\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\categories\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\dashboard\\DashboardClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CategoryBadge' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ConditionBadge' is defined but never used.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TimerBadge' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trash2' is defined but never used.","line":12,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Edit' is defined but never used.","line":12,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":12,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used.","line":12,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MessageSquare' is defined but never used.","line":12,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Package' is defined but never used.","line":12,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":64},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'calculatePrivacySafeDistance' is defined but never used.","line":21,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'involvedIds' is assigned a value but never used.","line":28,"column":62,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":73},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTimeLeft' is assigned a value but never used.","line":92,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":92,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useApp } from \"@/lib/store\";\nimport { CategoryBadge } from \"@/components/common/CategoryBadge\";\nimport { ConditionBadge } from \"@/components/common/ConditionBadge\";\nimport { TimerBadge } from \"@/components/common/TimerBadge\";\nimport SellerListingCard from \"@/components/seller/SellerListingCard\";\nimport MyBidCard from \"@/components/dashboard/MyBidCard\";\nimport WatchedItemCard from \"@/components/dashboard/WatchedItemCard\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Trash2, Edit, Clock, Eye, MessageSquare, Package, Bookmark, Gavel, Tag } from \"lucide-react\";\nimport ProductDetailsModal from \"@/components/marketplace/ProductDetailsModal\";\nimport Link from \"next/link\";\nimport { Button } from \"@/components/ui/button\";\nimport { useState, useEffect } from \"react\";\nimport { Suspense } from \"react\";\nimport { useSearchParams, useRouter } from \"next/navigation\";\nimport DeleteConfirmationDialog from \"@/components/seller/DeleteConfirmationDialog\";\nimport { Item } from \"@/types\";\nimport { calculatePrivacySafeDistance } from \"@/lib/utils\";\nimport { transformListingToItem, ListingWithSeller } from \"@/lib/transform\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { supabase } from \"@/lib/supabase\";\nimport { useTime } from \"@/context/TimeContext\";\n\nfunction DashboardContent() {\n  const { itemsById, bids, user, deleteItem, watchedItemIds, involvedIds } = useApp();\n  const [myItems, setMyItems] = useState<Item[]>([]);\n  \n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const initialTab = searchParams.get(\"tab\") || \"active-bids\";\n  const [activeTab, setActiveTab] = useState(initialTab);\n  const [itemToDelete, setItemToDelete] = useState<Item | null>(null);\n  const [viewingItem, setViewingItem] = useState<Item | null>(null);\n  \n  const time = useTime();\n  const [now, setNow] = useState<number | null>(null);\n\n  useEffect(() => {\n    setActiveTab(initialTab);\n  }, [initialTab]);\n\n  const handleTabChange = (value: string) => {\n    setActiveTab(value);\n    router.push(`/dashboard?tab=${value}`, { scroll: false });\n  };\n\n  // Sync with shared timer\n  useEffect(() => {\n    setNow(time.now);\n  }, [time.now]);\n\n  // Fetch My Listings independently of the discovery feed\n  useEffect(() => {\n    if (!user) return;\n\n    const fetchMyItems = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('marketplace_listings')\n          .select('*')\n          .eq('seller_id', user.id);\n\n        if (error) throw error;\n        if (data) {\n          const transformed = data.map(row => transformListingToItem(row as unknown as ListingWithSeller));\n          setMyItems(transformed);\n        }\n      } catch (err) {\n        console.error(\"Error fetching my listings:\", err);\n      }\n    };\n\n    fetchMyItems();\n  }, [user]);\n\n  const handleDeleteClick = (item: Item) => {\n    setItemToDelete(item);\n  };\n\n  const confirmDelete = async () => {\n    if (itemToDelete) {\n      await deleteItem(itemToDelete.id);\n      setItemToDelete(null);\n      // Remove locally\n      setMyItems(prev => prev.filter(i => i.id !== itemToDelete.id));\n    }\n  };\n\n  const getTimeLeft = (expiryAt: string) => {\n    if (!now) return \"Loading...\";\n    const diff = new Date(expiryAt).getTime() - now;\n    const hours = Math.max(0, Math.floor(diff / 3600000));\n    const mins = Math.max(0, Math.floor((diff % 3600000) / 60000));\n    \n    if (hours >= 24) return `${Math.floor(hours / 24)}d ${hours % 24}h`;\n    return `${hours}h ${mins}m`;\n  };\n\n  const myBids = bids.filter(b => b.bidderId === user?.id);\n  const watchedItems = watchedItemIds\n    .map(id => itemsById[id])\n    .filter(Boolean); // Only show items we have data for\n\n  return (\n    <div className=\"flex flex-col gap-6 p-4 md:p-6 max-w-7xl mx-auto w-full\">\n      \n      {/* Header with Add Button */}\n      <div className=\"flex items-center justify-between\">\n         <h1 className=\"text-3xl font-black font-outfit text-slate-900 tracking-tight\">Dashboard</h1>\n         <Link href=\"/sell\">\n            <Button className=\"font-bold gap-1.5 shadow-lg shadow-blue-500/20 hover:shadow-blue-500/30 transition-all\">\n                <Plus className=\"w-4 h-4\" />\n                Sell Item\n            </Button>\n         </Link>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={handleTabChange} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-3 mb-6 bg-slate-100 p-1 rounded-xl\">\n          <TabsTrigger value=\"active-bids\" className=\"rounded-lg font-bold data-[state=active]:bg-white data-[state=active]:shadow-sm\">\n             My Bids\n             {myBids.length > 0 && (\n                <Badge variant=\"secondary\" className=\"ml-2 bg-slate-200 text-slate-700 hover:bg-slate-300 h-5 px-1.5\">{myBids.length}</Badge>\n             )}\n          </TabsTrigger>\n          <TabsTrigger value=\"listings\" className=\"rounded-lg font-bold data-[state=active]:bg-white data-[state=active]:shadow-sm\">\n             My Listings\n             {myItems.length > 0 && (\n                <Badge variant=\"secondary\" className=\"ml-2 bg-slate-200 text-slate-700 hover:bg-slate-300 h-5 px-1.5\">{myItems.length}</Badge>\n             )}\n          </TabsTrigger>\n          <TabsTrigger value=\"watchlist\" className=\"rounded-lg font-bold data-[state=active]:bg-white data-[state=active]:shadow-sm\">\n             Watchlist\n             {watchedItems.length > 0 && (\n                <Badge variant=\"secondary\" className=\"ml-2 bg-slate-200 text-slate-700 hover:bg-slate-300 h-5 px-1.5\">{watchedItems.length}</Badge>\n             )}\n          </TabsTrigger>\n        </TabsList>\n\n        <AnimatePresence mode=\"wait\">\n             {/* 1. MY BIDS TAB */}\n             {activeTab === 'active-bids' && (\n                <motion.div\n                    key=\"active-bids\"\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -10 }}\n                    transition={{ duration: 0.2 }}\n                    className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2\"\n                >\n                    {myBids.length === 0 ? (\n                        <div className=\"col-span-full flex flex-col items-center justify-center py-12 text-center text-slate-500 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200\">\n                            <Gavel className=\"w-12 h-12 text-slate-300 mb-3\" />\n                            <h3 className=\"text-lg font-bold text-slate-700\">No active bids</h3>\n                            <p className=\"max-w-xs mx-auto mb-4\">You haven't placed any bids yet. Explore the marketplace to find deals!</p>\n                            <Link href=\"/\">\n                                <Button variant=\"outline\">Explore Marketplace</Button>\n                            </Link>\n                        </div>\n                    ) : (\n                        myBids.map(bid => {\n                            const item = itemsById[bid.itemId];\n                            // If we don't have the item in memory (e.g. not in feed), we might need to fetch it\n                            // For now, assume feed/involvedIds covers it. \n                            // TODO: Add separate involved items fetcher in context if missing.\n                            if (!item) return null; \n\n                            return (\n                                <MyBidCard \n                                    key={bid.id} \n                                    item={item} \n                                    userBid={bid} \n                                    seller={item.seller!} \n                                />\n                            );\n                        })\n                    )}\n                </motion.div>\n             )}\n\n             {/* 2. MY LISTINGS TAB */}\n             {activeTab === 'listings' && (\n                <motion.div\n                    key=\"listings\"\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -10 }}\n                    transition={{ duration: 0.2 }}\n                    className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2\"\n                >\n                    {myItems.length === 0 ? (\n                        <div className=\"col-span-full flex flex-col items-center justify-center py-12 text-center text-slate-500 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200\">\n                            <Tag className=\"w-12 h-12 text-slate-300 mb-3\" />\n                            <h3 className=\"text-lg font-bold text-slate-700\">No active listings</h3>\n                            <p className=\"max-w-xs mx-auto mb-4\">You aren't selling anything yet. Turn your unused items into cash!</p>\n                            <Link href=\"/sell\">\n                                <Button>Create Listing</Button>\n                            </Link>\n                        </div>\n                    ) : (\n                        myItems.map(item => (\n                            <SellerListingCard\n                                key={item.id}\n                                item={item}\n                                onView={() => setViewingItem(item)}\n                                onDelete={() => handleDeleteClick(item)}\n                            />\n                        ))\n                    )}\n                </motion.div>\n             )}\n\n             {/* 3. WATCHLIST TAB */}\n             {activeTab === 'watchlist' && (\n                <motion.div\n                    key=\"watchlist\"\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -10 }}\n                    transition={{ duration: 0.2 }}\n                    className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2\"\n                >\n                     {watchedItems.length === 0 ? (\n                        <div className=\"col-span-full flex flex-col items-center justify-center py-12 text-center text-slate-500 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200\">\n                            <Bookmark className=\"w-12 h-12 text-slate-300 mb-3\" />\n                            <h3 className=\"text-lg font-bold text-slate-700\">Watchlist is empty</h3>\n                            <p className=\"max-w-xs mx-auto mb-4\">Save items you're interested in to track their price and status.</p>\n                            <Link href=\"/\">\n                                <Button variant=\"outline\">Browse Items</Button>\n                            </Link>\n                        </div>\n                    ) : (\n                        watchedItems.map(item => (\n                             <WatchedItemCard\n                                key={item.id}\n                                item={item}\n                                seller={item.seller!}\n                            />\n                        ))\n                    )}\n                </motion.div>\n             )}\n        </AnimatePresence>\n      </Tabs>\n    \n      <DeleteConfirmationDialog \n        isOpen={!!itemToDelete}\n        onClose={() => setItemToDelete(null)}\n        onConfirm={confirmDelete}\n        itemTitle={itemToDelete?.title || ''}\n      />\n\n      {viewingItem && viewingItem.seller && (\n        <ProductDetailsModal \n          item={viewingItem} \n          seller={viewingItem.seller} \n          isOpen={true} \n          onClose={() => setViewingItem(null)} \n        />\n      )}\n    </div>\n  );\n}\n\nexport default function DashboardClient() {\n  return (\n    <Suspense fallback={<div className=\"p-8 text-center\">Loading dashboard...</div>}>\n      <DashboardContent />\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\dashboard\\seller\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\inbox\\InboxClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\inbox\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\list\\ListClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\list\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\product\\[slug]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used.","line":5,"column":81,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":84}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { use, useState, useMemo, useEffect } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { ChevronLeft, ChevronRight, MapPin, Clock, Bookmark, Maximize2, Share2, Zap, ArrowLeft, BadgeCheck } from \"lucide-react\";\nimport { useApp } from \"@/lib/store\";\nimport { useBidding } from \"@/hooks/useBidding\";\nimport { getFuzzyLocationString, calculatePrivacySafeDistance } from \"@/lib/utils\";\nimport { CategoryBadge } from \"@/components/common/CategoryBadge\";\nimport { ConditionBadge } from \"@/components/common/ConditionBadge\";\nimport { RatingBadge } from \"@/components/common/RatingBadge\";\nimport { TimerBadge } from \"@/components/common/TimerBadge\";\nimport { BiddingControls } from \"@/components/common/BiddingControls\";\nimport { Button } from \"@/components/ui/button\";\nimport { useRouter } from \"next/navigation\";\nimport { VerifiedBadge } from \"@/components/common/VerifiedBadge\";\nimport { toast } from \"sonner\";\nimport { Item, User } from \"@/types\";\nimport { supabase } from \"@/lib/supabase\";\nimport { transformListingToItem, ListingWithSeller } from \"@/lib/transform\";\nimport { FullscreenGallery } from \"@/components/marketplace/product-modal/FullscreenGallery\";\nimport { PriceDisplay } from \"@/components/common/PriceDisplay\";\nimport { ListingBadges } from \"@/components/marketplace/ListingBadges\";\nimport { createBiddingConfig } from \"@/types/bidding\";\n\nfunction ProductContent({ item, seller }: { item: Item; seller: User }) {\n  const router = useRouter();\n  const { user, toggleWatch, watchedItemIds, bids } = useApp();\n  const isWatched = watchedItemIds.includes(item.id);\n\n  const {\n    bidAmount,\n    error,\n    isSuccess,\n    handleSmartAdjust,\n    handleBid,\n    handleKeyDown,\n    handleInputChange,\n    handleInputBlur,\n    pendingConfirmation,\n    remainingAttempts,\n    userBid\n  } = useBidding(item, seller, () => {});\n\n  const [currentImg, setCurrentImg] = useState(0);\n  const [showFullscreen, setShowFullscreen] = useState(false);\n\n  useEffect(() => {\n    if (isSuccess) {\n      toast.success(\"Bid placed successfully!\", {\n        description: (\n          <span className=\"block mt-1\">\n            You placed a bid of <span className=\"font-bold text-emerald-600\">{bidAmount}</span> on <span className=\"font-semibold text-blue-600\">{item?.title}</span>\n          </span>\n        )\n      });\n    }\n  }, [isSuccess, bidAmount, item?.title]);\n\n  const { duration } = useMemo(() => {\n    const { duration: dur } = (user?.location && seller?.location) \n      ? calculatePrivacySafeDistance(user.location, seller.location) \n      : { duration: 0 };\n    return { \n      duration: dur\n    };\n  }, [seller, user]);\n\n  const biddingConfig = useMemo(() => \n    createBiddingConfig(item, user, bids),\n    [item, user, bids]);\n\n  const isHighBidder = user && item.isPublicBid && item.currentHighBidderId === user.id;\n  const isSeller = user?.id === seller.id;\n  const hasPriorBid = user && bids.some(b => b.itemId === item.id && b.bidderId === user.id);\n\n  return (\n    <div id={`product-page-${item.id}`} className=\"min-h-screen bg-slate-50/50 pb-20\">\n      <header className=\"sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-100 px-4 py-3 flex items-center justify-between\">\n        <Button \n          id=\"back-to-marketplace-btn\"\n          variant=\"ghost\" \n          onClick={() => router.push(\"/\")}\n          className=\"rounded-full hover:bg-slate-100 group\"\n        >\n          <ArrowLeft className=\"h-5 w-5 mr-2 transition-transform group-hover:-translate-x-1\" />\n          <span className=\"font-bold\">Marketplace</span>\n        </Button>\n\n        <div className=\"flex gap-2\">\n          <Button \n            id={`share-btn-${item.id}`}\n            variant=\"outline\" \n            size=\"icon\" \n            className=\"rounded-full h-10 w-10\"\n            onClick={() => {\n              if (navigator.share) {\n                navigator.share({ title: item.title, url: window.location.href });\n              }\n            }}\n          >\n            <Share2 className=\"h-4 w-4\" />\n          </Button>\n          <Button \n            id={`watch-btn-${item.id}`}\n            variant={isWatched ? \"secondary\" : \"outline\"} \n            size=\"icon\" \n            className={`rounded-full h-10 w-10 transition-colors ${isWatched ? 'bg-blue-50 text-blue-600 border-blue-200' : ''}`}\n            onClick={() => toggleWatch(item.id)}\n          >\n            <Bookmark className={`h-4 w-4 ${isWatched ? 'fill-current' : ''}`} />\n          </Button>\n        </div>\n      </header>\n\n      <main className=\"container mx-auto max-w-7xl mt-6 px-4\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-8\">\n          <div className=\"lg:col-span-7 space-y-6\">\n            <div className=\"relative aspect-square sm:aspect-[4/3] rounded-3xl overflow-hidden bg-white shadow-xl border border-slate-100 group\">\n              <AnimatePresence mode=\"wait\">\n                <motion.img\n                  id={`main-product-image`}\n                  key={currentImg}\n                  src={item.images[currentImg]}\n                  className=\"w-full h-full object-cover\"\n                  initial={{ opacity: 0, scale: 1.1 }}\n                  animate={{ opacity: 1, scale: 1 }}\n                  exit={{ opacity: 0, scale: 0.95 }}\n                  transition={{ duration: 0.4, ease: \"easeOut\" }}\n                />\n              </AnimatePresence>\n\n              <div id=\"product-page-left-stack\" className=\"absolute top-6 left-6 flex flex-col gap-2\">\n                <div className=\"bg-black/60 backdrop-blur-md text-white px-3 py-1.5 rounded-md flex items-center gap-2 shadow-lg border border-white/20\">\n                  <MapPin className=\"h-4 w-4\" />\n                  <span className=\"text-sm font-black tracking-tight leading-none truncate max-w-[150px]\">\n                    {seller?.location ? getFuzzyLocationString(seller.location.address) : 'Unknown Location'}\n                  </span>\n                </div>\n                <CategoryBadge \n                  category={item.category} \n                  variant=\"glass\" \n                  className=\"px-3 py-1.5\"\n                />\n              </div>\n\n              <div id=\"product-page-right-stack\" className=\"absolute top-6 right-6 flex flex-col items-end gap-2\">\n                <TimerBadge \n                  expiryAt={item.expiryAt} \n                  variant=\"glass\" \n                  className=\"px-3 py-1.5\"\n                />\n                <ConditionBadge \n                  condition={item.condition} \n                  variant=\"glass\" \n                  className=\"px-3 py-1.5\"\n                />\n              </div>\n\n              {item.images.length > 1 && (\n                <>\n                  <button \n                    id=\"prev-image-btn\"\n                    onClick={() => setCurrentImg(prev => (prev > 0 ? prev - 1 : item.images.length - 1))}\n                    className=\"absolute left-4 top-1/2 -translate-y-1/2 p-3 bg-white/90 hover:bg-white text-slate-800 rounded-full shadow-lg transition-all active:scale-y-95 border border-slate-100 backdrop-blur-sm opacity-0 group-hover:opacity-100 z-20 active:bg-slate-50\"\n                  >\n                    <ChevronLeft className=\"h-6 w-6\" />\n                  </button>\n                  <button \n                    id=\"next-image-btn\"\n                    onClick={() => setCurrentImg(prev => (prev < item.images.length - 1 ? prev + 1 : 0))}\n                    className=\"absolute right-4 top-1/2 -translate-y-1/2 p-3 bg-white/90 hover:bg-white text-slate-800 rounded-full shadow-lg transition-all active:scale-y-95 border border-slate-100 backdrop-blur-sm opacity-0 group-hover:opacity-100 z-20 active:bg-slate-50\"\n                  >\n                    <ChevronRight className=\"h-6 w-6\" />\n                  </button>\n                </>\n              )}\n\n              <button\n                id=\"zoom-image-btn\"\n                onClick={() => setShowFullscreen(true)}\n                className=\"absolute bottom-4 right-4 p-3 bg-white/90 hover:bg-white text-slate-800 rounded-full shadow-lg transition-all active:scale-y-95 border border-slate-100 backdrop-blur-sm opacity-0 group-hover:opacity-100 z-20 active:bg-slate-50\"\n                title=\"Zoom image\"\n              >\n                <Maximize2 className=\"h-6 w-6\" />\n              </button>\n            </div>\n\n            {item.images.length > 1 && (\n              <div className=\"flex gap-4 overflow-x-auto pb-2 scrollbar-hide\">\n                {item.images.map((src, i) => (\n                  <button\n                    id={`thumb-${i}`}\n                    key={i}\n                    onClick={() => setCurrentImg(i)}\n                    className={`relative h-24 w-24 shrink-0 rounded-2xl overflow-hidden border-2 transition-all ${currentImg === i ? 'border-blue-600 shadow-md ring-4 ring-blue-50' : 'border-transparent opacity-60 hover:opacity-100'}`}\n                  >\n                    <img src={src} alt={`${item.title} thumbnail ${i + 1}`} className=\"w-full h-full object-cover\" />\n                  </button>\n                ))}\n              </div>\n            )}\n\n            <div id={`seller-card-${item.id}`} className=\"bg-white rounded-2xl border-2 border-slate-100 shadow-sm group hover:border-blue-100 transition-colors overflow-hidden\">\n              <div className=\"p-4 flex items-center gap-3\">\n                <div className=\"relative shrink-0\">\n                  <img src={seller.avatar} className=\"h-12 w-12 rounded-full object-cover bg-slate-100 ring-2 ring-slate-50\" alt={seller.name} />\n                  {seller.isVerified && (\n                    <div className=\"absolute -bottom-1 -right-1 bg-white rounded-full p-0.5 shadow-sm\">\n                        <VerifiedBadge size=\"sm\" showTooltip={false} />\n                    </div>\n                  )}\n                </div>\n                <div className=\"min-w-0\">\n                  <h3 className=\"font-semibold text-slate-700 truncate text-lg leading-tight\">\n                    {seller.name}\n                  </h3>\n                  <div className=\"flex items-center gap-2 text-xs font-medium text-slate-500 mt-1\">\n                    <RatingBadge rating={seller.rating} count={seller.reviewCount} size=\"md\" />\n                    {seller.isVerified && (\n                      <>\n                        <span className=\"text-slate-300\">ΓÇó</span>\n                        <div className=\"flex items-center gap-1 text-blue-600 font-bold\">\n                          <BadgeCheck className=\"h-3 w-3 fill-current stroke-white\" />\n                          <span>Verified</span>\n                        </div>\n                      </>\n                    )}\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"relative h-px w-full bg-slate-50\">\n                  <div className=\"absolute left-0 top-1/2 -translate-x-1/2 -translate-y-1/2 w-3 h-3 bg-slate-100 rounded-full border border-slate-200\" />\n                  <div className=\"border-t-2 border-dashed border-slate-200 w-full h-full opacity-50\" />\n                  <div className=\"absolute right-0 top-1/2 translate-x-1/2 -translate-y-1/2 w-3 h-3 bg-slate-100 rounded-full border border-slate-200\" />\n              </div>\n\n              <div className=\"p-3 bg-slate-50/50 flex items-center justify-between text-xs font-bold text-slate-600\">\n                  <div className=\"flex items-center gap-1.5 truncate pr-2\">\n                    <MapPin className=\"w-3.5 h-3.5 text-slate-400 shrink-0\" />\n                    <span className=\"truncate\">{getFuzzyLocationString(seller.location.address)}</span>\n                  </div>\n                  <div className=\"flex items-center gap-1.5 text-blue-600 shrink-0 bg-blue-50 px-2 py-1 rounded-full border border-blue-100\">\n                    <Clock className=\"w-3 h-3\" />\n                    {duration} min\n                  </div>\n                </div>\n            </div>\n          </div>\n\n          <div className=\"lg:col-span-5 space-y-6 lg:row-span-2\">\n              <div \n                className={`bg-white rounded-3xl p-6 shadow-lg border border-slate-100 space-y-4 sticky top-24 transition-all\n                  ${isHighBidder ? 'ring-4 ring-amber-400' : ''}\n                `}\n              >\n                <div className=\"space-y-2\">\n                  <ListingBadges item={item} seller={seller} showTimer={false} />\n                  <h1 className=\"text-[clamp(1.5rem,4cqi,2.2rem)] font-black text-slate-900 leading-tight\">\n                    {item.title}\n                  </h1>\n                </div>\n\n                <div className=\"flex flex-col gap-3 py-3 border-y border-slate-50\">\n                  <PriceDisplay \n                    config={biddingConfig}\n                    askPrice={item.askPrice}\n                    bidCount={item.bidCount}\n                    viewMode=\"spacious\"\n                    orientation=\"stacked\"\n                    showTotalBids={true}\n                    userCurrentBid={userBid?.amount}\n                  />\n\n                  <div className=\"mt-1 space-y-2\">\n                    <BiddingControls\n                      bidAmount={bidAmount}\n                      isSuccess={isSuccess}\n                      isOwner={isSeller}\n                      hasPriorBid={!!hasPriorBid}\n                      isSubmitting={false}\n                      error={!!error}\n                      remainingAttempts={remainingAttempts}\n                      userCurrentBid={userBid?.amount}\n                      pendingConfirmation={pendingConfirmation}\n                      viewMode=\"modal\"\n                      idPrefix={`product-page-${item.id}`}\n                      onSmartAdjust={handleSmartAdjust}\n                      onBid={handleBid}\n                      onKeyDown={handleKeyDown}\n                      onInputChange={handleInputChange}\n                      onInputBlur={handleInputBlur}\n                      showAttemptsDots={false}\n                      showStatus={true}\n                    />\n\n                    {isHighBidder && !isSuccess && (\n                      <motion.div \n                        initial={{ opacity: 0, y: -10 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        className=\"mt-3 bg-amber-50 text-amber-800 px-4 py-2.5 rounded-xl text-center font-bold text-sm flex items-center justify-center gap-2 border border-amber-200/60 shadow-sm\"\n                      >\n                         <motion.div\n                           animate={{ \n                             scale: [1, 1.35, 1],\n                             rotate: [0, -20, 20, 0]\n                           }}\n                           transition={{ \n                             duration: 0.6,\n                             ease: \"backOut\",\n                             repeat: Infinity,\n                             repeatDelay: 3\n                           }}\n                           className=\"text-lg leading-none\"\n                         >\n                           ≡ƒÄë\n                         </motion.div>\n                        Highest Bidder!\n                      </motion.div>\n                    )}\n                  </div>\n                </div>\n\n                {error && <p className=\"text-red-500 text-sm font-bold text-center mt-2 mb-4\">{error}</p>}\n              </div>\n          </div>\n\n          <div className=\"lg:col-span-7 space-y-6\">\n            <div className=\"bg-white rounded-3xl p-8 shadow-sm border border-slate-100 space-y-4\">\n              <h2 className=\"text-xl font-bold text-slate-900\">Description</h2>\n              <p className=\"text-slate-600 leading-relaxed text-lg whitespace-pre-wrap\">\n                {item.description}\n              </p>\n            </div>\n          </div>\n        </div>\n      </main>\n\n      <FullscreenGallery \n        isOpen={showFullscreen}\n        onOpenChange={setShowFullscreen}\n        item={item}\n        currentImg={currentImg}\n        setCurrentImg={setCurrentImg}\n      />\n    </div>\n  );\n}\n\nexport default function ProductPage({ params }: { params: Promise<{ id?: string; slug?: string }> }) {\n  const resolvedParams = use(params);\n  const slugOrId = resolvedParams.slug || resolvedParams.id || '';\n  \n  const router = useRouter();\n  const { items, getUser } = useApp();\n  \n  const isUUID = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(slugOrId);\n  const storeItem = items.find((i) => isUUID ? i.id === slugOrId : i.slug === slugOrId);\n  \n  const [fetchedItem, setFetchedItem] = useState<Item | null>(null);\n  const [isLoading, setIsLoading] = useState(!storeItem);\n  const [fetchError, setFetchError] = useState(false);\n\n  useEffect(() => {\n    if (storeItem) {\n      setIsLoading(false);\n      return;\n    }\n\n    const fetchItem = async () => {\n      setIsLoading(true);\n      try {\n        let query = supabase.from('marketplace_listings').select('*');\n        if (isUUID) {\n            query = query.eq('id', slugOrId);\n        } else {\n            query = query.eq('slug', slugOrId);\n        }\n\n        const { data, error } = await query.single();\n\n        if (error || !data) {\n          console.error(\"Error fetching item:\", error);\n          setFetchError(true);\n        } else {\n          const newItem = transformListingToItem(data as unknown as ListingWithSeller);\n          setFetchedItem(newItem);\n        }\n      } catch (err) {\n        console.error(\"Exception fetching item:\", err);\n        setFetchError(true);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchItem();\n  }, [slugOrId, storeItem, isUUID]);\n\n  const item = storeItem || fetchedItem;\n  const seller = item?.seller || (item ? getUser(item.sellerId) : null);\n\n  if (isLoading) {\n    return (\n       <div className=\"flex flex-col items-center justify-center min-h-screen gap-4\">\n         <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-900\"></div>\n         <p className=\"text-slate-500 font-medium\">Loading details...</p>\n       </div>\n    );\n  }\n\n  if (fetchError || !item || !seller) {\n    return (\n      <div className=\"flex flex-col items-center justify-center min-h-[60vh] gap-4\">\n        <h1 className=\"text-2xl font-bold text-slate-900\">Item not found</h1>\n        <Button onClick={() => router.push(\"/\")} variant=\"outline\">\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to Marketplace\n        </Button>\n      </div>\n    );\n  }\n\n  return <ProductContent item={item} seller={seller} />;\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\profile\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\template.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ads\\AdCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ads\\AdSenseCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ads\\BannerAd.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\auth\\AuthDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\branding\\BoliyanLogo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\branding\\DihariLogo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\ActiveFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\BiddingControls.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatPrice' is defined but never used.","line":6,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'userCurrentBid' is defined but never used.","line":199,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":199,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showAttemptsDots' is assigned a value but never used.","line":206,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":206,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showStatus' is assigned a value but never used.","line":207,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":207,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { memo, useMemo, useState, useRef, useEffect } from \"react\";\nimport { motion } from \"framer-motion\";\nimport { useRouter } from \"next/navigation\";\nimport { cn, formatPrice } from \"@/lib/utils\";\nimport { Gavel, Loader2, AlertCircle, Edit } from \"lucide-react\";\nimport { MAX_BID_ATTEMPTS } from \"@/lib/bidding\";\nimport RollingPrice from \"./RollingPrice\";\nimport { BoliyanUrduMark } from \"@/components/branding/BoliyanLogo\";\n\nexport type BiddingViewMode = 'compact' | 'comfortable' | 'spacious' | 'modal';\n\ninterface BiddingControlsProps {\n  // Data\n  bidAmount: string;\n  isSuccess: boolean;\n  isOwner: boolean;\n  hasPriorBid: boolean;\n  isSubmitting?: boolean;\n  error?: boolean;\n  errorMessage?: string | null;\n  remainingAttempts?: number;\n  userCurrentBid?: number;\n  cooldownRemaining?: number;\n  \n  // New derived sticky status\n  derivedStatus?: { type: 'error', message: string } | null;\n\n  // Dual-tap confirmation state\n  pendingConfirmation?: { type: 'double_bid' | 'high_bid' | 'out_of_bids' | 'confirm_bid', message: string } | null;\n  \n  // Configuration\n  viewMode?: BiddingViewMode;\n  disabled?: boolean;\n  idPrefix: string;\n  showAttemptsDots?: boolean;\n  showStatus?: boolean;\n  itemId?: string; // Need Item ID for edit navigation\n  darkMode?: boolean; // For hidden bidding dark theme\n  \n  // Handlers\n  onSmartAdjust: (e: React.MouseEvent, direction: -1 | 1) => void;\n  onBid: (e: React.MouseEvent) => void;\n  onKeyDown: (e: React.KeyboardEvent<HTMLInputElement>) => void;\n  onInputChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\n  onInputBlur?: () => void;\n  onInputClick?: (e: React.MouseEvent) => void;\n}\n\n// Centralized Theme Configuration\ntype ButtonTheme = 'active' | 'success' | 'inactive' | 'danger' | 'warning' | 'neutral';\n\nconst BUTTON_THEMES: Record<ButtonTheme, { classes: string; bgHex: string; hoverHex?: string; textClass: string }> = {\n  active: {\n    classes: 'text-white', // Removed hover:bg class to use Framer Motion gesture\n    bgHex: '#2563eb', // bg-blue-600\n    hoverHex: '#1d4ed8', // bg-blue-700\n    textClass: 'text-white'\n  },\n  success: {\n    classes: 'text-white',\n    bgHex: '#d97706', // bg-amber-600\n    hoverHex: '#b45309', // bg-amber-700\n    textClass: 'text-white'\n  },\n  inactive: {\n    classes: 'bg-slate-100 cursor-not-allowed shadow-none border border-slate-200 text-slate-400 font-medium',\n    bgHex: '#f1f5f9', // bg-slate-100\n    textClass: 'text-slate-400 font-medium'\n  },\n  danger: {\n    classes: 'text-white',\n    bgHex: '#dc2626', // bg-red-600\n    hoverHex: '#b91c1c', // bg-red-700\n    textClass: 'text-white'\n  },\n  warning: {\n    classes: 'text-white',\n    bgHex: '#f97316', // bg-orange-500\n    hoverHex: '#ea580c', // bg-orange-600\n    textClass: 'text-white'\n  },\n  neutral: {\n    classes: 'bg-slate-100 text-slate-900',\n    bgHex: '#f1f5f9', // bg-slate-100\n    textClass: 'text-slate-900'\n  }\n};\n\n// Reusable Content Component\nconst BiddingButtonContent = ({ \n  icon: Icon, \n  text, \n  className \n}: { \n  icon?: React.ElementType; \n  text: React.ReactNode; \n  className?: string \n}) => (\n  <span className={cn(\"flex items-center gap-1.5\", className)}>\n    {Icon && <Icon className={cn(\"w-4 h-4 md:w-5 md:h-5\", className?.includes('opacity') ? \"\" : \"shrink-0\")} />}\n    {text}\n  </span>\n);\n\n// Re-add Label Component that was accidentally removed but is still used\nconst BiddingButtonLabel = ({ content, className }: { content: React.ReactNode, className?: string }) => (\n  <div className={cn(\"absolute inset-0 flex items-center justify-center font-black font-outfit gap-1.5 whitespace-nowrap\", className)}>\n    {content}\n  </div>\n);\n\n// Pyramid Beads Component - displays remaining attempts in a pyramid (2 top, 3 bottom)\nconst PyramidBeads = ({ remaining, darkMode = false }: { remaining: number; darkMode?: boolean }) => {\n  // Pyramid layout: [0,1] top row, [2,3,4] bottom row\n  // Depletion order: Top-Right (1) -> Top-Left (0) -> Bot-Right (4) -> Bot-Mid (3) -> Bot-Left (2)\n  const beadActive = (index: number) => {\n    const used = 5 - remaining;\n    // Lower priority means it depletes sooner\n    const priorityMap: Record<number, number> = {\n      1: 0, // Top Right (Dies 1st)\n      0: 1, // Top Left (Dies 2nd)\n      4: 2, // Bot Right (Dies 3rd)\n      3: 3, // Bot Mid   (Dies 4th)\n      2: 4  // Bot Left  (Dies 5th)\n    };\n    // Alive if priority >= used count\n    return priorityMap[index] >= used;\n  };\n  \n  const beadClass = (active: boolean) => cn(\n    \"h-1.5 w-1.5 rounded-full transition-all duration-300 shrink-0\",\n    active \n      ? (darkMode ? \"bg-white/70\" : \"bg-white/80\")\n      : (darkMode ? \"bg-white/20\" : \"bg-white/30\")\n  );\n  \n  return (\n    <div className=\"flex flex-col items-center gap-0.5 ml-2\">\n      {/* Top row: 2 beads */}\n      <div className=\"flex gap-1\">\n        <div className={beadClass(beadActive(0))} />\n        <div className={beadClass(beadActive(1))} />\n      </div>\n      {/* Bottom row: 3 beads */}\n      <div className=\"flex gap-1\">\n        <div className={beadClass(beadActive(2))} />\n        <div className={beadClass(beadActive(3))} />\n        <div className={beadClass(beadActive(4))} />\n      </div>\n    </div>\n  );\n};\n\n// Size Helpers\nfunction getInputHeight(viewMode: BiddingViewMode): string {\n  switch (viewMode) {\n    case 'modal': return 'h-12 sm:h-14';\n    case 'spacious': return 'h-10';\n    default: return 'h-8 sm:h-9';\n  }\n}\n\nfunction getButtonWidth(viewMode: BiddingViewMode): string {\n  switch (viewMode) {\n    case 'modal': return 'w-12 sm:w-14';\n    case 'spacious': return 'w-12';\n    default: return 'w-10';\n  }\n}\n\nfunction getTextSize(viewMode: BiddingViewMode): string {\n  switch (viewMode) {\n    case 'modal': return 'text-lg sm:text-xl';\n    case 'spacious': return 'text-[clamp(0.875rem,5cqi,1.125rem)]';\n    default: return 'text-[clamp(0.875rem,5cqi,1.125rem)]';\n  }\n}\n\n// Gap between stepper and button (viewMode-aware)\nfunction getGapClass(viewMode: BiddingViewMode): string {\n  switch (viewMode) {\n    case 'modal': return 'gap-3';     // More breathing room\n    case 'spacious': return 'gap-2.5';\n    default: return 'gap-1.5';        // Compact for ItemCards\n  }\n}\n\nexport const BiddingControls = memo(({\n  bidAmount,\n  isSuccess,\n  isOwner,\n  hasPriorBid,\n  isSubmitting = false,\n  error = false,\n  errorMessage = null,\n  remainingAttempts = MAX_BID_ATTEMPTS,\n  userCurrentBid,\n  cooldownRemaining = 0,\n  derivedStatus = null,\n  pendingConfirmation = null,\n  viewMode = 'compact',\n  disabled = false,\n  idPrefix,\n  showAttemptsDots = true,\n  showStatus = false,\n  onSmartAdjust,\n  onBid,\n  onKeyDown,\n  onInputChange,\n  onInputBlur,\n  onInputClick,\n  itemId,\n  darkMode = false\n}: BiddingControlsProps) => {\n\n  const router = useRouter();\n  const [isFocused, setIsFocused] = useState(false);\n  const numericBid = parseFloat(bidAmount.replace(/[^0-9.-]+/g, '')) || 0;\n  const buildId = (suffix: string) => `${idPrefix}-${suffix}`;\n  const isQuotaReached = remainingAttempts === 0;\n  \n  // Disabled state logic\n  const isDisabled = disabled || (isOwner && !itemId) || isSubmitting;\n\n  const isCoolingDown = cooldownRemaining > 0 && !isQuotaReached && !isSuccess;\n  \n  // Long Press Logic\n  const longPressRef = useRef<{ timeout: NodeJS.Timeout | null, interval: NodeJS.Timeout | null }>({ timeout: null, interval: null });\n\n  const handleStartLongPress = (e: React.PointerEvent | React.MouseEvent, direction: -1 | 1) => {\n    // Prevent default context menu and other gestures\n    // e.preventDefault(); \n    \n    // Clear any existing timers just in case\n    handleStopLongPress();\n\n    // Trigger immediate action\n    onSmartAdjust(e as React.MouseEvent, direction);\n\n    // Start delay timer for auto-repeat\n    longPressRef.current.timeout = setTimeout(() => {\n      longPressRef.current.interval = setInterval(() => {\n        // Pass a dummy event since onSmartAdjust requires one but only uses stopPropagation\n        onSmartAdjust({ stopPropagation: () => {} } as React.MouseEvent, direction);\n      }, 100); // Speed: 100ms interval\n    }, 500); // Delay: 500ms before repeat starts\n  };\n\n  const handleStopLongPress = () => {\n    if (longPressRef.current.timeout) clearTimeout(longPressRef.current.timeout);\n    if (longPressRef.current.interval) clearInterval(longPressRef.current.interval);\n    longPressRef.current = { timeout: null, interval: null };\n  };\n\n  const handleEditClick = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    if (itemId) {\n      router.push(`/list?id=${itemId}`);\n    }\n  };\n\n  const inputContainerRef = useRef<HTMLDivElement>(null);\n\n  // Remove high-precision heartbeat dependency for performance\n  const [justFinishedCooldown, setJustFinishedCooldown] = useState(false);\n\n  useEffect(() => {\n    if (cooldownRemaining > 0) {\n      const timer = setTimeout(() => {\n        setJustFinishedCooldown(true);\n        setTimeout(() => setJustFinishedCooldown(false), 800);\n      }, cooldownRemaining * 1000);\n      return () => clearTimeout(timer);\n    }\n  }, [cooldownRemaining]);\n  \n  const { theme, content } = useMemo(() => {\n    // 1. Success State\n    if (isSuccess) {\n      return { \n        theme: 'success' as ButtonTheme,\n        content: (\n          <span className=\"flex items-center gap-2\">\n             <motion.svg \n              initial={{ scale: 0 }}\n              animate={{ scale: 1 }}\n              className=\"w-5 h-5\" \n              fill=\"none\" \n              viewBox=\"0 0 24 24\" \n              stroke=\"currentColor\"\n            >\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M5 13l4 4L19 7\" />\n            </motion.svg>\n            <span>Bid Placed!</span>\n          </span>\n        )\n      };\n    }\n\n    // 2. Submission Loader\n    if (isSubmitting) {\n      return {\n        theme: 'active' as ButtonTheme, // Blue base\n        content: <Loader2 className=\"w-6 h-6 animate-spin\" />\n      };\n    }\n\n    // 3. Critical Errors (Sticky Derived Status)\n    if (derivedStatus) {\n      return {\n        theme: 'inactive' as ButtonTheme,\n        content: <BiddingButtonContent icon={AlertCircle} text={derivedStatus.message} className=\"opacity-70\" />\n      };\n    }\n\n    // 4. Standard Errors\n    if (errorMessage) {\n      const shortError = (() => {\n        if (errorMessage === \"Out of Bids\" || isQuotaReached) return \"Out of Bids\";\n        if (errorMessage === \"Already Bid This Amount\") return \"Already Bid\";\n        if (errorMessage === \"Already Offered\") return \"Already Offered\";\n        if (errorMessage === \"Higher Bid Required\") return \"Bid Higher\";\n        if (errorMessage === \"Minimum Bid Reached\") return \"Min Bid Reached\";\n        if (errorMessage === \"Maximum Limit Reached\") return \"Max Reached\";\n        if (errorMessage === \"Below Minimum\") return \"Below Min\";\n        if (errorMessage === \"Above Maximum\") return \"Above Max\";\n        if (errorMessage.includes(\"Wait\")) return \"Cooldown Active\";\n        return errorMessage; \n      })();\n\n      return {\n        theme: 'inactive' as ButtonTheme,\n        content: <BiddingButtonContent icon={AlertCircle} text={shortError} className=\"opacity-70\" />\n      };\n    }\n\n    // 5. Confirmation State\n    if (pendingConfirmation) {\n      return {\n        theme: 'danger' as ButtonTheme,\n        content: pendingConfirmation.message\n      };\n    }\n    \n    // 6. Owner State\n    if (isOwner) {\n      return {\n        theme: 'neutral' as ButtonTheme,\n        content: <BiddingButtonContent icon={Edit} text=\"Edit Listing\" />\n      };\n    }\n\n    // 7. Standard States\n    if (hasPriorBid) {\n      return {\n        theme: 'warning' as ButtonTheme,\n        content: <BiddingButtonContent icon={Gavel} text=\"Update Bid\" />\n      };\n    }\n\n    return {\n      theme: 'active' as ButtonTheme,\n      content: <BiddingButtonContent icon={Gavel} text=\"Place Bid\" />\n    };\n  }, [isSuccess, isSubmitting, errorMessage, isQuotaReached, derivedStatus, pendingConfirmation, isOwner, hasPriorBid]);\n\n  // Derived styles from centralized config\n  const activeTheme = BUTTON_THEMES[theme];\n\n  return (\n    <div id={buildId('bidding-controls')} className={cn(\"flex flex-col w-full relative\", getGapClass(viewMode))}>\n      \n      {/* Beads now integrated into the button - see PyramidBeads component */}\n\n      {/* Stepper Input Row */}\n      <div className={`flex w-full ${getInputHeight(viewMode)} relative`} ref={inputContainerRef}>\n        <div className={cn(\n          \"flex flex-1 rounded-xl shadow-sm overflow-hidden\",\n          darkMode ? \"border border-slate-600 bg-slate-800\" : \"border border-slate-300 bg-white\",\n          (isOwner || isQuotaReached) && 'opacity-50 grayscale pointer-events-none'\n        )}>\n          \n          {/* Decrement Button */}\n          <button\n            id={buildId('decrement-btn')}\n            onPointerDown={(e) => handleStartLongPress(e, -1)}\n            onPointerUp={handleStopLongPress}\n            onPointerLeave={handleStopLongPress}\n            onContextMenu={(e) => e.preventDefault()}\n            disabled={isDisabled || isQuotaReached}\n            className={cn(\n              getButtonWidth(viewMode),\n              \"flex items-center justify-center transition-colors group disabled:cursor-not-allowed\",\n              darkMode \n                ? \"bg-slate-700 hover:bg-slate-600 border-r border-slate-600 text-slate-300 hover:text-red-400 active:bg-slate-500\" \n                : \"bg-slate-50 hover:bg-slate-100 border-r border-slate-200 text-slate-500 hover:text-red-600 active:bg-slate-200\"\n            )}\n          >\n            <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2.5\" d=\"M18 12H6\" />\n            </svg>\n          </button>\n\n          {/* Input */}\n          <div className=\"relative flex-1\">\n            <motion.input\n              id={buildId('bid-input')}\n              type=\"text\"\n              value={bidAmount}\n              initial={false}\n              disabled={isDisabled || isQuotaReached}\n              animate={{ \n                x: (error || pendingConfirmation) ? [0, -4, 4, -4, 4, 0] : 0\n              }}\n              transition={{ \n                x: { duration: 0.2 } // Shake duration\n              }}\n              onFocus={() => setIsFocused(true)}\n              onBlur={() => {\n                setIsFocused(false);\n                if (onInputBlur) onInputBlur();\n              }}\n              onKeyDown={onKeyDown}\n              onChange={onInputChange}\n              onClick={onInputClick}\n              className={cn(\n                `w-full h-full text-center ${getTextSize(viewMode)} font-black font-outfit focus:outline-none px-1 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none transition-colors duration-300`,\n                darkMode ? \"text-white\" : \"text-slate-900\",\n                error ? (darkMode ? 'bg-red-900/50 text-red-200' : 'bg-red-50 text-red-900') : 'bg-transparent',\n                isFocused ? 'opacity-100' : 'opacity-0'\n              )}\n            />\n             {!isFocused && (\n              <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\n                 <RollingPrice price={numericBid} className={cn(getTextSize(viewMode), \"font-black font-outfit\", darkMode ? \"text-white\" : \"text-slate-900\")} />\n              </div>\n            )}\n          </div>\n\n          {/* Increment Button */}\n          <button\n            id={buildId('increment-btn')}\n            onPointerDown={(e) => handleStartLongPress(e, 1)}\n            onPointerUp={handleStopLongPress}\n            onPointerLeave={handleStopLongPress}\n            onContextMenu={(e) => e.preventDefault()}\n            disabled={isDisabled || isQuotaReached}\n            className={cn(\n              getButtonWidth(viewMode),\n              \"flex items-center justify-center transition-colors group disabled:cursor-not-allowed\",\n              darkMode \n                ? \"bg-slate-700 hover:bg-slate-600 border-l border-slate-600 text-slate-300 hover:text-amber-400 active:bg-slate-500\" \n                : \"bg-slate-50 hover:bg-slate-100 border-l border-slate-200 text-slate-500 hover:text-amber-600 active:bg-slate-200\"\n            )}\n          >\n            <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2.5\" d=\"M12 6v12m6-6H6\" />\n            </svg>\n          </button>\n        </div>\n      </div>\n\n      {/* Action Button Foundation (L0) */}\n      <motion.button\n        id={buildId('place-bid-btn')}\n        onClick={isOwner ? handleEditClick : onBid}\n        disabled={isDisabled || isQuotaReached || isCoolingDown || isSuccess}\n        initial={false}\n        animate={{\n          x: pendingConfirmation ? [0, -3, 3, -3, 3, 0] : 0,\n          scale: justFinishedCooldown ? [1, 1.18, 1] : 1,\n          backgroundColor: isCoolingDown ? '#f8fafc' : activeTheme.bgHex, // Use slate-50 when cooling down\n        }}\n        whileHover={(!isDisabled && !isQuotaReached && !isCoolingDown && !isSuccess && activeTheme.hoverHex) ? {\n          backgroundColor: activeTheme.hoverHex,\n          transition: { duration: 0.2 }\n        } : {}}\n        whileTap={(!isDisabled && !isQuotaReached && !isCoolingDown && !isSuccess) ? { \n          scaleY: 0.96,\n          transition: { duration: 0.1 }\n        } : {}}\n        transition={{ \n          x: { duration: 0.4 },\n          scale: { duration: 0.4, ease: [0.175, 0.885, 0.32, 1.275] },\n          backgroundColor: { duration: 0.2, ease: \"easeInOut\" }\n        }}\n        className={cn(\n          getInputHeight(viewMode),\n          \"w-full rounded-xl font-bold font-outfit shadow-md text-[clamp(0.875rem,5cqi,1.125rem)] flex items-center justify-center relative transition-colors duration-200 z-20\",\n          activeTheme.classes,\n          isCoolingDown ? \"shadow-none border border-slate-200 cursor-not-allowed\" : \"\"\n        )}\n      >\n        {isCoolingDown ? (\n          <div className=\"flex items-center justify-center opacity-60\">\n             <BoliyanUrduMark className=\"text-xl text-slate-400\" />\n          </div>\n        ) : (\n          <BiddingButtonLabel \n            content={\n              <>\n                {content}\n                {!isOwner && !isSuccess && !isQuotaReached && (\n                  <PyramidBeads remaining={remainingAttempts} darkMode={darkMode} />\n                )}\n              </>\n            }\n            className={cn(activeTheme.textClass, \"transition-colors duration-200\")}\n          />\n        )}\n      </motion.button>\n    </div>\n  );\n});\n\nBiddingControls.displayName = \"BiddingControls\";\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\BiddingWidget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\CategoryBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\ConditionBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\DealSealAnimation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\DistanceBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\GamificationBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\GlobalSonic.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\LocationBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\PriceDisplay.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'remainingAttempts' is assigned a value but never used.","line":57,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showAttempts' is assigned a value but never used.","line":58,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'renderLabel' is assigned a value but never used.","line":166,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":166,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { memo, useState, useEffect, useRef } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Lock, User as UserIcon, Tag, Trophy } from \"lucide-react\";\nimport { BiddingConfig, BiddingViewMode } from \"@/types/bidding\";\nimport { cn } from \"@/lib/utils\";\nimport { MAX_BID_ATTEMPTS } from \"@/lib/bidding\";\nimport RollingPrice from \"./RollingPrice\";\n\n// ============================================\n// PROPS\n// ============================================\n\ninterface PriceDisplayProps {\n  config: BiddingConfig;\n  askPrice: number;\n  bidCount: number;\n  viewMode?: BiddingViewMode;\n  className?: string;\n  remainingAttempts?: number;\n  showAttempts?: boolean;\n  userCurrentBid?: number;\n  showTotalBids?: boolean;\n  orientation?: 'row' | 'stacked';\n  itemId?: string; // For Realtime DOM targeting\n  darkMode?: boolean; // For secret bidding dark theme\n}\n\n\n// ============================================\n// SIZE HELPERS\n// ============================================\n\nfunction getLabelClass(): string {\n  return 'text-[clamp(0.5625rem,2.25cqi,0.75rem)] font-black uppercase tracking-[0.08em] text-slate-500/80 mb-1';\n}\n\nfunction getPriceClass(viewMode: BiddingViewMode): string {\n  const base = 'font-outfit font-black leading-none transition-all';\n  switch (viewMode) {\n    case 'modal': return `${base} text-xl`;\n    default: return `${base} text-[clamp(1rem,6cqi,1.5rem)]`;\n  }\n}\n\n// ============================================\n// COMPONENT\n// ============================================\n\nexport const PriceDisplay = memo(({ \n  config, \n  askPrice, \n  bidCount,\n  viewMode = 'compact',\n  className = '',\n  remainingAttempts = MAX_BID_ATTEMPTS,\n  showAttempts = false,\n  userCurrentBid,\n  showTotalBids = false,\n  orientation = 'row',\n  itemId,\n  darkMode = false\n}: PriceDisplayProps) => {\n\n  const [showUserBid, setShowUserBid] = useState(false);\n  const prevUserBid = useRef(userCurrentBid);\n  const lastBidTimestamp = useRef(0);\n\n  // Rotation Logic\n  // Wait for rolling animation (500ms) + display time (2000ms) before switching\n  const ROLLING_ANIMATION_DURATION = 500;\n  const DISPLAY_HOLD_DURATION = 2000;\n  const TOTAL_ROTATION_INTERVAL = ROLLING_ANIMATION_DURATION + DISPLAY_HOLD_DURATION;\n\n  // Force show \"Your Bid\" immediately when user places a new bid\n  // Using queueMicrotask to avoid synchronous setState in effect (lint error)\n  useEffect(() => {\n    if (userCurrentBid !== undefined && userCurrentBid !== null && userCurrentBid !== prevUserBid.current) {\n      // New bid detected - force show \"Your Bid\" on next microtask\n      queueMicrotask(() => {\n        setShowUserBid(true);\n        lastBidTimestamp.current = Date.now();\n      });\n      prevUserBid.current = userCurrentBid;\n    }\n  }, [userCurrentBid]);\n\n  // Auto-rotate between views\n  useEffect(() => {\n    // Stop if no user bid\n    if (userCurrentBid === undefined || userCurrentBid === null) {\n      return;\n    }\n\n    // Start rotation after animation completes + hold time\n    const timer = setTimeout(() => {\n      setShowUserBid(prev => !prev);\n    }, TOTAL_ROTATION_INTERVAL);\n\n    return () => clearTimeout(timer);\n  }, [showUserBid, userCurrentBid, config.variant, config.isUserHighBidder, TOTAL_ROTATION_INTERVAL]);\n  \n  const safeShowUserBid = showUserBid && (userCurrentBid !== undefined && userCurrentBid !== null);\n  \n  // Determine Right-Side Content (Dynamic)\n  let labelText = \"\";\n  let LabelIcon = null;\n  let labelColor = darkMode ? \"text-slate-400\" : \"text-slate-500/80\";\n  let displayPrice: number | null = null;\n  let displayText: string | null = null;\n  let displayColor = darkMode ? \"text-white\" : \"text-slate-800\";\n  \n  // Realtime targeting props\n  const highBidProps = itemId && !safeShowUserBid && config.variant === 'public' && config.showHighBid \n    ? {\n        'data-rt-item-id': itemId,\n        'data-rt-high-bid': 'true',\n        'data-rt-high-bid-value': config.currentHighBid || 0\n      }\n    : {};\n    \n  const bidCountProps = itemId && !safeShowUserBid && (!config.showHighBid || config.variant !== 'public')\n    ? {\n        'data-rt-item-id': itemId,\n        'data-rt-bid-count': 'true'\n      }\n    : {};\n\n  if (safeShowUserBid && userCurrentBid) {\n      labelText = \"Your Bid\";\n      LabelIcon = UserIcon;\n      labelColor = darkMode ? \"text-purple-500\" : \"text-purple-700\";\n      displayPrice = userCurrentBid;\n      displayColor = darkMode ? \"text-purple-500\" : \"text-purple-700\";\n  } else {\n      // Market View\n      if (config.variant === 'public') {\n          labelText = \"Highest\";\n          LabelIcon = Trophy;\n          if (config.showHighBid && config.currentHighBid) {\n              displayPrice = config.currentHighBid;\n              if (config.isUserHighBidder) {\n                displayColor = darkMode ? \"text-amber-400\" : \"text-amber-600\";\n              } else {\n                displayColor = darkMode ? \"text-blue-400\" : \"text-blue-600\";\n              }\n          } else {\n              // No bids or not showing high bid\n              // Explicitly ensure displayPrice is null here\n              displayPrice = null;\n              displayText = bidCount === 0 ? 'Be first!' : `${bidCount} ${bidCount === 1 ? 'Bid' : 'Bids'}`;\n              displayColor = darkMode ? \"text-blue-400\" : \"text-blue-600\";\n          }\n      } else {\n          // Hidden\n          labelText = \"Hidden\";\n          LabelIcon = Lock;\n          displayPrice = null;\n          displayText = bidCount === 0 ? 'Be first!' : `${bidCount} ${bidCount === 1 ? 'Bid' : 'Bids'}`;\n          displayColor = darkMode ? \"text-amber-400\" : \"text-amber-600\";\n      }\n  }\n\n  // Common Label Component\n  const renderLabel = () => (\n    <AnimatePresence mode=\"wait\">\n        <motion.span \n            key={labelText}\n            initial={{ opacity: 0, y: 5 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -5 }}\n            transition={{ duration: 0.2 }}\n            className={cn(getLabelClass(), \"flex items-center gap-1.5 justify-center mb-0.5 whitespace-nowrap absolute right-0 bottom-0\", labelColor)}\n        >\n            {LabelIcon && <LabelIcon className=\"w-3 h-3\" />}\n            {labelText}\n        </motion.span>\n    </AnimatePresence>\n  );\n\n  \n  const renderValue = () => (\n    <AnimatePresence mode=\"wait\">\n      <motion.span \n        key={safeShowUserBid ? 'user-bid' : (displayPrice !== null ? 'market-price' : 'text')}\n        initial={{ opacity: 0, y: 5 }}\n        animate={{ opacity: 1, y: 0 }}\n        exit={{ opacity: 0, y: -5 }}\n        transition={{ duration: 0.2 }}\n        className={cn(getPriceClass(viewMode), \"flex items-center gap-1 transition-colors duration-300\", displayColor)}\n        {...(displayPrice !== null ? highBidProps : bidCountProps)}\n      >\n          {/* Show Total Bids Count only when there are bids */}\n          {(showTotalBids && config.variant === 'public' && bidCount > 0) ? (\n               <span className=\"text-[0.8em] font-bold text-slate-400\">({bidCount})</span>\n          ) : null}\n          {displayPrice !== null ? (\n              <RollingPrice price={displayPrice} />\n          ) : (\n              displayText\n          )}\n      </motion.span>\n    </AnimatePresence>\n  );\n\n  // STACKED ORIENTATION\n  if (orientation === 'stacked') {\n      return (\n        <div className={cn(\"grid grid-cols-2 gap-4 w-full\", className)}>\n             {/* Ask Price Block */}\n             <div className=\"flex flex-col items-center justify-center p-3 pl-5 bg-slate-50 border-2 border-slate-100 rounded-2xl shadow-sm h-20 min-w-0\">\n                <span className={cn(getLabelClass(), \"flex items-center gap-1.5 justify-center mb-0.5\")}>\n                    <Tag className=\"w-3 h-3 text-slate-400\" />\n                    Asking\n                </span>\n                <span className={cn(getPriceClass(viewMode), \"text-slate-800\")}>\n                    <RollingPrice price={askPrice} />\n                </span>\n             </div>\n\n             {/* Highest/User Bid Block */}\n             <div className=\"flex flex-col items-center justify-center p-3 pl-5 bg-slate-50 border-2 border-slate-100 rounded-2xl shadow-sm h-20 min-w-0 relative overflow-hidden\">\n                 {/* Label Container - Fixed Height */}\n                 <div className=\"h-4 w-full relative flex justify-center mb-1\">\n                     <AnimatePresence mode=\"wait\">\n                        <motion.span \n                            key={labelText}\n                            initial={{ opacity: 0, y: 5 }}\n                            animate={{ opacity: 1, y: 0 }}\n                            exit={{ opacity: 0, y: -5 }}\n                            transition={{ duration: 0.2 }}\n                            className={cn(getLabelClass(), \"flex items-center gap-1.5 justify-center absolute inset-x-0\", labelColor)}\n                        >\n                            {LabelIcon && <LabelIcon className=\"w-3 h-3\" />}\n                            {labelText}\n                        </motion.span>\n                    </AnimatePresence>\n                 </div>\n                 \n                 {/* Value Container */}\n                 {renderValue()}\n             </div>\n        </div>\n      );\n  }\n\n  // ROW ORIENTATION (Default) - Minimalist/Typography Driven\n  return (\n    <div className={`flex justify-between items-end w-full px-1 ${className}`}>\n      {/* Asking Price - Left Aligned */}\n      <div className=\"flex flex-col items-start\">\n        <span className={cn(\"text-[0.65rem] font-bold uppercase tracking-wider mb-0.5 flex items-center gap-1\", darkMode ? \"text-slate-400\" : \"text-slate-400\")}>\n          <Tag className=\"w-3 h-3\" />\n          Asking\n        </span>\n        <span className={cn(getPriceClass(viewMode), \"leading-[0.9]\", darkMode ? \"text-white\" : \"text-slate-900\")}>\n          <RollingPrice price={askPrice} />\n        </span>\n      </div>\n\n      {/* Attempt Dots (Removed per request - moved to button) */}\n      <div className=\"flex flex-col items-center justify-end h-[2.5em] pb-1.5 opacity-60\">\n        {/* Dots moved to BiddingControls button */}\n      </div>\n\n      {/* Dynamic Right Side - Right Aligned */}\n      <div \n        className=\"flex flex-col items-end h-[2.5em] relative\"\n      >\n          {/* Label Container - Absolute to prevent layout jump during transition */}\n          <div className=\"h-4 w-full relative mb-0.5\">\n             <AnimatePresence mode=\"wait\">\n                <motion.span \n                    key={labelText}\n                    initial={{ opacity: 0, x: 10 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    exit={{ opacity: 0, x: -10 }}\n                    transition={{ duration: 0.2 }}\n                    className={cn(\n                        \"text-[0.65rem] font-bold uppercase tracking-wider absolute right-0 bottom-0 whitespace-nowrap mb-0 flex items-center gap-1\", \n                        // Mute the colors for the label to keep focus on the number\n                        labelColor.replace('text-purple-600', 'text-purple-500').replace('text-amber-600', 'text-amber-500')\n                    )}\n                >\n                    {LabelIcon && <LabelIcon className=\"w-3 h-3\" />}\n                    {labelText}\n                </motion.span>\n             </AnimatePresence>\n          </div>\n\n          {/* Value Container - Stable */}\n          <span \n            className={cn(getPriceClass(viewMode), \"flex items-center gap-1 transition-colors duration-300 leading-[0.9]\", displayColor)}\n            {...(displayPrice !== null ? highBidProps : bidCountProps)}\n          >\n              {/* Show Total Bids Count only when there are bids */}\n              {(showTotalBids && config.variant === 'public' && bidCount > 0) ? (\n                   <span className=\"text-[0.8em] font-bold text-slate-400\">({bidCount})</span>\n              ) : null}\n              {displayPrice !== null ? (\n                  <RollingPrice key=\"stable-price-display\" price={displayPrice} />\n              ) : (\n                  displayText\n              )}\n          </span>\n      </div>\n    </div>\n  );\n});\n\nPriceDisplay.displayName = 'PriceDisplay';\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\RatingBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\RollingPrice.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\TimerBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\VerifiedBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\AchievementSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\ListingActionMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\MyBidCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MapPin' is defined but never used.","line":4,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isExpired' is assigned a value but never used.","line":30,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'remainingAttempts' is assigned a value but never used.","line":35,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useMemo } from \"react\";\nimport { Clock, MapPin, Trophy, AlertTriangle, MessageSquare, Phone } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { Bid, Item, User } from \"@/types\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport ProductDetailsModal from \"@/components/marketplace/ProductDetailsModal\";\nimport { CategoryBadge } from \"@/components/common/CategoryBadge\";\nimport { ConditionBadge } from \"@/components/common/ConditionBadge\";\nimport { PriceDisplay } from \"@/components/common/PriceDisplay\";\nimport { createBiddingConfig } from \"@/types/bidding\";\nimport { MAX_BID_ATTEMPTS } from \"@/lib/bidding\";\nimport { useApp } from \"@/lib/store\";\nimport { useTime } from \"@/context/TimeContext\";\n\ninterface MyBidCardProps {\n  item: Item;\n  userBid: Bid;\n  seller: User;\n}\n\nexport default function MyBidCard({ item, userBid, seller }: MyBidCardProps) {\n  const { user, bids, conversations } = useApp();\n  const { now } = useTime();\n  \n  const isLeading = user && item.isPublicBid && item.currentHighBidderId === user.id;\n  const isOutbid = user && item.isPublicBid && item.currentHighBidderId !== user.id && (item.currentHighBid || 0) > userBid.amount;\n  const isExpired = userBid.status === 'expired';\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const router = useRouter();\n\n  // Remaining Attempts\n  const remainingAttempts = useMemo(() => {\n    const updatesUsed = userBid.update_count || 0;\n    return Math.max(0, (MAX_BID_ATTEMPTS - 1) - updatesUsed);\n  }, [userBid]);\n\n  // Unified Bidding Config\n  const biddingConfig = useMemo(() => \n    createBiddingConfig(item, user, bids),\n    [item, user, bids]\n  );\n\n  const getTimeLeft = (expiryAt: string) => {\n    if (now === 0) return \"Loading...\";\n    const diff = new Date(expiryAt).getTime() - now;\n    const hours = Math.max(0, Math.floor(diff / 3600000));\n    const mins = Math.max(0, Math.floor((diff % 3600000) / 60000));\n    \n    if (hours >= 24) return `${Math.floor(hours / 24)}d ${hours % 24}h`;\n    return `${hours}h ${mins}m`;\n  };\n\n  const acceptedConversation = useMemo(() => {\n    if (!user) return undefined;\n    return conversations.find(conversation =>\n      conversation.itemId === item.id && conversation.bidderId === user.id\n    );\n  }, [conversations, item.id, user]);\n  const isAccepted = userBid.status === 'accepted';\n  const canChat = isAccepted && !!acceptedConversation;\n  const canCall = canChat && !!seller.phone;\n\n  const handleChat = (event: React.MouseEvent) => {\n    event.stopPropagation();\n    if (!acceptedConversation) return;\n    router.push(`/inbox?id=${acceptedConversation.id}`);\n  };\n\n  const handleCall = (event: React.MouseEvent) => {\n    event.stopPropagation();\n    if (!seller.phone) return;\n    window.location.href = `tel:${seller.phone}`;\n  };\n\n  return (\n    <>\n      <div \n        onClick={() => setIsModalOpen(true)}\n        className=\"block bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-md transition-shadow cursor-pointer relative\"\n      >\n        {/* Status Badge */}\n        {isAccepted && (\n            <div className=\"absolute top-2 right-2 z-10 bg-green-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm flex items-center gap-1\">\n                <Trophy className=\"w-3 h-3\" />\n                OFFER ACCEPTED\n            </div>\n        )}\n        {!isAccepted && isLeading && (\n           <div className=\"absolute top-2 right-2 z-10 bg-amber-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm flex items-center gap-1\">\n             <Trophy className=\"w-3 h-3\" />\n             HIGHEST BIDDER\n           </div>\n        )}\n        {!isAccepted && isOutbid && (\n           <div className=\"absolute top-2 right-2 z-10 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm flex items-center gap-1 animate-pulse\">\n             <AlertTriangle className=\"w-3 h-3\" />\n             OUTBID\n           </div>\n        )}\n\n        <div className=\"flex p-3 gap-3\">\n          {/* Image */}\n          <div className=\"h-20 w-20 bg-slate-100 rounded-lg overflow-hidden shrink-0\">\n             {item.images[0] && (\n               <img src={item.images[0]} alt={item.title} className=\"w-full h-full object-cover\" />\n             )}\n          </div>\n\n          {/* Content */}\n          <div className=\"flex-1 min-w-0 flex flex-col justify-between\">\n            <div>\n              <div className=\"flex items-start justify-between gap-2\">\n                 <h3 className=\"font-bold text-sm text-slate-900 line-clamp-1\">{item.title}</h3>\n              </div>\n              \n              <div className=\"flex items-center gap-2 mt-1\">\n                  <CategoryBadge category={item.category} className=\"text-[9px] px-1.5 py-0.5\" />\n                  <ConditionBadge condition={item.condition} className=\"text-[9px] px-1.5 py-0.5\" />\n              </div>\n            </div>\n\n            <div className=\"flex items-end justify-between mt-2\">\n               <PriceDisplay \n                  config={biddingConfig}\n                  askPrice={item.askPrice}\n                  bidCount={item.bidCount}\n                  viewMode=\"compact\"\n                  className=\"scale-90 origin-left -ml-1\"\n                  userCurrentBid={userBid.amount}\n               />\n               \n               {/* Time Remaining */}\n               <div className=\"flex items-center gap-1 text-xs font-medium text-slate-500 bg-slate-50 px-1.5 py-0.5 rounded-md border border-slate-100\">\n                  <Clock className=\"w-3 h-3\" />\n                  {getTimeLeft(item.expiryAt)}\n               </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Action Footer (Only for Accepted Deals) */}\n        {isAccepted && (\n            <div className=\"px-3 py-2 bg-green-50 border-t border-green-100 flex items-center justify-between\">\n                <span className=\"text-xs font-bold text-green-700\">Deal Closed! Connect with Seller:</span>\n                <div className=\"flex gap-2\">\n                    {canChat && (\n                        <Button size=\"sm\" variant=\"default\" className=\"h-7 text-xs bg-green-600 hover:bg-green-700\" onClick={handleChat}>\n                            <MessageSquare className=\"w-3 h-3 mr-1\" />\n                            Chat\n                        </Button>\n                    )}\n                     {canCall && (\n                        <Button size=\"sm\" variant=\"outline\" className=\"h-7 text-xs border-green-200 text-green-700 hover:bg-green-100\" onClick={handleCall}>\n                            <Phone className=\"w-3 h-3 mr-1\" />\n                            Call\n                        </Button>\n                    )}\n                </div>\n            </div>\n        )}\n      </div>\n\n      <ProductDetailsModal \n        item={item} \n        seller={seller} \n        isOpen={isModalOpen} \n        onClose={setIsModalOpen} \n      />\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\MyListingsTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\ProfileSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\SellerStats.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\WatchedItemCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\inbox\\ChatWindow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\inbox\\ConversationList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\layout\\BottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\layout\\Navbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\layout\\ScrollToTop.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\layout\\SearchDropdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\layout\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\CategoryBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\FilterSheetContent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\ItemCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\ItemCardSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\ListingBadges.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\LocationSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\MarketplaceGrid.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\PriceSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\ProductDetailsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\SmartFilterBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\product-modal\\BiddingDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2571,2574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2571,2574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { Item, User } from \"@/types\";\nimport { BiddingControls } from \"@/components/common/BiddingControls\";\nimport { Bookmark, ExternalLink } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { MAX_BID_ATTEMPTS } from \"@/lib/bidding\";\nimport { memo, useMemo } from \"react\";\nimport { PriceDisplay } from \"@/components/common/PriceDisplay\";\nimport { createBiddingConfig } from \"@/types/bidding\";\n\ninterface BiddingDashboardProps {\n  item: Item;\n  user: User | null;\n  seller: User;\n  bidAmount: string;\n  userCurrentBid?: number; \n  hasPriorBid: boolean;\n  isSuccess: boolean;\n  isSubmitting: boolean;\n  cooldownRemaining: number;\n  error?: boolean;\n  errorMessage?: string | null;\n  remainingAttempts?: number;\n  pendingConfirmation?: { type: 'double_bid' | 'high_bid' | 'out_of_bids' | 'confirm_bid', message: string } | null;\n  isWatched?: boolean;\n  onToggleWatch?: (id: string) => void;\n  onSmartAdjust: (e: React.MouseEvent, direction: -1 | 1) => void;\n  onBid: (e: React.MouseEvent) => void;\n  onKeyDown: (e: React.KeyboardEvent<HTMLInputElement>) => void;\n  onInputChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\n  onInputBlur?: () => void;\n  derivedStatus?: { type: 'error', message: string } | null;\n}\n\nexport const BiddingDashboard = memo(function BiddingDashboard({\n  item,\n  user,\n  seller,\n  bidAmount,\n  userCurrentBid,\n  hasPriorBid,\n  isSuccess,\n  isSubmitting,\n  cooldownRemaining,\n  error = false,\n  errorMessage = null,\n  remainingAttempts = MAX_BID_ATTEMPTS,\n  pendingConfirmation = null,\n  isWatched,\n  onToggleWatch,\n  onSmartAdjust,\n  onBid,\n  onKeyDown,\n  onInputChange,\n  onInputBlur,\n  derivedStatus = null\n}: BiddingDashboardProps) {\n\n  // Use the standard factory to ensure all required fields are present\n  const biddingConfig = useMemo(() => \n    createBiddingConfig(item, user, []), // Pass empty array if we don't have all bids here, or use approximate\n    [item, user]);\n\n  // Override specific fields if we have more accurate local data\n  const finalConfig = useMemo(() => ({\n      ...biddingConfig,\n      hasUserBid: hasPriorBid,\n      isUserHighBidder: item.currentHighBidderId === user?.id,\n  }), [biddingConfig, hasPriorBid, item.currentHighBidderId, user?.id]);\n\n  const isOwner = user?.id === seller.id;\n\n  return (\n    <div id={`product-details-dashboard-${item.id}`} className=\"w-full h-full min-w-0 rounded-2xl border border-slate-200 bg-slate-50 p-4 flex flex-col justify-between overflow-visible\">\n      \n      <div className=\"mb-2\">\n         <PriceDisplay \n            config={finalConfig as any} // Cast to any to bypass the union type strictness if needed, but should be fine\n            askPrice={item.askPrice}\n            bidCount={item.bidCount}\n            viewMode=\"modal\"\n            orientation=\"stacked\"\n            showTotalBids={true}\n            userCurrentBid={userCurrentBid}\n         />\n      </div>\n\n      <div className=\"mt-1\">\n        <BiddingControls\n          bidAmount={bidAmount}\n          isSuccess={isSuccess}\n          isOwner={isOwner}\n          hasPriorBid={hasPriorBid}\n          isSubmitting={isSubmitting}\n          cooldownRemaining={cooldownRemaining}\n          error={error}\n          errorMessage={errorMessage}\n          remainingAttempts={remainingAttempts}\n          userCurrentBid={userCurrentBid}\n          pendingConfirmation={pendingConfirmation}\n          derivedStatus={derivedStatus}\n          viewMode=\"modal\"\n          idPrefix={`modal-item-card-${item.id}`}\n          onSmartAdjust={onSmartAdjust}\n          onBid={onBid}\n          onKeyDown={onKeyDown}\n          onInputChange={onInputChange}\n          onInputBlur={onInputBlur}\n          showAttemptsDots={false}\n          showStatus={true}\n        />\n      </div>\n\n      <div className=\"md:hidden grid grid-cols-2 gap-3 mt-4\">\n        <Link\n          id={`view-details-btn-mobile-${item.id}`}\n          href={`/product/${item.slug ?? item.id}`}\n          className=\"h-11 flex items-center justify-center rounded-xl bg-slate-900 text-white font-bold text-sm gap-2 active:bg-black active:scale-y-95 transition-all shadow-sm\"\n        >\n          <ExternalLink className=\"h-4 w-4\" />\n          <span>Full Page</span>\n        </Link>\n        \n        {onToggleWatch && (\n          <button\n            id={`toggle-watch-btn-mobile-${item.id}`}\n            onClick={() => onToggleWatch(item.id)}\n            className={`h-11 flex items-center justify-center rounded-xl font-bold text-sm gap-2 active:scale-y-95 transition-all border shadow-sm\n              ${isWatched \n                ? 'bg-blue-50 text-blue-600 border-blue-200 active:bg-blue-100' \n                : 'bg-white text-slate-700 border-slate-200 active:bg-slate-50'\n              }`}\n          >\n            <Bookmark className={`h-4 w-4 ${isWatched ? 'fill-current' : ''}`} />\n            <span>{isWatched ? 'Watched' : 'Watch'}</span>\n          </button>\n        )}\n      </div>\n    </div>\n  );\n});\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\product-modal\\FullscreenGallery.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\product-modal\\ProductGallery.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\product-modal\\ProductInfo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\notifications\\NotificationDropdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\notifications\\NotificationItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\profile\\ProfileCompleteness.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\profile\\ReviewForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\profile\\ReviewList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\profile\\StarRating.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\search\\CategoryNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\search\\SearchBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\search\\SearchFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\search\\SimilarItems.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\seller\\DeleteConfirmationDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\seller\\SellerBidCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\seller\\SellerListingCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\SafeImage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\AuthContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\ChatContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\DashboardContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\MarketplaceContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":583,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":583,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22512,22515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22512,22515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":755,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":755,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28164,28167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28164,28167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { createContext, useContext, useState, useEffect, useMemo, useRef, useCallback } from \"react\";\nimport { Item, Bid } from \"@/types\";\nimport { useAuth } from \"./AuthContext\";\nimport { supabase } from \"@/lib/supabase\";\nimport { transformListingToItem, transformBidToHydratedBid, ListingWithSeller, BidWithProfile } from \"@/lib/transform\";\nimport { generateCacheKey, getFromCache, setCache } from \"@/lib/cache\";\nimport { useBidRealtime } from \"@/hooks/useBidRealtime\";\nimport { sonic } from \"@/lib/sonic\";\nimport type { Database } from \"@/types/database.types\";\nimport { normalize, upsertEntities, upsertEntity, removeEntity } from \"@/lib/store-helpers\";\nimport { useViewport } from \"./ViewportContext\";\n\ninterface MarketplaceFilters {\n\n  category: string | null;\n  search: string;\n  radius: number;\n  locationMode: 'current' | 'city' | 'country';\n  city: string;\n  currentCoords: { lat: number; lng: number } | null;\n  sortBy: 'trending' | 'nearest' | 'ending_soon' | 'luxury' | 'newest' | 'watchlist';\n  minPrice: number | null;\n  maxPrice: number | null;\n  condition: 'new' | 'like_new' | 'used' | 'fair' | 'all';\n  listingType: 'all' | 'public' | 'hidden';\n}\n\ninterface MarketplaceContextType {\n  items: Item[];\n  bids: Bid[];\n  itemsById: Record<string, Item>;\n  bidsById: Record<string, Bid>;\n  feedIds: string[];\n  involvedIds: string[];\n  isLoading: boolean;\n  isLoadingMore: boolean;\n  hasMore: boolean;\n  loadMore: () => void;\n  addItem: (item: Omit<Item, 'id' | 'createdAt' | 'bidCount'>) => void;\n  updateItem: (id: string, updates: Partial<Omit<Item, 'id' | 'createdAt' | 'bidCount'>>) => void;\n  deleteItem: (id: string) => void;\n  placeBid: (itemId: string, amount: number, type: 'public' | 'private') => Promise<boolean>;\n  toggleWatch: (itemId: string) => void;\n  watchedItemIds: string[];\n  rejectBid: (bidId: string) => void;\n  acceptBid: (bidId: string) => Promise<string | undefined>;\n  confirmExchange: (conversationId: string, role: 'buyer' | 'seller') => Promise<boolean>;\n  filters: MarketplaceFilters;\n  setFilter: <K extends keyof MarketplaceFilters>(key: K, value: MarketplaceFilters[K]) => void;\n  updateFilters: (updates: Partial<MarketplaceFilters>) => void;\n  lastBidTimestamp: number | null;\n  setLastBidTimestamp: (ts: number | null) => void;\n  refreshInvolvedItems: () => Promise<void>;\n}\n\nconst MarketplaceContext = createContext<MarketplaceContextType | undefined>(undefined);\n\ntype MarketplaceListingRow = Database['public']['Views']['marketplace_listings']['Row'];\ntype BidInsert = Database['public']['Tables']['bids']['Insert'];\ntype BidUpdate = Database['public']['Tables']['bids']['Update'];\ntype ListingUpdate = Database['public']['Tables']['listings']['Update'];\ntype WatchlistRow = Database['public']['Tables']['watchlist']['Row'];\n\nexport function MarketplaceProvider({ children }: { children: React.ReactNode }) {\n  const { user } = useAuth();\n  const { visibleIds } = useViewport();\n\n  const [itemsById, setItemsById] = useState<Record<string, Item>>({});\n  const [bidsById, setBidsById] = useState<Record<string, Bid>>({});\n  const [feedIds, setFeedIds] = useState<string[]>([]);\n  const [involvedIds, setInvolvedIds] = useState<string[]>([]);\n  const [watchedItemIds, setWatchedItemIds] = useState<string[]>([]);\n  \n  // Refs for stable callback access to frequently-changing state\n  // This prevents recreating 11+ functions on every state change\n  const itemsByIdRef = useRef(itemsById);\n  const bidsByIdRef = useRef(bidsById);\n  const watchedItemIdsRef = useRef(watchedItemIds);\n\n  useEffect(() => { itemsByIdRef.current = itemsById; }, [itemsById]);\n  useEffect(() => { bidsByIdRef.current = bidsById; }, [bidsById]);\n  \n  // Fix: Use ref to access latest watchlist in fetchItems without triggering re-fetch loop\n  useEffect(() => {\n    watchedItemIdsRef.current = watchedItemIds;\n  }, [watchedItemIds]);\n\n  // Derived arrays for backward compatibility\n  const items = useMemo(() => feedIds.map(id => itemsById[id]).filter(Boolean), [feedIds, itemsById]);\n  const bids = useMemo(() => Object.values(bidsById), [bidsById]);\n\n  // Combined IDs for realtime subscription (Participation + Viewport)\n  const activeIds = useMemo(() => {\n    const combined = new Set(visibleIds);\n    involvedIds.forEach(id => combined.add(id));\n    return combined;\n  }, [visibleIds, involvedIds]);\n\n\n  const [isLoading, setIsLoading] = useState(true);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  const [page, setPage] = useState(1);\n  const [hasMore, setHasMore] = useState(true);\n  const [lastBidTimestamp, setLastBidTimestamp] = useState<number | null>(null);\n  const loadingLockRef = React.useRef(false);\n  const ITEMS_PER_PAGE = 8;\n\n  const [filters, setFilters] = useState<MarketplaceFilters>({\n    category: null,\n    search: \"\",\n    radius: 500,\n    locationMode: 'country',\n    city: 'Karachi',\n    currentCoords: null,\n    sortBy: 'trending',\n    minPrice: null,\n    maxPrice: null,\n    condition: 'all',\n    listingType: 'all',\n  });\n\n  // --- HELPER FUNCTIONS ---\n  // Note: Geolocation helper functions kept if needed for future hybrid sorting, \n  // though primary filtering is now Server-Side where possible.\n  \n  const fetchItems = useCallback(async (targetPage: number, reset: boolean = false) => {\n      if (loadingLockRef.current) return;\n      loadingLockRef.current = true;\n      \n      const cacheKey = generateCacheKey('marketplace', { ...filters, page: targetPage });\n      let usedCache = false;\n\n      // --- 1. CHECK CACHE (L1/L2) ---\n      if (reset) {\n          const { data: cachedItems, isStale } = await getFromCache<Item[]>(cacheKey);\n          \n          if (cachedItems) {\n              setItemsById(prev => upsertEntities(prev, cachedItems));\n              setFeedIds(cachedItems.map(i => i.id));\n              setHasMore(cachedItems.length === ITEMS_PER_PAGE);\n              setIsLoading(false);\n              usedCache = true;\n              \n              if (!isStale) {\n                  loadingLockRef.current = false;\n                  return;\n              }\n          }\n      }\n\n\n      if (!usedCache) {\n          if (reset) {\n              setIsLoading(true);\n          } else {\n              setIsLoadingMore(true);\n          }\n      }\n\n        try {\n            // PHASE 4: Use 'marketplace_listings' Master View for server-side aggregation\n            // This replaces the raw 'listings' fetch + 'profiles' join + separate 'bids' fetch\n            let query = supabase.from('marketplace_listings').select(`\n                id,\n                title,\n                description,\n                images,\n                seller_id,\n                asked_price,\n                category,\n                auction_mode,\n                created_at,\n                ends_at,\n                search_vector,\n                status,\n                seller_name,\n                seller_avatar,\n                seller_rating,\n                seller_rating_count,\n                seller_location,\n                bid_count,\n                high_bid,\n                high_bidder_id,\n                condition,\n                slug\n            `, { count: 'exact' }).eq('status', 'active');\n\n            // --- APPLY FILTERS ---\n          if (filters.category && filters.category !== \"All Items\") {\n              query = query.eq('category', filters.category);\n          }\n\n          if (filters.search) {\n              const searchTerm = `%${filters.search}%`;\n              query = query.or(`title.ilike.${searchTerm},description.ilike.${searchTerm}`);\n          }\n\n          if (filters.minPrice !== null) {\n              query = query.gte('asked_price', filters.minPrice);\n          }\n          if (filters.maxPrice !== null) {\n              query = query.lte('asked_price', filters.maxPrice);\n          }\n          \n          if (filters.condition && filters.condition !== 'all') {\n              query = query.eq('condition', filters.condition);\n          }\n\n\n          if (filters.listingType === 'public') {\n              query = query.eq('auction_mode', 'visible');\n          } else if (filters.listingType === 'hidden') {\n               // Match 'hidden' primarily, keeping 'sealed' as fallback for any legacy records\n               query = query.in('auction_mode', ['hidden', 'sealed']);\n          } // 'all' does nothing\n\n           // --- APPLY SORT ---\n           switch (filters.sortBy) {\n              case 'trending': \n                  // Sort by bid_count (popularity), then by created_at (freshness)\n                  query = query.order('bid_count', { ascending: false })\n                               .order('created_at', { ascending: false });\n                  break;\n              \n              case 'newest':\n                  // Fix: Explicitly sort by date to prevent fall-through to luxury\n                  query = query.order('created_at', { ascending: false });\n                  break;\n\n              case 'luxury':\n                  query = query.order('asked_price', { ascending: false });\n                  break;\n\n              case 'watchlist':\n                   // Fix: Filter by watched IDs using Ref to avoid dependency loop\n                   const currentWatchedIds = watchedItemIdsRef.current;\n                   if (currentWatchedIds.length > 0) {\n                       query = query.in('id', currentWatchedIds);\n                   } else {\n                       // Return no results if watchlist is empty\n                       query = query.eq('id', '00000000-0000-0000-0000-000000000000');\n                   }\n                   query = query.order('created_at', { ascending: false });\n                   break;\n\n              case 'ending_soon':\n                  // Sort by ends_at ascending (soonest first)\n                  // Note: 'ends_at' is available in the marketplace_listings view\n                  query = query.order('ends_at', { ascending: true });\n                  break;\n\n              case 'nearest':\n                  // Fallback: Default to newest until PostGIS is implemented\n                  query = query.order('created_at', { ascending: false });\n                  break;\n\n              default:\n                  query = query.order('created_at', { ascending: false });\n           }\n\n           // --- PAGINATION ---\n           const from = (targetPage - 1) * ITEMS_PER_PAGE;\n           const to = from + ITEMS_PER_PAGE - 1;\n           query = query.range(from, to);\n\n           const { data: listingsData, error: listingsError, count } = await query;\n\n           if (listingsError) throw listingsError;\n\n           let fetchedItems: Item[] = [];\n            if (listingsData) {\n                fetchedItems = listingsData.map((row: MarketplaceListingRow) => transformListingToItem(row as unknown as ListingWithSeller));\n            }\n\n           // --- CLIENT-SIDE SORTING OVERRIDES ---\n           // If 'watchlist' sort is selected, we might need to fetch more or re-sort client side \n           // since we can't easily join user specific watchlist state in simple query.\n\n            // --- UPDATE STATE ---\n            if (reset) {\n                setItemsById(prev => upsertEntities(prev, fetchedItems));\n                setFeedIds(fetchedItems.map(i => i.id));\n                setCache(cacheKey, fetchedItems);\n            } else {\n                setItemsById(prev => upsertEntities(prev, fetchedItems));\n                setFeedIds(prev => {\n                    const existingIds = new Set(prev);\n                    const trulyNewIds = fetchedItems.map(i => i.id).filter(id => !existingIds.has(id));\n                    return [...prev, ...trulyNewIds];\n                });\n                setCache(cacheKey, fetchedItems);\n            }\n\n           \n           if (count !== null) {\n               setHasMore((targetPage * ITEMS_PER_PAGE) < count);\n           } else {\n               // Fallback if count is missing (shouldn't happen with count: 'exact')\n               setHasMore(fetchedItems.length === ITEMS_PER_PAGE);\n           }\n\n       } catch (err: unknown) {\n           console.error(\"Fetch Items Error:\", err);\n           if (err && typeof err === 'object') {\n              console.error(\"Fetch Items Error Details:\", JSON.stringify(err, null, 2));\n           }\n       } finally {\n          setIsLoading(false);\n          setIsLoadingMore(false);\n          loadingLockRef.current = false;\n      }\n  }, [filters, ITEMS_PER_PAGE]);\n\n  // --- EFFECT: Trigger Fetch on Filter Change ---\n  useEffect(() => {\n      setPage(1);\n      // Removed 500ms debounce - category/sort changes should be instant\n      fetchItems(1, true);\n  }, [fetchItems]);\n\n  // --- Realtime Subscription (Bids) ---\n  const handleRealtimeBid = useCallback((newBid: Bid) => {\n      // Play sound if someone ELSE bids on an item the user is watching\n      // Use ref to avoid re-subscription on watchlist toggle\n      if (user && newBid.bidderId !== user.id && watchedItemIdsRef.current.includes(newBid.itemId)) {\n          sonic.tick(); // Subtle notification\n      }\n\n      setBidsById(prev => {\n          // Regression Guard: Protect optimistic state\n          // If our local optimistic update is ahead of the server echo (due to latency/cache),\n          // preserve the higher local count so beads don't flicker/reset.\n          const existing = prev[newBid.id];\n          if (existing) {\n              const localCount = existing.update_count || 0;\n              const serverCount = newBid.update_count || 0;\n              \n              if (localCount > serverCount) {\n                  // Keep our local optimistic count\n                  newBid.update_count = localCount;\n              }\n          }\n          return upsertEntity(prev, newBid);\n      });\n\n      setItemsById(prevItems => {\n        const item = prevItems[newBid.itemId];\n        if (!item) return prevItems;\n\n        const currentMax = item.currentHighBid || 0;\n        const isNewHigh = newBid.amount > currentMax;\n        const isSameHighBidder = item.currentHighBidderId === newBid.bidderId;\n\n        const updatedItem = {\n           ...item,\n           bidCount: isSameHighBidder ? item.bidCount : item.bidCount + 1,\n           currentHighBid: (isNewHigh || isSameHighBidder) ? newBid.amount : currentMax,\n           currentHighBidderId: (isNewHigh || isSameHighBidder) ? newBid.bidderId : item.currentHighBidderId\n        };\n\n        return upsertEntity(prevItems, updatedItem);\n      });\n  }, [user]);\n\n  useBidRealtime(handleRealtimeBid, activeIds, user?.id);\n\n  const loadMore = useCallback(() => {\n      // Prevent loading more if initial load is processing (isLoading)\n      if (isLoading || isLoadingMore || !hasMore || loadingLockRef.current) return;\n      const nextPage = page + 1;\n      setPage(nextPage);\n      fetchItems(nextPage, false);\n  }, [isLoading, isLoadingMore, hasMore, page, fetchItems]);\n\n  const addItem = useCallback((newItem: Omit<Item, 'id' | 'createdAt' | 'bidCount'>) => {\n    console.log(\"addItem - logic pending refactor in selling phase\", newItem);\n  }, []);\n\n  const updateItem = useCallback(async (id: string, updates: Partial<Omit<Item, 'id' | 'createdAt' | 'bidCount'>>) => {\n     const dbUpdates: ListingUpdate = {};\n     if (updates.status) dbUpdates.status = updates.status;\n     if (updates.title) dbUpdates.title = updates.title;\n\n      const { error } = await supabase\n        .from('listings')\n        .update(dbUpdates)\n        .eq('id', id);\n     \n     if (error) {\n         console.error(\"Failed to update item:\", error);\n     } else {\n         setItemsById(prev => {\n            if (!prev[id]) return prev;\n            return upsertEntity(prev, { ...prev[id], ...updates });\n         });\n     }\n  }, []);\n\n  const deleteItem = useCallback(async (id: string) => {\n    const { error } = await supabase\n      .from('listings')\n      .delete()\n      .eq('id', id);\n\n    if (error) {\n        console.error(\"Failed to delete item:\", error);\n    } else {\n        setItemsById(prev => removeEntity(prev, id));\n        setFeedIds(prev => prev.filter(fid => fid !== id));\n        setInvolvedIds(prev => prev.filter(iid => iid !== id));\n    }\n  }, []);\n\n\n  const placeBid = useCallback(async (itemId: string, amount: number, type: 'public' | 'private'): Promise<boolean> => {\n    if (!user) {\n        console.error(\"Must be logged in to bid\");\n        return false;\n    }\n    \n    // Note: Validation (70% minimum, etc.) is already done in useBidding hook\n    // We just need to insert into database and update local state\n    \n    // Find item if available (may not be in current filtered view)\n    const originalItem = itemsByIdRef.current[itemId];\n    const existingBid = bidsByIdRef.current[`${itemId}-${user.id}`] || Object.values(bidsByIdRef.current).find(b => b.itemId === itemId && b.bidderId === user.id);\n    \n    // --- OPTIMISTIC UPDATE START ---\n    // 1. Create a temporary bid object\n    const optimisticBid: Bid = {\n        id: existingBid ? existingBid.id : `temp-${Date.now()}`,\n        itemId: itemId,\n        bidderId: user.id,\n        amount: amount,\n        status: 'pending',\n        message: type === 'private' ? 'Private Bid' : 'Public Bid',\n        createdAt: new Date().toISOString(),\n        bidder: user,\n        update_count: existingBid ? (existingBid.update_count || 0) + 1 : 0\n    } as unknown as Bid;\n\n    // 2. Update local Bids state\n    setBidsById(prev => upsertEntity(prev, optimisticBid));\n\n    // 3. Update local Items state\n    if (originalItem) {\n        const currentMax = originalItem.currentHighBid || 0;\n        const isNewHigh = amount > currentMax;\n        const updatedItem = {\n            ...originalItem,\n            bidCount: originalItem.bidCount + 1,\n            currentHighBid: isNewHigh ? amount : currentMax,\n            currentHighBidderId: isNewHigh ? user.id : originalItem.currentHighBidderId\n        };\n        setItemsById(prev => upsertEntity(prev, updatedItem));\n    }\n    // --- OPTIMISTIC UPDATE END ---\n\n\n    // Use UPSERT to handle the unique constraint on (listing_id, bidder_id)\n    // This allows users to update their existing bid instead of creating duplicates\n    const bidPayload: BidInsert = {\n      listing_id: itemId,\n      bidder_id: user.id,\n      amount: amount,\n      message: type === 'private' ? 'Private Bid' : 'Public Bid',\n      status: 'pending'\n    };\n\n    // Debug: Check auth state before making the call\n    const { data: sessionData } = await supabase.auth.getSession();\n    console.log('[placeBid] Auth state:', {\n      hasSession: !!sessionData.session,\n      authUid: sessionData.session?.user?.id,\n      appUserId: user.id,\n      idsMatch: sessionData.session?.user?.id === user.id\n    });\n\n    const { data, error } = await supabase\n      .from('bids')\n      .upsert(bidPayload, { onConflict: 'listing_id,bidder_id' })\n      .select();\n    \n    console.log('[placeBid] Supabase response:', { dataLength: data?.length, error, data });\n\n    // Only trust the bid when Supabase confirms it.\n    if (error || !data || data.length === 0) {\n        console.error(\"Failed to place bid:\", {\n            message: error?.message || 'No data returned',\n            details: error?.details,\n            hint: error?.hint,\n            dataLength: data?.length\n        });\n        \n        // Handle Server-Level Cooldown Error\n        if (error?.message?.includes('COOLDOWN_ACTIVE')) {\n           setLastBidTimestamp(Date.now());\n        }\n\n        // Rollback optimistic bids update\n        setBidsById(prev => {\n             if (existingBid) {\n                 return upsertEntity(prev, existingBid);\n             }\n             return removeEntity(prev, optimisticBid.id);\n        });\n        // Rollback items update if we modified it\n        if (originalItem) {\n            setItemsById(prev => upsertEntity(prev, originalItem));\n        }\n\n        return false;\n    }\n    \n    // Add to involved and watchlist on success\n    setInvolvedIds(prev => Array.from(new Set([...prev, itemId])));\n    if (!watchedItemIdsRef.current.includes(itemId)) {\n         setWatchedItemIds(prev => [...prev, itemId]);\n         // Persist to database\n         supabase\n             .from('watchlist')\n             .insert({ user_id: user.id, listing_id: itemId })\n             .then(({ error }) => {\n                 if (error) console.error(\"Auto-add to watchlist failed:\", error);\n             });\n    }\n    \n    // Set global cooldown timestamp\n    setLastBidTimestamp(Date.now());\n    \n    return true;\n  }, [user]);\n\n  // --- EFFECT: Fetch User Bids on Mount/User Change ---\n  useEffect(() => {\n    if (!user) {\n        setBidsById({});\n        return;\n    }\n\n    const fetchUserBids = async () => {\n        // Fetch bids relevant to the user:\n        // 1. Bids the user has placed (as a buyer)\n        // 2. Bids placed on the user's listings (as a seller)\n        // We split these into two queries for maximum reliability and better performance\n        try {\n            const [myBidsRes, incomingBidsRes] = await Promise.all([\n                // Bids I made\n                supabase\n                    .from('bids')\n                    .select('*, profiles(*)')\n                    .eq('bidder_id', user.id),\n                // Bids on my items\n                supabase\n                    .from('bids')\n                    .select('*, profiles(*), listings!inner(seller_id)')\n                    .eq('listings.seller_id', user.id)\n            ]);\n\n            if (myBidsRes.error) throw myBidsRes.error;\n            if (incomingBidsRes.error) throw incomingBidsRes.error;\n\n            const allBidsRaw = [...(myBidsRes.data || []), ...(incomingBidsRes.data || [])];\n            \n            // Deduplicate by ID\n            const uniqueBidsMap = new Map();\n            allBidsRaw.forEach(bid => uniqueBidsMap.set(bid.id, bid));\n            const uniqueBids = Array.from(uniqueBidsMap.values());\n\n            // Transform and hydrate\n            const hydratedBids = uniqueBids.map(b => transformBidToHydratedBid(b as unknown as BidWithProfile));\n            setBidsById(normalize(hydratedBids));\n\n            // Sync lastBidTimestamp from server history for accurate cooldowns\n            const myBids = hydratedBids.filter(b => b.bidderId === user.id);\n            if (myBids.length > 0) {\n                // Find the most recent bid timestamp\n                const latestBidTime = Math.max(...myBids.map(b => new Date(b.createdAt).getTime()));\n                setLastBidTimestamp(latestBidTime);\n            }\n        } catch (err: any) {\n            console.error(\"Error fetching user bids:\", err.message || err);\n        }\n    };\n\n    fetchUserBids();\n  }, [user]);\n\n  // --- EFFECT: Fetch Watchlist on Mount/User Change ---\n  useEffect(() => {\n    if (!user) {\n        setWatchedItemIds([]);\n        return;\n    }\n\n    const fetchWatchlist = async () => {\n        const { data, error } = await supabase\n            .from('watchlist')\n            .select('listing_id')\n            .eq('user_id', user.id);\n        \n        if (error) {\n            console.error(\"Error fetching watchlist:\", error);\n        } else if (data) {\n            const ids = (data as WatchlistRow[])\n              .map((row) => row.listing_id)\n              .filter((id): id is string => !!id);\n            setWatchedItemIds(ids);\n        }\n    };\n\n    fetchWatchlist();\n  }, [user]);\n\n\n  const toggleWatch = useCallback(async (itemId: string) => {\n    if (!user) {\n        // UI fallback only? Or prompt login? For now just local until refresh or login check\n        console.warn(\"User not logged in, watchlist is local-only temporarily\");\n        setWatchedItemIds(prev => \n          prev.includes(itemId) ? prev.filter(id => id !== itemId) : [...prev, itemId]\n        );\n        return;\n    }\n\n    const isWatched = watchedItemIdsRef.current.includes(itemId);\n    \n    // Optimistic Update\n    setWatchedItemIds(prev => \n      prev.includes(itemId) ? prev.filter(id => id !== itemId) : [...prev, itemId]\n    );\n\n    if (isWatched) {\n        // Remove\n        const { error } = await supabase\n            .from('watchlist')\n            .delete()\n            .match({ user_id: user.id, listing_id: itemId });\n        \n        if (error) {\n            console.error(\"Failed to remove from watchlist:\", error);\n            // Rollback\n            setWatchedItemIds(prev => [...prev, itemId]);\n        } else {\n            // Check if we should remove from involvedIds (only if no bid)\n            const hasBid = Object.values(bidsByIdRef.current).some(b => b.itemId === itemId && b.bidderId === user.id);\n            if (!hasBid) {\n                setInvolvedIds(prev => prev.filter(id => id !== itemId));\n            }\n        }\n    } else {\n        // Add\n        const { error } = await supabase\n            .from('watchlist')\n            .insert({ user_id: user.id, listing_id: itemId });\n            \n          if (error) {\n            console.error(\"Failed to add to watchlist:\", error);\n             // Rollback\n             setWatchedItemIds(prev => prev.filter(id => id !== itemId));\n        } else {\n            setInvolvedIds(prev => Array.from(new Set([...prev, itemId])));\n        }\n    }\n\n  }, [user]);\n\n  const setFilter = useCallback(<K extends keyof MarketplaceFilters>(key: K, value: MarketplaceFilters[K]) => {\n    setFilters(prev => ({ ...prev, [key]: value }));\n  }, []);\n\n  const updateFilters = useCallback((updates: Partial<MarketplaceContextType['filters']>) => {\n    setFilters(prev => ({ ...prev, ...updates }));\n  }, []);\n\n  const rejectBid = useCallback(async (bidId: string) => {\n      const bidUpdates: BidUpdate = { status: 'ignored' };\n      const { error } = await supabase\n        .from('bids')\n        .update(bidUpdates)\n        .eq('id', bidId);\n      if (error) console.error(\"Failed to reject bid\", error);\n      else setBidsById(prev => {\n          if (!prev[bidId]) return prev;\n          return upsertEntity(prev, { ...prev[bidId], status: 'ignored' });\n      });\n  }, []);\n\n  const acceptBid = useCallback(async (bidId: string) => {\n      const bidUpdates: BidUpdate = { status: 'accepted' };\n      const { error } = await supabase\n        .from('bids')\n        .update(bidUpdates)\n        .eq('id', bidId);\n      if (error) return undefined;\n      setBidsById(prev => {\n          if (!prev[bidId]) return prev;\n          return upsertEntity(prev, { ...prev[bidId], status: 'accepted' });\n      });\n      return bidId;\n  }, []);\n\n\n  const confirmExchange = useCallback(async (conversationId: string, role: 'buyer' | 'seller') => {\n    if (!user) return false;\n\n    const timestamp = new Date().toISOString();\n    const update: Database['public']['Tables']['conversations']['Update'] = role === 'seller' \n        ? { seller_confirmed_at: timestamp } \n        : { buyer_confirmed_at: timestamp };\n\n    const { error } = await supabase\n        .from('conversations')\n        .update(update)\n        .eq('id', conversationId);\n        \n    if (error) {\n        console.error(\"Failed to confirm exchange:\", error);\n        return false;\n    }\n    return true;\n  }, [user]);\n\n  const refreshInvolvedItems = React.useCallback(async () => {\n    if (!user) return;\n\n    try {\n      // Fetch item IDs from bids and watchlist\n      const [bidsRes, watchlistRes] = await Promise.all([\n        supabase.from('bids').select('listing_id').eq('bidder_id', user.id),\n        supabase.from('watchlist').select('listing_id').eq('user_id', user.id)\n      ]);\n\n      const bidItemIds = (bidsRes.data || []).map(b => b.listing_id).filter((id): id is string => !!id);\n      const watchlistIds = (watchlistRes.data || []).map(w => w.listing_id).filter((id): id is string => !!id);\n      \n      const allInvolvedIds = Array.from(new Set([...bidItemIds, ...watchlistIds]));\n      \n      if (allInvolvedIds.length === 0) {\n        setInvolvedIds([]);\n        return;\n      }\n\n      // Fetch full item details for these IDs\n      const { data, error } = await supabase\n        .from('marketplace_listings')\n        .select('*')\n        .in('id', allInvolvedIds);\n\n      if (error) throw error;\n\n      if (data) {\n        const transformedItems = data.map(row => transformListingToItem(row as any));\n        setItemsById(prev => upsertEntities(prev, transformedItems));\n        setInvolvedIds(allInvolvedIds);\n      }\n    } catch (err) {\n      console.error(\"Error refreshing involved items:\", err);\n    }\n  }, [user]);\n\n  // Initial fetch of involved items\n  useEffect(() => {\n    refreshInvolvedItems();\n  }, [refreshInvolvedItems]);\n\n  const contextValue = useMemo<MarketplaceContextType>(() => ({\n    items, bids, itemsById, bidsById, feedIds, involvedIds,\n    isLoading, isLoadingMore, hasMore, loadMore, addItem,\n    updateItem, deleteItem, placeBid, toggleWatch, watchedItemIds,\n    rejectBid, acceptBid, confirmExchange, filters, setFilter,\n    updateFilters, lastBidTimestamp, setLastBidTimestamp, refreshInvolvedItems\n  }), [\n    items, bids, itemsById, bidsById, feedIds, involvedIds,\n    isLoading, isLoadingMore, hasMore, watchedItemIds, filters, lastBidTimestamp,\n    // All functions now stable via useCallback\n    loadMore, addItem, updateItem, deleteItem, placeBid, toggleWatch,\n    rejectBid, acceptBid, confirmExchange, setFilter, updateFilters,\n    setLastBidTimestamp, refreshInvolvedItems\n  ]);\n\n  return (\n    <MarketplaceContext.Provider value={contextValue}>\n      {children}\n    </MarketplaceContext.Provider>\n  );\n}\n\n\nexport function useMarketplace() {\n  const context = useContext(MarketplaceContext);\n  if (context === undefined) {\n    throw new Error('useMarketplace must be used within a MarketplaceProvider');\n  }\n  return context;\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\NotificationContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\ReviewContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\SearchContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\TimeContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\ViewportContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useBidRealtime.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useBidding.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useIntersectionObserver.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useReducedMotion.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useReducedMotion.ts:15:5\n  13 |   useEffect(() => {\n  14 |     const mediaQuery = window.matchMedia(\"(prefers-reduced-motion: reduce)\");\n> 15 |     setPrefersReducedMotion(mediaQuery.matches);\n     |     ^^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  16 |\n  17 |     const handleChange = (event: MediaQueryListEvent) => {\n  18 |       setPrefersReducedMotion(event.matches);","line":15,"column":5,"nodeType":null,"endLine":15,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\n\r\n/**\r\n * Hook that detects user's motion preference (prefers-reduced-motion).\r\n * Returns true if user prefers reduced motion, false otherwise.\r\n * SSR-safe: defaults to false during hydration.\r\n */\r\nexport function useReducedMotion(): boolean {\r\n  const [prefersReducedMotion, setPrefersReducedMotion] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const mediaQuery = window.matchMedia(\"(prefers-reduced-motion: reduce)\");\r\n    setPrefersReducedMotion(mediaQuery.matches);\r\n\r\n    const handleChange = (event: MediaQueryListEvent) => {\r\n      setPrefersReducedMotion(event.matches);\r\n    };\r\n\r\n    mediaQuery.addEventListener(\"change\", handleChange);\r\n    return () => mediaQuery.removeEventListener(\"change\", handleChange);\r\n  }, []);\r\n\r\n  return prefersReducedMotion;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useTrackVisibility.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\bidding.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\cache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\cardSizes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\constants\\locations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\locations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\notifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\profileScore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\realtime-dom.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\searchUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\sonic.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\store-helpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\store.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has missing dependencies: 'isMarketplaceFilterKey' and 'searchKeyMap'. Either include them or remove the dependency array.","line":138,"column":6,"nodeType":"ArrayExpression","endLine":138,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [isMarketplaceFilterKey, marketplace, search, searchKeyMap]","fix":{"range":[4839,4860],"text":"[isMarketplaceFilterKey, marketplace, search, searchKeyMap]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { useMemo, useCallback } from 'react';\nimport { useAuth, AuthProvider } from '@/context/AuthContext';\nimport { useMarketplace, MarketplaceProvider } from '@/context/MarketplaceContext';\nimport { useChat, ChatProvider } from '@/context/ChatContext';\nimport { TimeProvider, useTime } from '@/context/TimeContext';\nimport { useSearch, SearchProvider } from '@/context/SearchContext';\nimport { useReviews, ReviewProvider } from '@/context/ReviewContext';\nimport { ViewportProvider } from '@/context/ViewportContext';\n\n/* \n  LEGACY COMPATIBILITY LAYER\n  This component now just aggregates the specific providers.\n  The `useApp` hook aggregates the specific hooks to maintain API compatibility\n  so we don't have to refactor every single component file immediately.\n*/\n\n\n\n\n\nexport function AppProvider({ children }: { children: React.ReactNode }) {\n  // We nest them carefully:\n  // 1. Time (Global lowest level)\n  // 2. Auth (User session needed for data)\n  // 3. Marketplace & Chat & Search (Depend on Auth)\n  \n  return (\n    <TimeProvider>\n      <ViewportProvider>\n        <AuthProvider>\n          <SearchProvider>\n            <MarketplaceProvider>\n              <ChatProvider>\n                <ReviewProvider>\n                  {children}\n                </ReviewProvider>\n              </ChatProvider>\n            </MarketplaceProvider>\n          </SearchProvider>\n        </AuthProvider>\n      </ViewportProvider>\n    </TimeProvider>\n  );\n}\n\n// Re-export the legacy hook that combines everything\nexport function useApp() {\n  const auth = useAuth();\n  const marketplace = useMarketplace();\n  const search = useSearch();\n\n  const chat = useChat();\n  const time = useTime();\n  const reviews = useReviews();\n\n  // Combine relevant methods to match the old interface\n  // Note: 'acceptBid' in the old store did two things (update bid + start conv).\n  // The new 'acceptBid' in MarketplaceContext only updates bid.\n  // We patch it here for backward compatibility.\n  \n  const acceptBidCompat = useCallback(async (bidId: string) => {\n    await marketplace.acceptBid(bidId);\n    \n    // Find the bid to get details for conversation\n    const bid = marketplace.bids.find(b => b.id === bidId);\n    if (!bid) return undefined;\n    \n    // Find item\n    const item = marketplace.items.find(i => i.id === bid.itemId);\n    if (!item) return undefined;\n\n    // Start conversation via ChatContext\n    const convId = await chat.startConversation(bidId, bid.itemId, bid.bidderId, item.sellerId);\n\n    // 3-Chat Rule: Hide listing if 3rd chat is unlocked\n    // Count unique conversations for this item\n    // We filter from 'chat.conversations' which contains all chats for this user (Seller)\n    const activeChats = chat.conversations.filter(c => c.itemId === item.id);\n    \n    // Safety check: Ensure we count the new one if not yet in state\n    const isNew = !activeChats.some(c => c.bidderId === bid.bidderId);\n    const count = activeChats.length + (isNew ? 1 : 0);\n\n    if (count >= 3 && item.status !== 'hidden') {\n        // Auto-hide the listing\n        await marketplace.updateItem(item.id, { status: 'hidden' });\n    }\n\n    return convId;\n  }, [marketplace, chat]);\n\n  type MarketplaceFilters = typeof marketplace.filters;\n  type MarketplaceFilterKey = keyof MarketplaceFilters;\n  type SearchFilters = typeof search.filters;\n  type SearchFilterKey = keyof SearchFilters;\n  const marketplaceFilterKeys: MarketplaceFilterKey[] = [\n    'category',\n    'search',\n    'minPrice',\n    'maxPrice',\n    'sortBy',\n    'listingType',\n    'condition',\n    'radius'\n  ];\n  const searchKeyMap: Partial<Record<MarketplaceFilterKey, SearchFilterKey>> = {\n    search: 'query',\n    category: 'category',\n    minPrice: 'minPrice',\n    maxPrice: 'maxPrice',\n    sortBy: 'sortBy',\n    condition: 'condition'\n  };\n  const isMarketplaceFilterKey = (key: string): key is MarketplaceFilterKey =>\n    marketplaceFilterKeys.includes(key as MarketplaceFilterKey);\n\n  const setFilterCompat = useCallback((key: string, value: unknown) => {\n      // Update Marketplace Context\n      // Fix: Added 'radius' to allowed keys so location slider works\n      if (isMarketplaceFilterKey(key)) {\n        marketplace.setFilter(key, value as MarketplaceFilters[typeof key]);\n      }\n\n      // Update Search Context if it's a shared filter\n      const searchKey = searchKeyMap[key as MarketplaceFilterKey];\n      if (searchKey) {\n        let searchValue = value as SearchFilters[typeof searchKey];\n        if (searchKey === 'sortBy') {\n          // Map Marketplace Sorts to Search Sorts\n          if (value === 'luxury') searchValue = 'price_high';\n          if (value === 'trending') searchValue = 'newest';\n          if (value === 'watchlist') return; // Not supported in search\n        }\n        search.updateFilter(searchKey, searchValue);\n      }\n  }, [marketplace, search]);\n\n  return useMemo(() => ({\n    ...auth,\n    ...marketplace,\n    items: marketplace.items,\n    bids: marketplace.bids,\n    itemsById: marketplace.itemsById,\n    bidsById: marketplace.bidsById,\n    involvedIds: marketplace.involvedIds,\n    ...chat,\n    ...reviews,\n    searchState: search, // Avoid name collision if any, or just spread?\n    // Spreading might conflict with 'filters' in marketplace.\n    // Let's namespace search or check if conflicts exist.\n    // marketplace has 'filters' property. search has 'filters' property. CONFLICT.\n    // We should probably NOT spread 'search' blindly if it conflicts.\n    // Providing 'search' as a sub-object is safer.\n    search: search,\n    \n    now: time.now, // Keep for legacy but we should move away\n    time: time, // Expose raw time context if needed\n    acceptBid: acceptBidCompat, // Override with composite function\n    isLoading: auth.isLoading, // Stability Fix: Navbar should only load on AUTH check, not marketplace fetches\n    isMarketplaceLoading: marketplace.isLoading, // Expose specific loading state if needed\n    \n    // Override setFilter to sync both contexts for shared filters\n    setFilter: setFilterCompat\n  }), [auth, marketplace, search, chat, time, reviews, acceptBidCompat, setFilterCompat]);\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\supabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\transform.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1577,1580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1577,1580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1644,1647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1644,1647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5578,5581],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5578,5581],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6595,6598],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6595,6598],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6652,6655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6652,6655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6700,6703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6700,6703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Database } from '@/types/database.types';\nimport { Item, User, Bid, Conversation } from '@/types';\n\ntype ListingRow = Database['public']['Tables']['listings']['Row'];\ntype ProfileRow = Database['public']['Tables']['profiles']['Row'];\n\nimport { CITY_COORDINATES } from './locations';\n\n// We need a joined type because we will fetch listings with their sellers\nexport type ListingWithSeller = ListingRow & {\n  profiles?: ProfileRow | null;\n  \n  // Fields from 'marketplace_listings' view\n  seller_name?: string | null;\n  seller_avatar?: string | null;\n  seller_rating?: number | null;\n  seller_rating_count?: number | null;\n  seller_location?: string | null;\n  \n  bid_count?: number | null;\n  high_bid?: number | null;\n  high_bidder_id?: string | null;\n  \n  slug?: string | null;\n};\n\nexport function transformProfileToUser(profile: ProfileRow): User {\n  const cityCoords = profile.location ? CITY_COORDINATES[profile.location] : null;\n  \n  return {\n    id: profile.id,\n    name: profile.full_name || 'Anonymous',\n    avatar: profile.avatar_url || 'https://api.dicebear.com/7.x/avataaars/svg?seed=' + profile.id,\n    rating: profile.rating || 0,\n    reviewCount: profile.rating_count || 0,\n    location: {\n      lat: cityCoords?.lat || 24.8607, // Default to Karachi if unknown\n      lng: cityCoords?.lng || 67.0011,\n      address: profile.location || 'Karachi' // Default to Karachi instead of 'Unknown' for better UI\n    },\n    isVerified: false,\n    badges: [],\n    stats: {\n      bidsAcceptedByMe: 0,\n      myBidsAccepted: 0\n    },\n    sellerSuccessRate: (profile as any).seller_success_rate ?? 100,\n    buyerSuccessRate: (profile as any).buyer_success_rate ?? 100\n  };\n}\n\nexport function transformListingToItem(listing: ListingWithSeller): Item {\n  // Handle both nested 'profiles' (legacy join) and flat 'seller_*' (view)\n  let seller: User | undefined;\n\n  if (listing.profiles) {\n      seller = transformProfileToUser(listing.profiles);\n  } else if (listing.seller_name || listing.seller_id) {\n      // Reconstruct User from flat view columns\n      const cityCoords = listing.seller_location ? CITY_COORDINATES[listing.seller_location] : null;\n      seller = {\n          id: listing.seller_id || 'unknown',\n          name: listing.seller_name || 'Anonymous',\n          avatar: listing.seller_avatar || 'https://api.dicebear.com/7.x/avataaars/svg?seed=' + (listing.seller_id || 'x'),\n          rating: listing.seller_rating || 0,\n          reviewCount: listing.seller_rating_count || 0,\n          location: {\n              lat: cityCoords?.lat || 24.8607,\n              lng: cityCoords?.lng || 67.0011,\n              address: listing.seller_location || 'Karachi'\n          },\n          isVerified: false,\n          badges: [],\n          stats: { bidsAcceptedByMe: 0, myBidsAccepted: 0 }\n      };\n  }\n\n  // Calculate expiry\n  const createdAt = listing.created_at ? new Date(listing.created_at).getTime() : Date.now();\n  \n  // Use DB 'ends_at' if available (randomized timers), otherwise fallback to 72h\n  const expiryAt = listing.ends_at \n    ? listing.ends_at \n    : new Date(createdAt + 72 * 60 * 60 * 1000).toISOString();\n\n  // Basic Auction Mode mapping\n  const isPublicBid = listing.auction_mode === 'visible';\n\n  const isValidCondition = (value: string | null | undefined): value is Item['condition'] =>\n    value === 'new' || value === 'like_new' || value === 'used' || value === 'fair';\n\n  const isValidStatus = (value: string | null | undefined): value is Item['status'] =>\n    value === 'active' || value === 'completed' || value === 'cancelled' || value === 'hidden';\n\n  // Image URL Transformation\n  // We assume images in DB are filenames/paths (e.g. \"chair.jpg\")\n  // We prepend the Storage bucket URL: [ProjectURL]/storage/v1/object/public/listings/\n  const storageUrl = process.env.NEXT_PUBLIC_SUPABASE_URL \n    ? `${process.env.NEXT_PUBLIC_SUPABASE_URL}/storage/v1/object/public/listings`\n    : '';\n\n  const imageUrls = (listing.images || []).map(img => {\n    if (img.startsWith('http')) return img; // Already a full URL\n    return `${storageUrl}/${img}`;\n  });\n\n  return {\n    id: listing.id,\n    slug: listing.slug || undefined,\n    title: listing.title,\n    description: listing.description || '',\n    images: imageUrls,\n    sellerId: listing.seller_id || 'unknown',\n    seller: seller,\n    askPrice: listing.asked_price,\n    category: listing.category || 'Other',\n    condition: isValidCondition(listing.condition) ? listing.condition : 'used',\n    isPublicBid: isPublicBid,\n    \n    // Server-side stats if available\n    currentHighBid: listing.high_bid !== undefined ? Number(listing.high_bid) : undefined,\n    currentHighBidderId: listing.high_bidder_id || undefined,\n    bidCount: listing.bid_count !== undefined ? Number(listing.bid_count) : 0,\n    \n    createdAt: listing.created_at || new Date().toISOString(),\n    expiryAt: expiryAt,\n    listingDuration: 72,\n    status: isValidStatus(listing.status) ? listing.status : 'active'\n  };\n}\nexport type BidWithProfile = Database['public']['Tables']['bids']['Row'] & {\n  profiles: ProfileRow | null;\n};\n\nexport function transformBidToHydratedBid(bid: BidWithProfile): Bid {\n  return {\n    id: bid.id,\n    itemId: bid.listing_id || '',\n    bidderId: bid.bidder_id || '',\n    bidder: bid.profiles ? transformProfileToUser(bid.profiles) : undefined,\n    amount: Number(bid.amount),\n    status: (bid.status || 'pending') as Bid['status'],\n    type: 'public', // Defaulting since bid_type was removed from schema\n    createdAt: bid.created_at || new Date().toISOString(),\n    update_count: (bid as any).update_count || 0\n  };\n}\n\nexport type ConversationWithHydration = Database['public']['Tables']['conversations']['Row'] & {\n  listings: ListingWithSeller | null;\n  seller_profile: ProfileRow | null;\n  bidder_profile: ProfileRow | null;\n  last_message?: string;\n  updated_at?: string;\n  expires_at?: string | null;\n};\n\nexport function transformConversationToHydratedConversation(conv: ConversationWithHydration): Conversation {\n  return {\n    id: conv.id,\n    itemId: conv.listing_id || '',\n    item: conv.listings ? transformListingToItem(conv.listings) : undefined,\n    sellerId: conv.seller_id || '',\n    seller: conv.seller_profile ? transformProfileToUser(conv.seller_profile) : undefined,\n    bidderId: conv.bidder_id || '',\n    bidder: conv.bidder_profile ? transformProfileToUser(conv.bidder_profile) : undefined,\n    lastMessage: conv.last_message,\n    updatedAt: conv.updated_at || conv.created_at || new Date().toISOString(),\n    expiresAt: conv.expires_at || undefined,\n    sellerConfirmedAt: (conv as any).seller_confirmed_at,\n    buyerConfirmedAt: (conv as any).buyer_confirmed_at,\n    isSealed: (conv as any).is_sealed || false\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\uploadImage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\utils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'viewMode' is defined but never used.","line":137,"column":63,"nodeType":null,"messageId":"unusedVar","endLine":137,"endColumn":71}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { clsx, type ClassValue } from \"clsx\"\r\nimport { twMerge } from \"tailwind-merge\"\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs))\r\n}\r\n\r\nimport { customAlphabet } from 'nanoid';\r\n\r\n// ... existing code ...\r\n\r\n/**\r\n * Generates a SEO-friendly slug: \"title-slug-random8\"\r\n */\r\nexport function generateSlug(title: string): string {\r\n  // 1. Slugify the title\r\n  const slugTitle = title\r\n    .toLowerCase()\r\n    .trim()\r\n    .replace(/[^\\w\\s-]/g, '') // Remove special chars\r\n    .replace(/[\\s_-]+/g, '-') // Replace spaces/underscores with hyphen\r\n    .replace(/^-+|-+$/g, ''); // Trim hyphens\r\n\r\n  // 2. Generate 8-char random string (numbers + lowercase only for URL safety)\r\n  const nanoid = customAlphabet('0123456789abcdefghijklmnopqrstuvwxyz', 8);\r\n  const randomSuffix = nanoid();\r\n\r\n  return `${slugTitle}-${randomSuffix}`;\r\n}\r\n\r\n\r\n/**\r\n * Strips precise address details (House #, Street #, Apartment #) \r\n * and returns a general area estimate (e.g., \"DHA Phase 6, Lahore\").\r\n * \r\n * Strategy:\r\n * 1. If comma separated, take the last 2 segments (usually Area, City).\r\n * 2. If short, return as is.\r\n */\r\nexport function getFuzzyLocationString(address: string): string {\r\n  if (!address) return \"Unknown Location\";\r\n  \r\n  // Filter out \"Pakistan\" from the address parts to keep it local\r\n  const parts = address.split(',')\r\n    .map(p => p.trim())\r\n    .filter(p => !p.toLowerCase().includes('pakistan'));\r\n  \r\n  if (parts.length > 0) {\r\n    // If we have multiple parts (e.g. \"DHA, Lahore\"), take last 2. \r\n    // If just \"Karachi\", take it.\r\n    return parts.slice(-2).join(', ');\r\n  }\r\n  \r\n  // Fallback if address was just \"Pakistan\"\r\n  return address;\r\n}\r\n\r\n/**\r\n * Checks if a given address is within the primary operating country (Pakistan).\r\n * This is used to hide distance metrics for users outside the country.\r\n * \r\n * Falls back to distance threshold if address check is ambiguous.\r\n */\r\nexport function isLocationInCountry(address: string | undefined): boolean {\r\n  if (!address) return true; // Default to true for mock safety\r\n  const addr = address.toLowerCase();\r\n  \r\n  // Explicit country mention\r\n  if (addr.includes('pakistan')) return true;\r\n  \r\n  // Common Pakistani cities/provinces as indicators if country is missing\r\n  const indicators = ['karachi', 'lahore', 'islamabad', 'rawalpindi', 'faisalabad', 'multan', 'peshawar', 'quetta', 'sialkot', 'sindh', 'punjab', 'balochistan', 'kpk', 'khyber'];\r\n  return indicators.some(ind => addr.includes(ind));\r\n}\r\n\r\n/**\r\n * Calculates a privacy-safe estimated distance between two coordinates.\r\n * \r\n * Privacy Measures:\r\n * 1. Uses Haversine/Great Circle distance.\r\n * 2. Rounds the result to the nearest 2km to prevent triangulation.\r\n * 3. Adds a small stable jitter based on IDs if needed (omitted for now for purity).\r\n * \r\n * @param from - Origin { lat, lng, address? }\r\n * @param to - Destination { lat, lng, address? }\r\n * @returns { distance: number (km), duration: number (mins), isOutside: boolean }\r\n */\r\nexport function calculatePrivacySafeDistance(\r\n  from: { lat: number; lng: number; address?: string } | undefined, \r\n  to: { lat: number; lng: number; address?: string }\r\n): { distance: number; duration: number; isOutside: boolean } {\r\n  // If no user location, default to a generic \"Far\" distance or specific center\r\n  // For this mock, we'll assume a fixed user location if undefined\r\n  const userLat = from?.lat ?? 24.8607; // Default to Karachi center\r\n  const userLng = from?.lng ?? 67.0011;\r\n\r\n  const R = 6371; // Earth's radius in km\r\n  const dLat = (to.lat - userLat) * Math.PI / 180;\r\n  const dLon = (to.lng - userLng) * Math.PI / 180;\r\n  \r\n  const a = \r\n    Math.sin(dLat/2) * Math.sin(dLat/2) +\r\n    Math.cos(userLat * Math.PI / 180) * Math.cos(to.lat * Math.PI / 180) * \r\n    Math.sin(dLon/2) * Math.sin(dLon/2);\r\n  \r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\r\n  const rawDist = R * c;\r\n\r\n  // PRIVACY STEP: Round to nearest 200m (0.2km) as per user request\r\n  // This gives an \"area\" estimation without pinning exact house\r\n  let safeDist = Math.round(rawDist / 0.2) * 0.2;\r\n  \r\n  // Ensure we don't return 0 for very close items, min 0.2km\r\n  safeDist = Math.max(0.2, safeDist);\r\n  \r\n  // Fix to 1 decimal place to avoid floating point weirdness (e.g. 1.20000001)\r\n  safeDist = Number(safeDist.toFixed(1));\r\n\r\n  // Estimate duration (Urban driving: ~25km/h avg => ~2.4 mins per km)\r\n  const duration = Math.max(1, Math.round(safeDist * 2.5));\r\n\r\n  // Logic: Mark as outside if addresses don't match country OR distance is extreme (> 1500km)\r\n  const fromInCountry = isLocationInCountry(from?.address);\r\n  const toInCountry = isLocationInCountry(to.address);\r\n  const isOutside = (!fromInCountry || !toInCountry) || safeDist > 1500;\r\n\r\n  return { distance: safeDist, duration, isOutside };\r\n}\r\n\r\n/**\r\n * Centered Price Formatting Utility (Hybrid Lakh/Standard)\r\n * \r\n * Rules:\r\n * 1. Below 1M: Standard localized number (e.g., 150,000).\r\n * 2. 1,000,000+: \"lac\" notation (e.g., 10 lac, 100 lac).\r\n */\r\nexport function formatPrice(price: number | undefined | null, viewMode?: string): string {\r\n  if (price === undefined || price === null) return \"\";\r\n  const p = Math.round(price);\r\n  \r\n  if (p >= 1_000_000) {\r\n    const lac = p / 100_000;\r\n    return `${lac % 1 === 0 ? lac.toFixed(0) : lac.toFixed(1)} lac`;\r\n  }\r\n  \r\n  return p.toLocaleString();\r\n}\r\n\r\n/**\r\n * Maps database condition strings to UI display labels.\r\n * \r\n * Mappings:\r\n * - new -> \"≡ƒîƒ New\"\r\n * - like_new -> \"Γ£¿ Mint\"\r\n * - used -> \"≡ƒæî Used\"\r\n * - fair -> \"≡ƒö¿ Fair\"\r\n * - default -> \"≡ƒæî Used\"\r\n */\r\nexport function getConditionLabel(condition: string): string {\r\n  switch (condition) {\r\n    case 'new': return '≡ƒîƒ New';\r\n    case 'like_new': return 'Γ£¿ Mint';\r\n    case 'used': return '≡ƒæî Used';\r\n    case 'fair': return '≡ƒö¿ Fair';\r\n    default: return '≡ƒæî Used';\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\proxy.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":25,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\nexport function proxy(req: NextRequest) {\n  // 1. Bypass for Localhost / Development\n  // This ensures your local development flow is never interrupted\n  const hostname = req.headers.get('host') || '';\n  if (\n    process.env.NODE_ENV === 'development' || \n    hostname.includes('localhost') || \n    hostname.includes('127.0.0.1') ||\n    hostname.startsWith('192.168.') // Allow LAN testing without password\n  ) {\n    return NextResponse.next();\n  }\n\n  // 2. Basic Authentication for Vercel/Live\n  // Password is '799698' as requested, or can be overridden via SITE_PASSWORD env var\n  const validPassword = process.env.SITE_PASSWORD || '799698';\n  const basicAuth = req.headers.get('authorization');\n\n  if (basicAuth) {\n    const authValue = basicAuth.split(' ')[1];\n    // Decode base64\n    const [user, pwd] = atob(authValue).split(':');\n\n    if (pwd === validPassword) {\n      return NextResponse.next();\n    }\n  }\n\n  // 3. Prompt for Password if missing or incorrect\n  return new NextResponse('Authentication Required', {\n    status: 401,\n    headers: {\n      'WWW-Authenticate': 'Basic realm=\"Boliyan Private Test\"',\n    },\n  });\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except:\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - robots.txt\n     */\n    '/((?!api|_next/static|_next/image|favicon.ico|robots.txt).*)',\n  ],\n};\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\bidding.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\dashboard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\database.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\notification.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\review.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\auction-lifecycle.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\auth-flows.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\auth-probe.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\check_dialog.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\condition-verification.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\create-listing.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\dashboard-navigation.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\discover.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2005,2008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2005,2008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { test, type Page } from '@playwright/test';\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\n/**\r\n * Boliyan Feature Discovery Script\r\n * Automatically crawls the application to identify:\r\n * 1. Routes and Links\r\n * 2. Interactive Elements (Buttons, Inputs) with IDs\r\n */\n\ninterface DiscoveredElement {\n\n  id: string;\n  tagName: string;\n  text?: string;\n  type?: string;\n  placeholder?: string;\n}\n\ninterface DiscoveredFeature {\n  route: string;\n  title: string;\n  interactiveElements: DiscoveredElement[];\n}\n\nconst discoveredFeatures = {\n  routes: new Set<string>(),\n  elements: [] as DiscoveredFeature[],\n  errors: [] as string[]\n};\n\r\ntest('Programmatic Feature Discovery', async ({ page, baseURL }) => {\n  const targetUrl = baseURL || 'http://localhost:3000';\n  await page.goto(targetUrl);\n  discoveredFeatures.routes.add('/');\n  \n  await scrapePage(page, '/');\n\n  const links = await page.locator('a').all();\n  for (const link of links) {\n    const href = await link.getAttribute('href');\n    if (href && href.startsWith('/') && !href.includes('#')) {\n      discoveredFeatures.routes.add(href);\n    }\n  }\n\n  for (const route of Array.from(discoveredFeatures.routes)) {\n    if (route === '/') continue;\n    try {\n      await page.goto(`${targetUrl}${route}`);\n      await scrapePage(page, route);\n    } catch (e: unknown) {\n      const message = e instanceof Error ? e.message : 'Unknown error';\n      discoveredFeatures.errors.push(`Error on ${route}: ${message}`);\n    }\n  }\n\n\r\n  const reportPath = path.join(process.cwd(), 'feature_discovery_report.json');\r\n  fs.writeFileSync(reportPath, JSON.stringify({\r\n    timestamp: new Date().toISOString(),\r\n    routes: Array.from(discoveredFeatures.routes),\r\n    elements: discoveredFeatures.elements,\r\n    errors: discoveredFeatures.errors\r\n  }, null, 2));\r\n});\r\n\r\nasync function scrapePage(page: Page, route: string) {\n  const title = await page.title();\r\n  const elementsWithId = await page.locator('[id]').evaluateAll((els) => \n    els.map((el: any) => ({\n      id: el.id,\n      tagName: el.tagName,\n      text: el.innerText?.substring(0, 50),\n      type: el.type || undefined,\n      placeholder: el.placeholder || undefined\n    }))\n  );\n\r\n  discoveredFeatures.elements.push({\r\n    route,\r\n    title,\r\n    interactiveElements: elementsWithId\r\n  });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\favicon.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\helpers\\auth.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'signupError' is defined but never used.","line":48,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Page, expect } from '@playwright/test';\r\n\r\nexport async function loginUser(page: Page, email?: string, password = 'password123') {\r\n  const testEmail = email || `e2e-${Date.now()}@demo.com`;\r\n  console.log(`[loginUser] Attempting login/signup for ${testEmail}`);\r\n  \r\n  await page.goto('/signin');\r\n  await page.locator('#email-input').fill(testEmail);\r\n  await page.locator('#password-input').fill(password);\r\n  await page.locator('#signin-submit-btn').click();\r\n  \r\n  // Wait for login success (Avatar appearing) or error message\n  try {\n    // If we see the avatar, we're good. Increase timeout to 10s for hydration.\n    await expect(page.locator('#navbar-avatar-18')).toBeVisible({ timeout: 10000 });\n    console.log(`[loginUser] Login successful for ${testEmail}`);\n  } catch (err) {\n    // Check if it's an unconfirmed email or invalid credentials\n    const errorLog = page.locator('text=Email not confirmed');\n    const invalidCredsLog = page.locator('text=Invalid login credentials');\n    \n    if (await errorLog.isVisible() || await invalidCredsLog.isVisible() || page.url().includes('/signin')) {\n      console.log(`[loginUser] Login failed for ${testEmail}, attempting signup...`);\n      await page.goto('/signup');\n      await page.locator('#name-input').fill('Test E2E');\n      await page.locator('#email-input').fill(testEmail);\n      await page.locator('#phone-input').fill('03001234567');\n      await page.locator('#password-input').fill(password);\n      await page.locator('#confirm-password-input').fill(password);\n      \n      // Select city\n      await page.locator('#city-select').click();\n      await page.keyboard.press('ArrowDown');\n      await page.keyboard.press('Enter');\n      \n      await page.locator('#signup-submit-btn').click();\n      \n      // Post-signup: Wait for redirect or success state\n      console.log('[loginUser] Waiting for auth transition...');\n      \n      // Instead of waiting for URL (which might be slow), wait for the avatar\n      try {\n        // First wait for the Sign In button to disappear\n        await expect(page.locator('#navbar-signin-btn')).not.toBeVisible({ timeout: 15000 });\n        // Then wait for the avatar\n        await expect(page.locator('#navbar-avatar-18')).toBeVisible({ timeout: 10000 });\n        console.log(`[loginUser] Signup and Auto-Login successful for ${testEmail}`);\n      } catch (signupError) {\n        // One last try: reload page to force session check\n        console.log('[loginUser] Session not hydrated, reloading page...');\n        await page.reload();\n        await expect(page.locator('#navbar-avatar-18')).toBeVisible({ timeout: 15000 });\n        console.log(`[loginUser] Signup and Auto-Login successful for ${testEmail} after reload`);\n      }\n    } else {\n      throw new Error(`[loginUser] Unexpected state or unhandled login failure for ${testEmail}: ${err}`);\n    }\n  }\n\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\helpers\\mock-network.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\location-filters.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\marketplace-discovery.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\measure-cards.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\messaging-engagement.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\notifications.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\product-page.spec.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\profile-management.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\repro_modal_issue.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\search.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\smart_bidding_verification.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\smoke-test.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\verification-70-rule.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\verify-bidding.spec.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\verify-price-formatting.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\verify_no_dihari.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\tests\\visual-regression.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
