[{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\(auth)\\complete-profile\\CompleteProfileClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\(auth)\\complete-profile\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\(auth)\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\(auth)\\signin\\SignInClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\(auth)\\signin\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\(auth)\\signup\\SignUpClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\(auth)\\signup\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\admin\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\admin\\listings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3629,3632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3629,3632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4457,4460],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4457,4460],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState, useCallback } from \"react\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { useAuth } from \"@/context/AuthContext\";\r\nimport { Check, X, Package, Clock, CheckCircle, XCircle } from \"lucide-react\";\r\nimport Image from \"next/image\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogFooter,\r\n} from \"@/components/ui/dialog\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\n\r\ninterface Listing {\r\n  id: string;\r\n  title: string;\r\n  asked_price: number;\r\n  category: string | null;\r\n  condition: string | null;\r\n  images: string[];\r\n  created_at: string;\r\n  moderation_status: \"pending\" | \"approved\" | \"rejected\";\r\n  rejection_reason: string | null;\r\n  seller_id: string;\r\n  seller: {\r\n    full_name: string | null;\r\n    avatar_url: string | null;\r\n  } | null;\r\n}\r\n\r\ntype TabFilter = \"pending\" | \"approved\" | \"rejected\";\r\n\r\nconst REJECTION_REASONS = [\r\n  { id: \"inappropriate_image\", label: \"Inappropriate Image\" },\r\n  { id: \"misleading_content\", label: \"Misleading Title/Description\" },\r\n  { id: \"spam_scam\", label: \"Spam / Scam\" },\r\n  { id: \"prohibited_item\", label: \"Prohibited Item\" },\r\n  { id: \"other\", label: \"Other\" },\r\n];\r\n\r\nexport default function AdminListingsPage() {\r\n  const { user } = useAuth();\r\n  const [listings, setListings] = useState<Listing[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [activeTab, setActiveTab] = useState<TabFilter>(\"pending\");\r\n  const [counts, setCounts] = useState({ pending: 0, approved: 0, rejected: 0 });\r\n  \r\n  // Rejection modal state\r\n  const [rejectModalOpen, setRejectModalOpen] = useState(false);\r\n  const [selectedListing, setSelectedListing] = useState<Listing | null>(null);\r\n  const [selectedReason, setSelectedReason] = useState(\"\");\r\n  const [customReason, setCustomReason] = useState(\"\");\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  const fetchListings = useCallback(async () => {\r\n    setLoading(true);\r\n    \r\n    const { data, error } = await supabase\r\n      .from(\"listings\")\r\n      .select(`\r\n        id, title, asked_price, category, condition, images, created_at,\r\n        moderation_status, rejection_reason, seller_id,\r\n        seller:profiles!seller_id(full_name, avatar_url)\r\n      `)\r\n      .eq(\"moderation_status\", activeTab)\r\n      .order(\"created_at\", { ascending: activeTab === \"pending\" });\r\n\r\n    if (!error && data) {\r\n      setListings(data as unknown as Listing[]);\r\n    }\r\n    setLoading(false);\r\n  }, [activeTab]);\r\n\r\n  const fetchCounts = useCallback(async () => {\r\n    const [pending, approved, rejected] = await Promise.all([\r\n      supabase.from(\"listings\").select(\"*\", { count: \"exact\", head: true }).eq(\"moderation_status\", \"pending\"),\r\n      supabase.from(\"listings\").select(\"*\", { count: \"exact\", head: true }).eq(\"moderation_status\", \"approved\"),\r\n      supabase.from(\"listings\").select(\"*\", { count: \"exact\", head: true }).eq(\"moderation_status\", \"rejected\"),\r\n    ]);\r\n    setCounts({\r\n      pending: pending.count ?? 0,\r\n      approved: approved.count ?? 0,\r\n      rejected: rejected.count ?? 0,\r\n    });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    void (async () => {\r\n      await fetchListings();\r\n      await fetchCounts();\r\n    })();\r\n  }, [fetchListings, fetchCounts]);\r\n\r\n  const handleApprove = async (listingId: string) => {\r\n    const { error } = await (supabase\r\n      .from(\"listings\") as any)\r\n      .update({ \r\n        moderation_status: \"approved\",\r\n        moderated_by: user?.id,\r\n      })\r\n      .eq(\"id\", listingId);\r\n\r\n    if (!error) {\r\n      setListings((prev) => prev.filter((l) => l.id !== listingId));\r\n      fetchCounts();\r\n    }\r\n  };\r\n\r\n  const openRejectModal = (listing: Listing, presetReason?: string) => {\r\n    setSelectedListing(listing);\r\n    setSelectedReason(presetReason || \"\");\r\n    setCustomReason(\"\");\r\n    setRejectModalOpen(true);\r\n  };\r\n\r\n  const handleReject = async () => {\r\n    if (!selectedListing || !selectedReason) return;\r\n    setSubmitting(true);\r\n\r\n    const reason = selectedReason === \"other\" \r\n      ? customReason \r\n      : REJECTION_REASONS.find(r => r.id === selectedReason)?.label || selectedReason;\r\n\r\n    const { error } = await (supabase\r\n      .from(\"listings\") as any)\r\n      .update({ \r\n        moderation_status: \"rejected\",\r\n        rejection_reason: reason,\r\n        rejected_at: new Date().toISOString(),\r\n        moderated_by: user?.id,\r\n      })\r\n      .eq(\"id\", selectedListing.id);\r\n\r\n    if (!error) {\r\n      setListings((prev) => prev.filter((l) => l.id !== selectedListing.id));\r\n      fetchCounts();\r\n      setRejectModalOpen(false);\r\n    }\r\n    setSubmitting(false);\r\n  };\r\n\r\n  const tabs: { id: TabFilter; label: string; icon: React.ElementType }[] = [\r\n    { id: \"pending\", label: \"Pending\", icon: Clock },\r\n    { id: \"approved\", label: \"Approved\", icon: CheckCircle },\r\n    { id: \"rejected\", label: \"Rejected\", icon: XCircle },\r\n  ];\r\n\r\n  return (\r\n    <div id=\"admin-listings\" className=\"space-y-6\">\r\n      <h2 className=\"text-2xl font-black text-slate-900\">Listing Moderation</h2>\r\n\r\n      {/* Tabs */}\r\n      <div id=\"admin-listings-tabs\" className=\"flex gap-2 border-b border-slate-200 pb-2\">\r\n        {tabs.map((tab) => (\r\n          <button\r\n            key={tab.id}\r\n            id={`admin-listings-tab-${tab.id}`}\r\n            onClick={() => setActiveTab(tab.id)}\r\n            className={`flex items-center gap-2 px-4 py-2 rounded-t-lg font-semibold text-sm transition-all ${\r\n              activeTab === tab.id\r\n                ? \"bg-amber-100 text-amber-800 border-b-2 border-amber-600\"\r\n                : \"text-slate-500 hover:text-slate-700 hover:bg-slate-50\"\r\n            }`}\r\n          >\r\n            <tab.icon className=\"h-4 w-4\" />\r\n            {tab.label}\r\n            <span className={`ml-1 px-2 py-0.5 rounded-full text-xs ${\r\n              activeTab === tab.id ? \"bg-amber-200\" : \"bg-slate-200\"\r\n            }`}>\r\n              {counts[tab.id]}\r\n            </span>\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Listings Grid */}\r\n      {loading ? (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n          {[1, 2, 3].map((i) => (\r\n            <Card key={i} className=\"p-4 animate-pulse\">\r\n              <div className=\"aspect-video bg-slate-200 rounded-lg mb-3\" />\r\n              <div className=\"h-4 bg-slate-200 rounded w-3/4 mb-2\" />\r\n              <div className=\"h-3 bg-slate-200 rounded w-1/2\" />\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      ) : listings.length === 0 ? (\r\n        <Card className=\"p-8 text-center\">\r\n          <Package className=\"h-12 w-12 mx-auto text-slate-300 mb-3\" />\r\n          <p className=\"text-slate-500\">No {activeTab} listings</p>\r\n        </Card>\r\n      ) : (\r\n        <div id=\"admin-listings-grid\" className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n          {listings.map((listing) => (\r\n            <ListingCard\r\n              key={listing.id}\r\n              listing={listing}\r\n              activeTab={activeTab}\r\n              onApprove={handleApprove}\r\n              onReject={openRejectModal}\r\n            />\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {/* Rejection Modal */}\r\n      <Dialog open={rejectModalOpen} onOpenChange={setRejectModalOpen}>\r\n        <DialogContent id=\"reject-listing-modal\" className=\"p-0 gap-0 overflow-hidden\">\r\n          <DialogHeader className=\"p-6 pb-2\">\r\n            <DialogTitle>Reject Listing</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4 py-2\">\r\n            <p className=\"text-sm text-slate-600 px-6\">\r\n              Select a reason for rejecting &quot;{selectedListing?.title}&quot;\r\n            </p>\r\n            <RadioGroup value={selectedReason} onValueChange={setSelectedReason} className=\"gap-0\">\r\n              {REJECTION_REASONS.map((reason) => (\r\n                <div \r\n                  key={reason.id} \r\n                  className={`flex items-center space-x-2 px-6 py-3 transition-colors cursor-pointer ${\r\n                    selectedReason === reason.id ? 'bg-blue-50' : 'hover:bg-slate-50'\r\n                  }`}\r\n                  onClick={() => setSelectedReason(reason.id)}\r\n                >\r\n                  <RadioGroupItem value={reason.id} id={`reason-${reason.id}`} className=\"mt-0.5\" />\r\n                  <Label htmlFor={`reason-${reason.id}`} className=\"flex-1 cursor-pointer font-normal text-slate-700\">\r\n                    {reason.label}\r\n                  </Label>\r\n                </div>\r\n              ))}\r\n            </RadioGroup>\r\n            {selectedReason === \"other\" && (\r\n              <div className=\"px-6 pb-2\">\r\n                <Textarea\r\n                  id=\"custom-rejection-reason\"\r\n                  placeholder=\"Describe the issue...\"\r\n                  value={customReason}\r\n                  onChange={(e) => setCustomReason(e.target.value)}\r\n                  className=\"resize-none\"\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n          <DialogFooter className=\"p-6 pt-2 bg-slate-50 border-t border-slate-100\">\r\n            <Button variant=\"outline\" onClick={() => setRejectModalOpen(false)}>\r\n              Cancel\r\n            </Button>\r\n            <Button \r\n              variant=\"destructive\" \r\n              onClick={handleReject}\r\n              disabled={!selectedReason || (selectedReason === \"other\" && !customReason) || submitting}\r\n            >\r\n              {submitting ? \"Rejecting...\" : \"Reject Listing\"}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Listing Card Component\r\nfunction ListingCard({ \r\n  listing, \r\n  activeTab,\r\n  onApprove, \r\n  onReject \r\n}: { \r\n  listing: Listing; \r\n  activeTab: TabFilter;\r\n  onApprove: (id: string) => void; \r\n  onReject: (listing: Listing, presetReason?: string) => void;\r\n}) {\r\n  // Transform images to URLs\r\n  const storageUrl = process.env.NEXT_PUBLIC_R2_DOMAIN || '';\r\n  const images = (listing.images || []).map(img => {\r\n    if (img.startsWith('http')) return img;\r\n    if (!storageUrl) return img;\r\n    return `${storageUrl}/${img}`;\r\n  });\r\n\r\n  return (\r\n    <Card id={`listing-card-${listing.id}`} className=\"overflow-hidden border-slate-200\">\r\n      {/* Image Carousel */}\r\n      <div className=\"relative bg-slate-100 p-2\">\r\n        {images.length > 0 ? (\r\n          <div className=\"grid grid-cols-4 gap-2\">\r\n            {images.slice(0, 4).map((imgUrl, i) => (\r\n              <div key={i} className=\"relative aspect-square rounded-md overflow-hidden bg-white border border-slate-200 group\">\r\n                <Image\r\n                  src={imgUrl}\r\n                  alt={`${listing.title} - ${i + 1}`}\r\n                  fill\r\n                  className=\"object-cover\"\r\n                />\r\n                <button\r\n                   onClick={() => onReject(listing, \"inappropriate_image\")}\r\n                   className=\"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100\"\r\n                   title=\"Reject as Inappropriate Image\"\r\n                >\r\n                   <span className=\"bg-red-600 text-white text-[10px] px-1.5 py-0.5 rounded font-bold shadow-sm\">\r\n                     Reject Img\r\n                   </span>\r\n                </button>\r\n              </div>\r\n            ))}\r\n            {images.length > 4 && (\r\n               <div className=\"absolute bottom-2 right-2 bg-black/70 text-white text-xs px-1.5 py-0.5 rounded\">\r\n                 +{images.length - 4}\r\n               </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div className=\"aspect-video flex items-center justify-center\">\r\n            <Package className=\"h-8 w-8 text-slate-300\" />\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"p-4 space-y-3\">\r\n        <div>\r\n          <h3 className=\"font-bold text-slate-900 line-clamp-1\">{listing.title}</h3>\r\n          <p className=\"text-sm text-slate-500\">\r\n            Rs. {listing.asked_price?.toLocaleString()} ΓÇó {listing.category || \"Uncategorized\"}\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-2 text-xs text-slate-500\">\r\n          <span>By {listing.seller?.full_name || \"Unknown\"}</span>\r\n          <span>ΓÇó</span>\r\n          <span>{new Date(listing.created_at).toLocaleDateString()}</span>\r\n        </div>\r\n\r\n        {/* Rejection reason if rejected */}\r\n        {activeTab === \"rejected\" && listing.rejection_reason && (\r\n          <div className=\"p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-700\">\r\n            <strong>Reason:</strong> {listing.rejection_reason}\r\n          </div>\r\n        )}\r\n\r\n        {/* Actions */}\r\n        {activeTab === \"pending\" && (\r\n          <div className=\"flex gap-2 pt-2\">\r\n            <Button\r\n              id={`approve-${listing.id}`}\r\n              size=\"sm\"\r\n              className=\"flex-1 bg-emerald-600 hover:bg-emerald-700\"\r\n              onClick={() => onApprove(listing.id)}\r\n            >\r\n              <Check className=\"h-4 w-4 mr-1\" />\r\n              Approve\r\n            </Button>\r\n            <Button\r\n              id={`reject-${listing.id}`}\r\n              size=\"sm\"\r\n              variant=\"destructive\"\r\n              className=\"flex-1\"\r\n              onClick={() => onReject(listing)}\r\n            >\r\n              <X className=\"h-4 w-4 mr-1\" />\r\n              Reject\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </Card>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\admin\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\admin\\reports\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2347,2350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2347,2350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState, useCallback } from \"react\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { useSearchParams, useRouter } from \"next/navigation\";\r\nimport { Flag, CheckCircle, XCircle, Clock, User } from \"lucide-react\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport Link from \"next/link\";\r\n\r\ninterface Report {\r\n  id: string;\r\n  reason: string;\r\n  details: string | null;\r\n  status: string;\r\n  created_at: string;\r\n  reporter: { id: string; full_name: string; avatar_url: string | null };\r\n  reported_user: { id: string; full_name: string; avatar_url: string | null };\r\n}\r\n\r\nconst statusColors: Record<string, { badge: string; icon: typeof Flag }> = {\r\n  pending: { badge: \"bg-amber-100 text-amber-800 border-amber-200\", icon: Clock },\r\n  resolved: { badge: \"bg-green-100 text-green-800 border-green-200\", icon: CheckCircle },\r\n  dismissed: { badge: \"bg-slate-100 text-slate-600 border-slate-200\", icon: XCircle },\r\n};\r\n\r\nexport default function AdminReportsPage() {\r\n  const [reports, setReports] = useState<Report[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const searchParams = useSearchParams();\r\n  const router = useRouter();\r\n  const statusFilter = searchParams.get(\"status\") || \"pending\";\r\n\r\n  const fetchReports = useCallback(async () => {\r\n    setLoading(true);\r\n    let query = supabase\r\n      .from(\"reports\")\r\n      .select(`\r\n        id, reason, details, status, created_at,\r\n        reporter:reporter_id(id, full_name, avatar_url),\r\n        reported_user:reported_user_id(id, full_name, avatar_url)\r\n      `)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(50);\r\n\r\n    if (statusFilter !== \"all\") {\r\n      query = query.eq(\"status\", statusFilter);\r\n    }\r\n\r\n    const { data } = await query;\r\n    setReports((data as unknown as Report[]) || []);\r\n    setLoading(false);\r\n  }, [statusFilter]);\r\n\r\n  useEffect(() => {\r\n    void (async () => {\r\n      await fetchReports();\r\n    })();\r\n  }, [fetchReports]);\r\n\r\n  const handleAction = async (reportId: string, action: \"resolved\" | \"dismissed\") => {\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    \r\n    await (supabase\r\n      .from(\"reports\") as any)\r\n      .update({\r\n        status: action,\r\n        resolved_by: user?.id,\r\n        resolved_at: new Date().toISOString(),\r\n      })\r\n      .eq(\"id\", reportId);\r\n\r\n    fetchReports();\r\n  };\r\n\r\n  const setStatus = (status: string) => {\r\n    const params = new URLSearchParams(searchParams);\r\n    if (status === \"all\") {\r\n      params.delete(\"status\");\r\n    } else {\r\n      params.set(\"status\", status);\r\n    }\r\n    router.push(`/admin/reports?${params.toString()}`);\r\n  };\r\n\r\n  return (\r\n    <div id=\"admin-reports\" className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h2 className=\"text-2xl font-black text-slate-900\">Reports</h2>\r\n        \r\n        <div className=\"flex gap-2\">\r\n          {[\"pending\", \"resolved\", \"dismissed\", \"all\"].map((status) => (\r\n            <Button\r\n              key={status}\r\n              id={`filter-${status}`}\r\n              variant={statusFilter === status ? \"default\" : \"outline\"}\r\n              size=\"sm\"\r\n              onClick={() => setStatus(status)}\r\n              className=\"capitalize\"\r\n            >\r\n              {status}\r\n            </Button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div className=\"space-y-3\">\r\n          {[1, 2, 3].map((i) => (\r\n            <Card key={i} className=\"p-4 animate-pulse\">\r\n              <div className=\"h-16 bg-slate-100 rounded\" />\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      ) : reports.length === 0 ? (\r\n        <Card className=\"p-8 text-center\">\r\n          <Flag className=\"h-12 w-12 text-slate-300 mx-auto mb-3\" />\r\n          <p className=\"text-slate-500 font-medium\">No {statusFilter} reports found.</p>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"space-y-3\">\r\n          {reports.map((report) => {\r\n            const StatusIcon = statusColors[report.status]?.icon || Flag;\r\n            return (\r\n              <Card key={report.id} id={`report-${report.id}`} className=\"p-4\">\r\n                <div className=\"flex items-start gap-4\">\r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex items-center gap-2 mb-2\">\r\n                      <Badge className={statusColors[report.status]?.badge}>\r\n                        <StatusIcon className=\"h-3 w-3 mr-1\" />\r\n                        {report.status}\r\n                      </Badge>\r\n                      <span className=\"text-xs text-slate-400\">\r\n                        {formatDistanceToNow(new Date(report.created_at), { addSuffix: true })}\r\n                      </span>\r\n                    </div>\r\n                    \r\n                    <p className=\"font-semibold text-slate-900 mb-1\">{report.reason}</p>\r\n                    {report.details && (\r\n                      <p className=\"text-sm text-slate-600 mb-3\">{report.details}</p>\r\n                    )}\r\n\r\n                    <div className=\"flex items-center gap-4 text-sm\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <User className=\"h-4 w-4 text-slate-400\" />\r\n                        <span className=\"text-slate-500\">Reported:</span>\r\n                        <Link \r\n                          href={`/user/${report.reported_user.id}`}\r\n                          className=\"font-semibold text-slate-700 hover:text-blue-600\"\r\n                        >\r\n                          {report.reported_user.full_name}\r\n                        </Link>\r\n                      </div>\r\n                      <div className=\"text-slate-400\">by</div>\r\n                      <Link \r\n                        href={`/user/${report.reporter.id}`}\r\n                        className=\"font-medium text-slate-600 hover:text-blue-600\"\r\n                      >\r\n                        {report.reporter.full_name}\r\n                      </Link>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {report.status === \"pending\" && (\r\n                    <div className=\"flex gap-2 shrink-0\">\r\n                      <Button\r\n                        id={`resolve-${report.id}`}\r\n                        size=\"sm\"\r\n                        onClick={() => handleAction(report.id, \"resolved\")}\r\n                        className=\"bg-green-600 hover:bg-green-700\"\r\n                      >\r\n                        <CheckCircle className=\"h-4 w-4 mr-1\" />\r\n                        Resolve\r\n                      </Button>\r\n                      <Button\r\n                        id={`dismiss-${report.id}`}\r\n                        size=\"sm\"\r\n                        variant=\"outline\"\r\n                        onClick={() => handleAction(report.id, \"dismissed\")}\r\n                      >\r\n                        <XCircle className=\"h-4 w-4 mr-1\" />\r\n                        Dismiss\r\n                      </Button>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </Card>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\admin\\users\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2401,2404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2401,2404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2656,2659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2656,2659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState, useCallback } from \"react\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { useSearchParams, useRouter } from \"next/navigation\";\r\nimport { Search, Ban, CheckCircle, User, Calendar, Flag } from \"lucide-react\";\r\nimport { formatDistanceToNow, format, addDays } from \"date-fns\";\r\nimport Link from \"next/link\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\n\r\ninterface UserProfile {\r\n  id: string;\r\n  full_name: string;\r\n  email: string | null;\r\n  avatar_url: string | null;\r\n  created_at: string;\r\n  banned_until: string | null;\r\n  role: string | null;\r\n}\r\n\r\nexport default function AdminUsersPage() {\r\n  const [users, setUsers] = useState<UserProfile[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [search, setSearch] = useState(\"\");\r\n  const [banDialog, setBanDialog] = useState<{ userId: string; name: string } | null>(null);\r\n  const [banDuration, setBanDuration] = useState(\"7\");\r\n  const searchParams = useSearchParams();\r\n  const router = useRouter();\r\n  const filter = searchParams.get(\"filter\");\r\n\r\n  const fetchUsers = useCallback(async () => {\r\n    setLoading(true);\r\n    \r\n    let query = supabase\r\n      .from(\"profiles\")\r\n      .select(\"id, full_name, email, avatar_url, created_at, banned_until, role\")\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(50);\r\n\r\n    if (search) {\r\n      query = query.or(`full_name.ilike.%${search}%,email.ilike.%${search}%`);\r\n    }\r\n\r\n    if (filter === \"banned\") {\r\n      query = query.gt(\"banned_until\", new Date().toISOString());\r\n    }\r\n\r\n    const { data } = await query;\r\n    setUsers((data as UserProfile[]) || []);\r\n    setLoading(false);\r\n  }, [search, filter]);\r\n\r\n  useEffect(() => {\r\n    const debounce = setTimeout(fetchUsers, 300);\r\n    return () => clearTimeout(debounce);\r\n  }, [fetchUsers]);\r\n\r\n  const handleBan = async () => {\r\n    if (!banDialog) return;\r\n    \r\n    const bannedUntil = addDays(new Date(), parseInt(banDuration));\r\n    await (supabase\r\n      .from(\"profiles\") as any)\r\n      .update({ banned_until: bannedUntil.toISOString() })\r\n      .eq(\"id\", banDialog.userId);\r\n\r\n    setBanDialog(null);\r\n    fetchUsers();\r\n  };\r\n\r\n  const handleUnban = async (userId: string) => {\r\n    await (supabase\r\n      .from(\"profiles\") as any)\r\n      .update({ banned_until: null })\r\n      .eq(\"id\", userId);\r\n    fetchUsers();\r\n  };\r\n\r\n  const setFilter = (newFilter: string | null) => {\r\n    const params = new URLSearchParams(searchParams);\r\n    if (newFilter) {\r\n      params.set(\"filter\", newFilter);\r\n    } else {\r\n      params.delete(\"filter\");\r\n    }\r\n    router.push(`/admin/users?${params.toString()}`);\r\n  };\r\n\r\n  const isBanned = (user: UserProfile) => \r\n    user.banned_until && new Date(user.banned_until) > new Date();\r\n\r\n  return (\r\n    <div id=\"admin-users\" className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <h2 className=\"text-2xl font-black text-slate-900\">Users</h2>\r\n        \r\n        <div className=\"flex gap-2\">\r\n          <Button\r\n            id=\"filter-all-users\"\r\n            variant={!filter ? \"default\" : \"outline\"}\r\n            size=\"sm\"\r\n            onClick={() => setFilter(null)}\r\n          >\r\n            All\r\n          </Button>\r\n          <Button\r\n            id=\"filter-banned\"\r\n            variant={filter === \"banned\" ? \"default\" : \"outline\"}\r\n            size=\"sm\"\r\n            onClick={() => setFilter(\"banned\")}\r\n          >\r\n            Banned\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"relative\">\r\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400\" />\r\n        <Input\r\n          id=\"user-search\"\r\n          placeholder=\"Search by name or email...\"\r\n          value={search}\r\n          onChange={(e) => setSearch(e.target.value)}\r\n          className=\"pl-10\"\r\n        />\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div className=\"space-y-3\">\r\n          {[1, 2, 3].map((i) => (\r\n            <Card key={i} className=\"p-4 animate-pulse\">\r\n              <div className=\"h-16 bg-slate-100 rounded\" />\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      ) : users.length === 0 ? (\r\n        <Card className=\"p-8 text-center\">\r\n          <User className=\"h-12 w-12 text-slate-300 mx-auto mb-3\" />\r\n          <p className=\"text-slate-500 font-medium\">No users found.</p>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"space-y-3\">\r\n          {users.map((user) => (\r\n            <Card key={user.id} id={`user-${user.id}`} className=\"p-4\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <Avatar className=\"h-12 w-12\">\r\n                  <AvatarImage src={user.avatar_url || undefined} />\r\n                  <AvatarFallback>{user.full_name?.[0] || \"?\"}</AvatarFallback>\r\n                </Avatar>\r\n\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Link \r\n                      href={`/user/${user.id}`}\r\n                      className=\"font-semibold text-slate-900 hover:text-blue-600\"\r\n                    >\r\n                      {user.full_name || \"No name\"}\r\n                    </Link>\r\n                    {user.role === \"admin\" && (\r\n                      <Badge className=\"bg-purple-100 text-purple-700 border-purple-200\">Admin</Badge>\r\n                    )}\r\n                    {isBanned(user) && (\r\n                      <Badge className=\"bg-red-100 text-red-700 border-red-200\">\r\n                        <Ban className=\"h-3 w-3 mr-1\" />\r\n                        Banned\r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                  <p className=\"text-sm text-slate-500\">{user.email}</p>\r\n                  <div className=\"flex items-center gap-4 mt-1 text-xs text-slate-400\">\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <Calendar className=\"h-3 w-3\" />\r\n                      Joined {formatDistanceToNow(new Date(user.created_at), { addSuffix: true })}\r\n                    </span>\r\n                    {isBanned(user) && (\r\n                      <span className=\"text-red-500\">\r\n                        Ban expires: {format(new Date(user.banned_until!), \"MMM d, yyyy\")}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"flex gap-2 shrink-0\">\r\n                  <Button\r\n                    id={`view-reports-${user.id}`}\r\n                    size=\"sm\"\r\n                    variant=\"outline\"\r\n                    asChild\r\n                  >\r\n                    <Link href={`/admin/reports?reported=${user.id}`}>\r\n                      <Flag className=\"h-4 w-4 mr-1\" />\r\n                      Reports\r\n                    </Link>\r\n                  </Button>\r\n                  \r\n                  {isBanned(user) ? (\r\n                    <Button\r\n                      id={`unban-${user.id}`}\r\n                      size=\"sm\"\r\n                      variant=\"outline\"\r\n                      onClick={() => handleUnban(user.id)}\r\n                      className=\"text-green-600 border-green-200 hover:bg-green-50\"\r\n                    >\r\n                      <CheckCircle className=\"h-4 w-4 mr-1\" />\r\n                      Unban\r\n                    </Button>\r\n                  ) : (\r\n                    <Button\r\n                      id={`ban-${user.id}`}\r\n                      size=\"sm\"\r\n                      variant=\"outline\"\r\n                      onClick={() => setBanDialog({ userId: user.id, name: user.full_name })}\r\n                      className=\"text-red-600 border-red-200 hover:bg-red-50\"\r\n                      disabled={user.role === \"admin\"}\r\n                    >\r\n                      <Ban className=\"h-4 w-4 mr-1\" />\r\n                      Ban\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {/* Ban Dialog */}\r\n      <Dialog open={!!banDialog} onOpenChange={() => setBanDialog(null)}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Ban User</DialogTitle>\r\n            <DialogDescription>\r\n              Set a ban duration for <strong>{banDialog?.name}</strong>. They will not be able to create listings or bids during this time.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"flex gap-2\">\r\n              {[\"1\", \"7\", \"30\", \"365\"].map((days) => (\r\n                <Button\r\n                  key={days}\r\n                  variant={banDuration === days ? \"default\" : \"outline\"}\r\n                  size=\"sm\"\r\n                  onClick={() => setBanDuration(days)}\r\n                >\r\n                  {days === \"1\" ? \"1 day\" : days === \"365\" ? \"1 year\" : `${days} days`}\r\n                </Button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setBanDialog(null)}>Cancel</Button>\r\n            <Button onClick={handleBan} className=\"bg-red-600 hover:bg-red-700\">\r\n              <Ban className=\"h-4 w-4 mr-2\" />\r\n              Ban for {banDuration} day{banDuration !== \"1\" ? \"s\" : \"\"}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\api\\upload-url\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\auth\\callback\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\categories\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\dashboard\\DashboardClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2495,2498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2495,2498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2583,2586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2583,2586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2726,2729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2726,2729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2828,2831],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2828,2831],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useApp } from \"@/lib/store\";\n\nimport SellerListingCard from \"@/components/seller/SellerListingCard\";\nimport MyBidCard from \"@/components/dashboard/MyBidCard\";\nimport WatchedItemCard from \"@/components/dashboard/WatchedItemCard\";\nimport ListingOffersCard from \"@/components/dashboard/ListingOffersCard\";\nimport { Tabs, TabsList } from \"@/components/ui/tabs\";\nimport { DashboardTab } from \"@/components/dashboard/DashboardTab\";\nimport { Bookmark, Gavel, Tag, Inbox } from \"lucide-react\";\nimport ProductDetailsModal from \"@/components/marketplace/ProductDetailsModal\";\nimport Link from \"next/link\";\nimport { Button } from \"@/components/ui/button\";\nimport { useState, useEffect } from \"react\";\nimport { Suspense } from \"react\";\nimport { useSearchParams, useRouter } from \"next/navigation\";\nimport DeleteConfirmationDialog from \"@/components/seller/DeleteConfirmationDialog\";\nimport { Item } from \"@/types\";\n\nimport { transformListingToItem } from \"@/lib/transform\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { supabase } from \"@/lib/supabase\";\n\nfunction DashboardContent() {\n  const { itemsById, bids, user, deleteItem, watchedItemIds } = useApp();\n  const [myItems, setMyItems] = useState<Item[]>([]);\n\n  \n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const tabParam = searchParams.get(\"tab\");\n  const initialTab = tabParam || \"offers\";\n  const [activeTab, setActiveTab] = useState(initialTab);\n  const [itemToDelete, setItemToDelete] = useState<Item | null>(null);\n  const [viewingItem, setViewingItem] = useState<Item | null>(null);\n  \n\n  useEffect(() => {\n    setActiveTab(initialTab);\n  }, [initialTab]);\n\n  useEffect(() => {\n    if (!tabParam) {\n      router.replace(`/dashboard?tab=${initialTab}`, { scroll: false });\n    }\n  }, [initialTab, router, tabParam]);\n\n  const handleTabChange = (value: string) => {\n    setActiveTab(value);\n    router.push(`/dashboard?tab=${value}`, { scroll: false });\n  };\n\n\n  // Fetch My Listings independently of the discovery feed\n  useEffect(() => {\n    if (!user) return;\n\n    const fetchMyItems = async () => {\n      try {\n        const { data, error } = await supabase\n          .from('listings')\n          .select('*, profiles!seller_id(*), bids(amount)')\n          .eq('seller_id', user.id)\n          .order('created_at', { ascending: false });\n\n        if (error) throw error;\n        if (data) {\n          const transformed = data.map(row => {\n            const bids = (row as any).bids || [];\n            const highBid = bids.length > 0 ? Math.max(...bids.map((b: any) => b.amount)) : undefined;\n            \n            return transformListingToItem({\n              ...row,\n              profiles: (row as any).profiles,\n              bid_count: bids.length,\n              high_bid: highBid\n            } as any);\n          });\n          setMyItems(transformed);\n        }\n      } catch (err) {\n        console.error(\"Error fetching my listings:\", err);\n      }\n    };\n\n    fetchMyItems();\n  }, [user]);\n\n  const handleDeleteClick = (item: Item) => {\n    setItemToDelete(item);\n  };\n\n  const confirmDelete = async () => {\n    if (itemToDelete) {\n      await deleteItem(itemToDelete.id);\n      setItemToDelete(null);\n      // Remove locally\n      setMyItems(prev => prev.filter(i => i.id !== itemToDelete.id));\n    }\n  };\n\n\n\n  const myBids = bids\n    .filter(b => b.bidderId === user?.id)\n    .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n  \n  // Offers received on MY listings (I'm the seller) - grouped by listing\n  const listingsWithOffers = myItems\n    .map(item => ({\n      item,\n      offers: bids\n        .filter(b => \n          b.itemId === item.id && \n          (b.status === 'pending' || b.status === 'accepted')\n        )\n        .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()) // Latest offers first within each listing\n    }))\n    .filter(group => group.offers.length > 0)\n    .sort((a, b) => {\n      // Sort listings by most recent offer activity\n      const latestA = Math.max(...a.offers.map(o => new Date(o.createdAt).getTime()));\n      const latestB = Math.max(...b.offers.map(o => new Date(o.createdAt).getTime()));\n      return latestB - latestA;\n    });\n  \n  // Total offer count for badge\n  const totalOfferCount = listingsWithOffers.reduce((sum, g) => sum + g.offers.length, 0);\n  \n  const watchedItems = watchedItemIds\n    .map(id => itemsById[id])\n    .filter(Boolean); // Only show items we have data for\n\n  return (\n    <div className=\"flex flex-col gap-6 p-4 md:p-6 max-w-7xl mx-auto w-full\">\n      \n      {/* Dashboard heading for accessibility */}\n      <h1 className=\"sr-only\">Dashboard</h1>\n\n      <Tabs value={activeTab} onValueChange={handleTabChange} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-4 mb-6 bg-slate-100 p-1 rounded-xl h-auto\">\n          <DashboardTab\n             id=\"dashboard-offers-tab\"\n             value=\"offers\"\n             icon={Inbox}\n             label=\"Selling\"\n             count={totalOfferCount}\n             badgeClassName=\"text-amber-700\"\n          />\n          <DashboardTab\n             id=\"dashboard-bids-tab\"\n             value=\"active-bids\"\n             icon={Gavel}\n             label=\"Buying\"\n             count={myBids.length}\n             badgeClassName=\"text-slate-700\"\n          />\n          <DashboardTab\n             id=\"dashboard-watchlist-tab\"\n             value=\"watchlist\"\n             icon={Bookmark}\n             label=\"Watchlist\"\n             count={watchedItems.length}\n             badgeClassName=\"text-slate-700\"\n          />\n          <DashboardTab\n             id=\"dashboard-listings-tab\"\n             value=\"listings\"\n             icon={Tag}\n             label=\"Listings\"\n             count={myItems.length}\n             badgeClassName=\"text-slate-700\"\n          />\n        </TabsList>\n\n        <AnimatePresence mode=\"wait\">\n              {/* 1. OFFERS TAB (Bids received on MY listings, grouped by listing) */}\n             {activeTab === 'offers' && (\n                <motion.div\n                    key=\"offers\"\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -10 }}\n                    transition={{ duration: 0.2 }}\n                    className=\"grid gap-4 grid-cols-1 lg:grid-cols-2\"\n                >\n                    {listingsWithOffers.length === 0 ? (\n                        <div className=\"flex flex-col items-center justify-center py-12 text-center text-slate-500 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200\">\n                            <Inbox className=\"w-12 h-12 text-slate-300 mb-3\" />\n                            <h3 className=\"text-lg font-bold text-slate-700\">No offers yet</h3>\n                            <p className=\"max-w-xs mx-auto mb-4\">When buyers bid on your listings, their offers will appear here.</p>\n                            <Link href=\"/sell\">\n                                <Button variant=\"outline\">Create a Listing</Button>\n                            </Link>\n                        </div>\n                    ) : (\n                        listingsWithOffers.map(({ item, offers }) => (\n                            <ListingOffersCard \n                                key={item.id} \n                                item={item} \n                                offers={offers} \n                            />\n                        ))\n                    )}\n                </motion.div>\n             )}\n\n              {/* 2. MY BIDS TAB */}\n             {activeTab === 'active-bids' && (\n                <motion.div\n                    key=\"active-bids\"\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -10 }}\n                    transition={{ duration: 0.2 }}\n                    className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2\"\n                >\n                    {myBids.length === 0 ? (\n                        <div className=\"col-span-full flex flex-col items-center justify-center py-12 text-center text-slate-500 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200\">\n                            <Gavel className=\"w-12 h-12 text-slate-300 mb-3\" />\n                            <h3 className=\"text-lg font-bold text-slate-700\">No active bids</h3>\n                            <p className=\"max-w-xs mx-auto mb-4\">You haven't placed any bids yet. Explore the marketplace to find deals!</p>\n                            <Link href=\"/\">\n                                <Button variant=\"outline\">Explore Marketplace</Button>\n                            </Link>\n                        </div>\n                    ) : (\n                        myBids.map(bid => {\n                            const item = itemsById[bid.itemId];\n                            // If we don't have the item in memory (e.g. not in feed), we might need to fetch it\n                            // For now, assume feed/involvedIds covers it. \n                            // TODO: Add separate involved items fetcher in context if missing.\n                            if (!item) return null; \n\n                            return (\n                                <MyBidCard \n                                    key={bid.id} \n                                    item={item} \n                                    userBid={bid} \n                                    seller={item.seller!} \n                                />\n                            );\n                        })\n                    )}\n                </motion.div>\n             )}\n\n             {/* 3. WATCHLIST TAB */}\n             {activeTab === 'watchlist' && (\n                <motion.div\n                    key=\"watchlist\"\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -10 }}\n                    transition={{ duration: 0.2 }}\n                    className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2\"\n                >\n                     {watchedItems.length === 0 ? (\n                        <div className=\"col-span-full flex flex-col items-center justify-center py-12 text-center text-slate-500 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200\">\n                            <Bookmark className=\"w-12 h-12 text-slate-300 mb-3\" />\n                            <h3 className=\"text-lg font-bold text-slate-700\">Watchlist is empty</h3>\n                            <p className=\"max-w-xs mx-auto mb-4\">Save items you're interested in to track their price and status.</p>\n                            <Link href=\"/\">\n                                <Button variant=\"outline\">Browse Items</Button>\n                            </Link>\n                        </div>\n                    ) : (\n                        watchedItems.map(item => (\n                             <WatchedItemCard\n                                key={item.id}\n                                item={item}\n                                seller={item.seller!}\n                            />\n                        ))\n                    )}\n                </motion.div>\n             )}\n\n             {/* 4. MY LISTINGS TAB */}\n             {activeTab === 'listings' && (\n                <motion.div\n                    key=\"listings\"\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -10 }}\n                    transition={{ duration: 0.2 }}\n                    className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2\"\n                >\n                    {myItems.length === 0 ? (\n                        <div className=\"col-span-full flex flex-col items-center justify-center py-12 text-center text-slate-500 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200\">\n                            <Tag className=\"w-12 h-12 text-slate-300 mb-3\" />\n                            <h3 className=\"text-lg font-bold text-slate-700\">No active listings</h3>\n                            <p className=\"max-w-xs mx-auto mb-4\">You aren't selling anything yet. Turn your unused items into cash!</p>\n                            <Link href=\"/sell\">\n                                <Button>Create Listing</Button>\n                            </Link>\n                        </div>\n                    ) : (\n                        myItems.map(item => (\n                            <SellerListingCard\n                                key={item.id}\n                                item={item}\n                                onView={() => setViewingItem(item)}\n                                onDelete={() => handleDeleteClick(item)}\n                            />\n                        ))\n                    )}\n                </motion.div>\n             )}\n        </AnimatePresence>\n      </Tabs>\n    \n      <DeleteConfirmationDialog \n        isOpen={!!itemToDelete}\n        onClose={() => setItemToDelete(null)}\n        onConfirm={confirmDelete}\n        itemTitle={itemToDelete?.title || ''}\n      />\n\n      {viewingItem && viewingItem.seller && (\n        <ProductDetailsModal \n          item={viewingItem} \n          seller={viewingItem.seller} \n          isOpen={true} \n          onClose={() => setViewingItem(null)} \n        />\n      )}\n    </div>\n  );\n}\n\nexport default function DashboardClient() {\n  return (\n    <Suspense fallback={<div className=\"p-8 text-center\">Loading dashboard...</div>}>\n      <DashboardContent />\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\dashboard\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\dashboard\\seller\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\data-deletion\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\i\\[id]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1365,1368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1365,1368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse, type NextRequest } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\nimport type { Database } from \"@/types/database.types\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || \"\";\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || \"\";\n\nconst isUuid = (value: string) =>\n  /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(value);\n\nconst redirectToInbox = (requestUrl: string, id?: string) => {\n  const target = id ? `/inbox?id=${id}` : \"/inbox\";\n  return NextResponse.redirect(new URL(target, requestUrl));\n};\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id: rawId } = await params;\n  const id = rawId?.trim();\n  \n  if (!id) return redirectToInbox(request.url);\n\n  // If it's a UUID, it's a direct ID\n  if (isUuid(id)) {\n    return redirectToInbox(request.url, id);\n  }\n\n  // Otherwise, it's a short_code. Lookup in DB.\n  if (!supabaseUrl || !supabaseAnonKey) {\n    return redirectToInbox(request.url);\n  }\n\n  const supabase = createClient<Database>(supabaseUrl, supabaseAnonKey, {\n    auth: { persistSession: false }\n  });\n\n  const { data } = await supabase\n    .from(\"conversations\")\n    .select(\"id\")\n    .eq(\"short_code\", id)\n    .maybeSingle();\n\n  return redirectToInbox(request.url, (data as any)?.id);\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\inbox\\InboxClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\inbox\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\list\\ListClient.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":447,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":447,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16458,16461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16458,16461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":498,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":498,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18582,18585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18582,18585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { \n  Select, \n  SelectContent, \n  SelectItem, \n  SelectTrigger, \n  SelectValue \n} from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Gavel, EyeOff, Camera, X, Save, Check, Loader2, ArrowLeft, ArrowRight, Star, Calendar, DollarSign, CreditCard, Clock, Calculator, Plus, Minus, Tag, Shapes, BadgeCheck, AlignLeft, Phone } from \"lucide-react\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { CATEGORIES, LISTING_IMAGE_ACCEPT, LISTING_LIMITS, isAllowedListingImageInput } from \"@/lib/constants\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport { Suspense } from \"react\";\nimport confetti from \"canvas-confetti\";\nimport { useApp } from \"@/lib/store\";\nimport { cn } from \"@/lib/utils\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { uploadListingImage } from \"@/lib/uploadImage\";\nimport { supabase } from \"@/lib/supabase\";\nimport { generateSlug, formatPrice, formatCountdown } from \"@/lib/utils\";\nimport { toast } from \"sonner\";\nimport { sonic } from \"@/lib/sonic\";\nimport { transformListingToItem } from \"@/lib/transform\";\nimport { Item } from \"@/types\";\nimport { roundToReasonablePrice } from \"@/lib/bidding\";\nimport { calculateDepreciation, formatPriceEstimate, getPurchaseYearOptions, getPurchaseMonthOptions, DepreciationResult } from \"@/lib/depreciation\";\nimport { processListingImage } from \"@/lib/processListingImage\";\nimport { MapPicker } from \"@/components/common/MapPicker\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { useTime } from \"@/context/TimeContext\";\nimport { MapPin } from \"lucide-react\";\n\nconst EDIT_WARNING_TITLE = \"Editing resets bids\";\nconst EDIT_WARNING_DESCRIPTION = \"Saving changes will delete all bids and relaunch this listing in 1 hour.\";\nconst EDIT_WARNING_CONFIRM = \"Save & Reset Bids\";\nconst EDIT_WARNING_CANCEL = \"Keep Editing\";\nconst GO_LIVE_NOTE = \"Goes live in 1 hour after saving.\";\nconst EDIT_COOLDOWN_TOAST = \"You can edit this listing again in\";\nconst MAX_IMAGES = 5;\nconst DRAFT_KEY = \"boliyan_listing_draft\";\n\nfunction ListForm() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const editId = searchParams.get(\"id\");\n  const { items, user, myLocation, openAuthModal, isLoading: isAuthLoading } = useApp();\n  const { now } = useTime();\n  \n  useEffect(() => {\n    if (!isAuthLoading && !user) {\n      openAuthModal();\n      return;\n    }\n    \n    if (user && (!user.emailVerified || !user.profileComplete)) {\n      router.push(`/complete-profile?redirect=${encodeURIComponent(window.location.pathname)}`);\n    }\n  }, [user, isAuthLoading, openAuthModal, router]);\n  \n  const [fetchedItem, setFetchedItem] = useState<Item | null>(null);\n  const [isLoadingItem, setIsLoadingItem] = useState(!!editId);\n  \n  const editingItem = (editId ? items.find(i => i.id === editId) : null) || fetchedItem;\n\n  const lastEditedAtMs = editingItem?.lastEditedAt ? new Date(editingItem.lastEditedAt).getTime() : null;\n  const editCooldownUntil = lastEditedAtMs ? lastEditedAtMs + 60 * 60 * 1000 : null;\n  const isEditCooldown = editCooldownUntil !== null && now < editCooldownUntil;\n  const editCooldownLabel = isEditCooldown && editCooldownUntil ? formatCountdown(editCooldownUntil, now) : null;\n\n  // Fetch Item details if not in global state\n  useEffect(() => {\n    if (!editId || (editId && items.find(i => i.id === editId))) {\n      setIsLoadingItem(false);\n      return;\n    }\n\n    const fetchItem = async () => {\n      setIsLoadingItem(true);\n      try {\n        const { data, error } = await supabase\n          .from('marketplace_listings')\n          .select('*')\n          .eq('id', editId)\n          .single();\n\n        if (error) throw error;\n        if (data) {\n          setFetchedItem(transformListingToItem(data as unknown as ListingWithSeller));\n        }\n      } catch (err) {\n        console.error(\"Error fetching item for edit:\", err);\n        toast.error(\"Failed to load item details\");\n      } finally {\n        setIsLoadingItem(false);\n      }\n    };\n\n    fetchItem();\n  }, [editId, items]);\n  \n  const [title, setTitle] = useState(\"\");\n  const [category, setCategory] = useState<string>(\"\");\n  const [askPrice, setAskPrice] = useState<string>(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [isPublic, setIsPublic] = useState(true);\n  const [duration, setDuration] = useState<\"24\" | \"168\" | \"720\">(\"720\");\n  const [condition, setCondition] = useState<'new' | 'like_new' | 'used' | 'fair'>(\"used\");\n  const [purchasePrice, setPurchasePrice] = useState<string>(\"\");\n  const [purchaseYear, setPurchaseYear] = useState<string>(\"\");\n  const [purchaseMonth, setPurchaseMonth] = useState<string>(\"\");\n  const [currentNewPrice] = useState<string>(\"\");\n  const [contactPhone, setContactPhone] = useState(\"\");\n  const [contactWhatsapp, setContactWhatsapp] = useState(\"\");\n  const [isWhatsappSameAsPhone, setIsWhatsappSameAsPhone] = useState(true);\n  const [showPriceEstimator, setShowPriceEstimator] = useState(false);\n  const [location, setLocation] = useState<{lat: number, lng: number, address: string, city?: string} | null>(null);\n  const [isMapGeocoding, setIsMapGeocoding] = useState(false);\n  const [isDraftRestored, setIsDraftRestored] = useState(false);\n\n  // Sync WhatsApp with Phone if enabled\n  useEffect(() => {\n    if (isWhatsappSameAsPhone) {\n      setContactWhatsapp(contactPhone);\n    }\n  }, [contactPhone, isWhatsappSameAsPhone]);\n\n  // Restore Draft from LocalStorage\n  useEffect(() => {\n    if (editingItem || isAuthLoading || !user) return;\n\n    const savedDraft = localStorage.getItem(DRAFT_KEY);\n    if (savedDraft) {\n      try {\n        const draft = JSON.parse(savedDraft);\n        if (draft.title) setTitle(draft.title);\n        if (draft.category) setCategory(draft.category);\n        if (draft.askPrice) setAskPrice(draft.askPrice);\n        if (draft.description) setDescription(draft.description);\n        if (draft.contactPhone) setContactPhone(draft.contactPhone);\n        if (draft.contactWhatsapp) {\n            setContactWhatsapp(draft.contactWhatsapp);\n            setIsWhatsappSameAsPhone(draft.contactWhatsapp === draft.contactPhone);\n        }\n        if (draft.location) setLocation(draft.location);\n        if (draft.condition) setCondition(draft.condition);\n        if (draft.isPublic !== undefined) setIsPublic(draft.isPublic);\n        if (draft.duration) setDuration(draft.duration);\n        \n        setIsDraftRestored(true);\n        // Toast once\n        toast.success(\"Draft restored\", {\n          description: \"All text fields recovered. Please re-upload images.\"\n        });\n      } catch (err) {\n        console.error(\"Failed to restore draft\", err);\n      }\n    }\n  }, [editingItem, isAuthLoading, user]);\n  \n  // Default to global myLocation for new listings if no location is set (e.g. from draft)\n  useEffect(() => {\n    if (editingItem || isAuthLoading) return;\n    \n    if (myLocation && !location) {\n      setLocation(myLocation);\n    }\n  }, [editingItem, isAuthLoading, myLocation, location]);\n\n  // Save Draft to LocalStorage\n  useEffect(() => {\n    if (editingItem || !user) return;\n\n    const draft = {\n      title,\n      category,\n      askPrice,\n      description,\n      contactPhone,\n      contactWhatsapp,\n      location,\n      condition,\n      isPublic,\n      duration\n    };\n    \n    localStorage.setItem(DRAFT_KEY, JSON.stringify(draft));\n  }, [title, category, askPrice, description, contactPhone, contactWhatsapp, location, condition, isPublic, duration, editingItem, user]);\n  \n  // Computed price estimate\n  const priceEstimate: DepreciationResult | null = React.useMemo(() => {\n    const price = parseFloat(purchasePrice);\n    const year = parseInt(purchaseYear);\n    if (!category || !price || !year || isNaN(price) || isNaN(year)) return null;\n    const newPrice = parseFloat(currentNewPrice);\n    const month = parseInt(purchaseMonth);\n    return calculateDepreciation({\n      purchasePrice: price,\n      purchaseYear: year,\n      purchaseMonth: isNaN(month) ? undefined : month,\n      category,\n      condition,\n      currentNewPrice: isNaN(newPrice) || newPrice <= 0 ? undefined : newPrice,\n    });\n  }, [purchasePrice, purchaseYear, purchaseMonth, category, condition, currentNewPrice]);\n  \n  type ImageEntry = {\n    id: string;\n    url: string;\n    file?: File;\n    isNew: boolean;\n  };\n\n  const [imageEntries, setImageEntries] = useState<ImageEntry[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [isProcessingImages, setIsProcessingImages] = useState(false);\n  const [showEditWarning, setShowEditWarning] = useState(false);\n\n  const [errors, setErrors] = useState<{\n    title?: boolean;\n    category?: boolean;\n    askPrice?: boolean;\n    description?: boolean;\n    contactPhone?: boolean;\n    images?: boolean;\n    location?: boolean;\n    purchasePrice?: boolean;\n    purchaseYear?: boolean;\n  }>({});\n\n  useEffect(() => {\n    if (editingItem) {\n      setTitle(editingItem.title);\n      setCategory(editingItem.category);\n      setAskPrice(editingItem.askPrice.toString());\n      setDescription(editingItem.description || \"\");\n      setIsPublic(editingItem.isPublicBid);\n      if (editingItem.location) {\n        setLocation(editingItem.location);\n      }\n      setImageEntries(\n        editingItem.images.map((url: string, index: number) => ({\n          id: `existing-${index}`,\n          url,\n          isNew: false\n        }))\n      );\n      setDuration(editingItem.listingDuration.toString() as \"24\" | \"168\" | \"720\");\n      setCondition(editingItem.condition || \"used\");\n      setContactPhone(editingItem.contactPhone || user?.phone || \"\");\n      setContactWhatsapp(editingItem.contactWhatsapp || user?.whatsapp || editingItem.contactPhone || user?.phone || \"\");\n      setIsWhatsappSameAsPhone(editingItem.contactWhatsapp === editingItem.contactPhone);\n      return;\n    }\n\n    // New Listing defaults\n    if (user) {\n        if (user.phone && !contactPhone && !isDraftRestored) setContactPhone(user.phone);\n        if (user.whatsapp && !contactWhatsapp && !isDraftRestored) {\n            setContactWhatsapp(user.whatsapp);\n            setIsWhatsappSameAsPhone(user.whatsapp === user.phone);\n        }\n    }\n  }, [editingItem, user, contactPhone, contactWhatsapp, isDraftRestored]);\n\n  const isValidPhone = (value: string) => value.replace(/\\D/g, \"\").length >= 10;\n\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (files) {\n      if (isProcessingImages) {\n        toast.info(\"Please wait for image processing to finish.\");\n        e.target.value = \"\";\n        return;\n      }\n      const newFiles = Array.from(files);\n      const allowedFiles = newFiles.filter(isAllowedListingImageInput);\n      const rejectedCount = newFiles.length - allowedFiles.length;\n      if (rejectedCount > 0) {\n        toast.error(\"Only JPG, PNG, or iPhone HEIC/HEIF images are allowed.\");\n      }\n      if (allowedFiles.length === 0) return;\n\n      const remainingSlots = Math.max(0, MAX_IMAGES - imageEntries.length);\n      if (remainingSlots === 0) {\n        toast.error(`Image limit reached (max ${MAX_IMAGES}).`);\n        return;\n      }\n\n      if (allowedFiles.length > remainingSlots) {\n        toast.info(`Only ${remainingSlots} more image${remainingSlots === 1 ? \"\" : \"s\"} allowed.`);\n      }\n\n      const filesToProcess = allowedFiles.slice(0, remainingSlots);\n      const processedEntries: ImageEntry[] = [];\n      let rejectedOversize = 0;\n      let rejectedProcessing = 0;\n\n      setIsProcessingImages(true);\n      try {\n        for (const file of filesToProcess) {\n          try {\n            const processed = await processListingImage(file);\n            processedEntries.push({\n              id: `new-${Date.now()}-${Math.random().toString(36).slice(2, 7)}`,\n              url: URL.createObjectURL(processed),\n              file: processed,\n              isNew: true\n            });\n          } catch (error) {\n            if (error instanceof Error && error.message.includes(\"exceeds 1MB\")) {\n              rejectedOversize += 1;\n            } else {\n              rejectedProcessing += 1;\n            }\n          }\n        }\n      } finally {\n        setIsProcessingImages(false);\n      }\n\n      if (rejectedOversize > 0) {\n        toast.error(\"Some images exceed 1MB after compression.\");\n      }\n      if (rejectedProcessing > 0) {\n        toast.error(\"Some images could not be processed.\");\n      }\n\n      if (processedEntries.length > 0) {\n        setImageEntries(prev => [...prev, ...processedEntries]);\n      } else {\n        toast.error(\"No images were added.\");\n      }\n    }\n    e.target.value = \"\";\n  };\n\n  const removeImage = (index: number) => {\n    setImageEntries(prev => {\n      const entry = prev[index];\n      if (entry?.file && entry.url.startsWith(\"blob:\")) {\n        URL.revokeObjectURL(entry.url);\n      }\n      return prev.filter((_, i) => i !== index);\n    });\n  };\n\n  const moveImage = (from: number, to: number) => {\n    setImageEntries(prev => {\n      if (to < 0 || to >= prev.length) return prev;\n      const updated = [...prev];\n      const [moved] = updated.splice(from, 1);\n      updated.splice(to, 0, moved);\n      return updated;\n    });\n  };\n\n  const makeMainImage = (index: number) => {\n    if (index === 0) return;\n    moveImage(index, 0);\n  };\n\n  const submitListing = async () => {\n    if (!user) {\n        router.push('/signin');\n        return;\n    }\n\n    if (isProcessingImages) {\n      toast.info(\"Please wait for images to finish processing.\");\n      return;\n    }\n\n    const priceNum = parseFloat(askPrice);\n    const roundedPrice = roundToReasonablePrice(priceNum);\n    \n    const newErrors = {\n      title: title.length < LISTING_LIMITS.TITLE.MIN || title.length > LISTING_LIMITS.TITLE.MAX,\n      category: !category,\n      askPrice: isNaN(priceNum) || priceNum < LISTING_LIMITS.PRICE.MIN || priceNum > LISTING_LIMITS.PRICE.MAX,\n      description: description.length < LISTING_LIMITS.DESCRIPTION.MIN || description.length > LISTING_LIMITS.DESCRIPTION.MAX,\n      contactPhone: !isValidPhone(contactPhone),\n      images: imageEntries.length < 1,\n      location: !location,\n      purchasePrice: false,\n      purchaseYear: false\n    };\n\n    setErrors(newErrors);\n\n    if (Object.values(newErrors).some(Boolean)) {\n      if (newErrors.images) toast.error(\"At least one image is required\");\n      if (newErrors.location) toast.error(\"Location is required\");\n      toast.error(\"Please fix the highlighted fields.\");\n      return;\n    }\n\n    if (roundedPrice !== priceNum) {\n      setAskPrice(roundedPrice.toString());\n      toast.info(`Price rounded to Rs. ${roundedPrice.toLocaleString()} for better bidding.`);\n    }\n\n    setIsUploading(true);\n\n    try {\n        const updatedEntries = await Promise.all(\n          imageEntries.map(async (entry) => {\n            if (!entry.file) return entry;\n            const uploadedUrl = await uploadListingImage(entry.file);\n            return {\n              ...entry,\n              url: uploadedUrl,\n              file: undefined,\n              isNew: false\n            };\n          })\n        );\n\n        const orderedUrls = updatedEntries.map(entry => entry.url);\n        const finalDurationNum = parseInt(duration) as 24 | 168 | 720;\n        const endsAt = new Date(Date.now() + finalDurationNum * 60 * 60 * 1000).toISOString();\n\n          const listingPayload = {\n            title,\n            category,\n            asked_price: roundedPrice,\n            description,\n            contact_phone: contactPhone.trim(),\n            contact_whatsapp: contactWhatsapp.trim(),\n            auction_mode: (isPublic ? 'visible' : 'hidden') as 'visible' | 'hidden',\n            images: orderedUrls,\n            condition: condition,\n            ends_at: endsAt,\n            listing_duration: finalDurationNum,\n            location_lat: location!.lat,\n            location_lng: location!.lng,\n            location_address: location!.address\n          };\n\n          if (editingItem) {\n            const { error } = await (supabase as any)\n              .rpc('edit_listing_with_cooldown', {\n                p_listing_id: editingItem.id,\n                p_title: listingPayload.title,\n                p_description: listingPayload.description,\n                p_category: listingPayload.category,\n                p_asked_price: listingPayload.asked_price,\n                p_contact_phone: listingPayload.contact_phone,\n                p_contact_whatsapp: listingPayload.contact_whatsapp,\n                p_auction_mode: listingPayload.auction_mode,\n                p_images: listingPayload.images,\n                p_condition: listingPayload.condition,\n                p_ends_at: listingPayload.ends_at,\n                p_listing_duration: listingPayload.listing_duration,\n                p_location_lat: location!.lat,\n                p_location_lng: location!.lng,\n                p_location_address: location!.address\n              });\n\n          if (error) {\n            if (error.message?.includes('COOLDOWN_ACTIVE')) {\n              const label = editCooldownLabel ? ` ${editCooldownLabel}` : '';\n              toast.error(`${EDIT_COOLDOWN_TOAST}${label}`);\n              return;\n            }\n            throw error;\n          }\n          toast.success(\"Listing updated\", {\n            description: GO_LIVE_NOTE\n          });\n          \n          // Celebration\n          const btn = document.getElementById(\"post-listing-btn\");\n          const rect = btn?.getBoundingClientRect();\n          const confettiX = rect ? (rect.left + rect.width / 2) / window.innerWidth : 0.5;\n          const confettiY = rect ? (rect.top + rect.height / 2) / window.innerHeight : 0.5;\n          \n          sonic.confetti();\n          confetti({\n            origin: { x: confettiX, y: confettiY },\n            particleCount: 100,\n            spread: 70,\n            gravity: 1.2,\n            scalar: 0.8,\n            zIndex: 9999,\n            colors: ['#fbbf24', '#f59e0b', '#d97706', '#ffffff'],\n          });\n\n          localStorage.removeItem(DRAFT_KEY);\n          setTimeout(() => router.push(\"/\"), 800);\n        } else {\n          const { error } = await (supabase as any).rpc('create_listing', {\n            p_title: listingPayload.title,\n            p_description: listingPayload.description,\n            p_category: listingPayload.category,\n            p_asked_price: listingPayload.asked_price,\n            p_contact_phone: listingPayload.contact_phone,\n            p_contact_whatsapp: listingPayload.contact_whatsapp,\n            p_auction_mode: listingPayload.auction_mode,\n            p_images: listingPayload.images,\n            p_condition: listingPayload.condition,\n            p_ends_at: listingPayload.ends_at,\n            p_listing_duration: listingPayload.listing_duration,\n            p_location_lat: location!.lat,\n            p_location_lng: location!.lng,\n            p_location_address: location!.address,\n            p_slug: generateSlug(title)\n          });\n\n          if (error) throw error;\n          toast.success(\"Listing created\", {\n            description: GO_LIVE_NOTE\n          });\n          \n          // Celebration\n          const btn = document.getElementById(\"post-listing-btn\");\n          const rect = btn?.getBoundingClientRect();\n          const confettiX = rect ? (rect.left + rect.width / 2) / window.innerWidth : 0.5;\n          const confettiY = rect ? (rect.top + rect.height / 2) / window.innerHeight : 0.5;\n          \n          sonic.confetti();\n          confetti({\n            origin: { x: confettiX, y: confettiY },\n            particleCount: 100,\n            spread: 70,\n            gravity: 1.2,\n            scalar: 0.8,\n            zIndex: 9999,\n            colors: ['#fbbf24', '#f59e0b', '#d97706', '#ffffff'],\n          });\n\n          localStorage.removeItem(DRAFT_KEY);\n          setTimeout(() => router.push(\"/\"), 800);\n        }\n\n    } catch (error) {\n        console.error(\"Error creating listing:\", error);\n        const message = error instanceof Error ? error.message : \"Please try again in a moment.\";\n        toast.error(\"Listing not saved\", {\n          description: message\n        });\n    } finally {\n        setIsUploading(false);\n    }\n  };\n\n  const handleSubmit = () => {\n    if (editingItem) {\n      if (isEditCooldown) {\n        const label = editCooldownLabel ? ` ${editCooldownLabel}` : '';\n        toast.error(`${EDIT_COOLDOWN_TOAST}${label}`);\n        return;\n      }\n      setShowEditWarning(true);\n      return;\n    }\n\n    submitListing();\n  };\n\n  return (\n    <div id=\"list-page-container\" className=\"container mx-auto max-w-2xl py-12 px-4\">\n      <Card id=\"list-item-card\" className=\"border-none shadow-lg bg-white\">\n        <CardHeader id=\"list-item-header\" className=\"space-y-1\">\n          <CardTitle id=\"list-item-title-heading\" className=\"text-2xl font-bold text-slate-900\">\n            {isLoadingItem ? \"Loading...\" : editingItem ? \"Edit Listing\" : \"Create New Listing\"}\n          </CardTitle>\n          <CardDescription id=\"list-item-description-text\">\n            {isLoadingItem ? \"Fetching item details...\" : editingItem ? \"Update your item details and bidding strategy.\" : \"Enter your item details and set a fair price to attract the best bids.\"}\n          </CardDescription>\n        </CardHeader>\n        <CardContent id=\"list-item-form\" className=\"space-y-6\">\n          <Dialog open={showEditWarning} onOpenChange={setShowEditWarning}>\n            <DialogContent id=\"edit-warning-dialog\">\n              <DialogHeader id=\"edit-warning-header\">\n                <DialogTitle id=\"edit-warning-title\">{EDIT_WARNING_TITLE}</DialogTitle>\n                <DialogDescription id=\"edit-warning-description\">\n                  {EDIT_WARNING_DESCRIPTION}\n                </DialogDescription>\n              </DialogHeader>\n              <DialogFooter id=\"edit-warning-footer\">\n                <Button\n                  id=\"edit-warning-cancel-btn\"\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setShowEditWarning(false)}\n                >\n                  {EDIT_WARNING_CANCEL}\n                </Button>\n                <Button\n                  id=\"edit-warning-confirm-btn\"\n                  type=\"button\"\n                  className=\"bg-blue-600 hover:bg-blue-700\"\n                  onClick={() => {\n                    setShowEditWarning(false);\n                    submitListing();\n                  }}\n                >\n                  {EDIT_WARNING_CONFIRM}\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n          {isLoadingItem ? (\n            <div className=\"flex flex-col items-center justify-center py-12 gap-4\">\n              <Loader2 className=\"h-12 w-12 animate-spin text-blue-600 opacity-20\" />\n              <p className=\"text-slate-400 font-medium text-sm\">Securing details...</p>\n            </div>\n          ) : (\n            <motion.div \n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              className=\"space-y-6\"\n            >\n              {/* Image Section */}\n              <div className=\"space-y-4\">\n                <Label id=\"images-label\" className=\"text-sm font-semibold text-slate-900 flex items-center gap-1.5\">\n                  <Camera className=\"h-3.5 w-3.5 text-slate-500\" />\n                  Product Images (Max {MAX_IMAGES})\n                </Label>\n                <div id=\"images-preview-container\" className=\"flex gap-4 overflow-x-auto pb-2 scrollbar-hide\">\n                  {imageEntries.map((entry, index) => (\n                    <div key={entry.id} id={`image-preview-${index}`} className=\"relative h-28 w-28 shrink-0 rounded-xl overflow-hidden border border-slate-100 shadow-sm group\">\n                      <img src={entry.url} alt=\"\" className=\"h-full w-full object-cover\" />\n                      {index === 0 && (\n                        <div id={`main-image-badge-${index}`} className=\"absolute top-1.5 left-1.5 px-2 py-0.5 rounded-full bg-blue-600 text-white text-[9px] font-bold tracking-wide uppercase shadow-sm\">\n                          Main\n                        </div>\n                      )}\n                      <div className=\"absolute bottom-1.5 left-1.5 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                        <button\n                          id={`move-image-left-btn-${index}`}\n                          type=\"button\"\n                          onClick={() => moveImage(index, index - 1)}\n                          className=\"h-6 w-6 flex items-center justify-center rounded-full bg-white/90 text-slate-600 shadow-sm hover:text-blue-600 hover:bg-blue-50 transition-all disabled:opacity-30 disabled:pointer-events-none\"\n                          disabled={index === 0}\n                        >\n                          <ArrowLeft className=\"h-3 w-3\" />\n                        </button>\n                        <button\n                          id={`move-image-right-btn-${index}`}\n                          type=\"button\"\n                          onClick={() => moveImage(index, index + 1)}\n                          className=\"h-6 w-6 flex items-center justify-center rounded-full bg-white/90 text-slate-600 shadow-sm hover:text-blue-600 hover:bg-blue-50 transition-all disabled:opacity-30 disabled:pointer-events-none\"\n                          disabled={index === imageEntries.length - 1}\n                        >\n                          <ArrowRight className=\"h-3 w-3\" />\n                        </button>\n                        <button\n                          id={`make-main-image-btn-${index}`}\n                          type=\"button\"\n                          onClick={() => makeMainImage(index)}\n                          className=\"h-6 w-6 flex items-center justify-center rounded-full bg-white/90 text-slate-600 shadow-sm hover:text-amber-600 hover:bg-amber-50 transition-all disabled:opacity-30 disabled:pointer-events-none\"\n                          disabled={index === 0}\n                        >\n                          <Star className=\"h-3 w-3\" />\n                        </button>\n                      </div>\n                      <button \n                        id={`remove-image-btn-${index}`}\n                        onClick={() => removeImage(index)}\n                        className=\"absolute top-1.5 right-1.5 p-1.5 bg-white/90 rounded-full hover:bg-red-50 hover:text-red-500 shadow-sm transition-all opacity-100 md:opacity-0 md:group-hover:opacity-100\"\n                      >\n                        <X className=\"h-3.5 w-3.5\" />\n                      </button>\n                    </div>\n                  ))}\n                  {imageEntries.length < MAX_IMAGES && (\n                    <label \n                      id=\"add-image-label\"\n                      className=\"h-28 w-28 shrink-0 rounded-xl border-2 border-dashed border-slate-200 flex flex-col items-center justify-center cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-all group\"\n                    >\n                      <Camera id=\"camera-icon\" className=\"h-7 w-7 text-slate-400 mb-1 group-hover:text-blue-500 transition-colors\" />\n                      <span id=\"add-photo-text\" className=\"text-[11px] text-slate-500 font-bold group-hover:text-blue-600\">Add Photo</span>\n                      <input id=\"image-upload-input\" type=\"file\" multiple accept={LISTING_IMAGE_ACCEPT} className=\"hidden\" onChange={handleImageUpload} />\n                    </label>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"title\" className=\"flex items-center justify-between gap-1\">\n                  <div className=\"flex items-center gap-1\">\n                    <Tag className=\"h-3.5 w-3.5 text-slate-500\" />\n                    Item Title <span className=\"text-red-500\">*</span>\n                  </div>\n                  <span className={cn(\n                    \"text-[10px] font-bold transition-colors\",\n                    title.length > LISTING_LIMITS.TITLE.MAX ? \"text-red-500\" : \"text-slate-400\"\n                  )}>\n                    {title.length} / {LISTING_LIMITS.TITLE.MAX}\n                  </span>\n                </Label>\n                <Input \n                  id=\"title-input\" \n                  placeholder=\"e.g. Sony Headphones, Wood Table...\" \n                  className={`transition-all ${errors.title ? \"border-red-500 bg-red-50/50 ring-red-500/20\" : \"bg-slate-50 border-slate-100\"}`} \n                  value={title}\n                  maxLength={LISTING_LIMITS.TITLE.MAX}\n                  onChange={(e) => {\n                    const val = e.target.value.slice(0, LISTING_LIMITS.TITLE.MAX);\n                    setTitle(val);\n                    if (errors.title) setErrors(prev => ({ ...prev, title: false }));\n                  }}\n                />\n                <AnimatePresence>\n                  {errors.title && (\n                    <motion.p \n                      initial={{ opacity: 0, y: -10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      exit={{ opacity: 0, y: -10 }}\n                      className=\"text-[10px] font-bold text-red-500\"\n                    >\n                      {title.length < LISTING_LIMITS.TITLE.MIN \n                        ? `Title must be at least ${LISTING_LIMITS.TITLE.MIN} characters` \n                        : `Title cannot exceed ${LISTING_LIMITS.TITLE.MAX} characters`}\n                    </motion.p>\n                  )}\n                </AnimatePresence>\n              </div>\n\n              {/* Category + Condition Row */}\n              <div className=\"grid grid-cols-2 gap-6\">\n                <div className=\"space-y-2\">\n                  <Label className=\"flex items-center gap-1\">\n                    <Shapes className=\"h-3.5 w-3.5 text-slate-500\" />\n                    Category <span className=\"text-red-500\">*</span>\n                  </Label>\n                  <Select \n                    value={category} \n                    onValueChange={(val) => {\n                      setCategory(val);\n                      if (errors.category) setErrors(prev => ({ ...prev, category: false }));\n                    }}\n                  >\n                    <SelectTrigger \n                      id=\"category-select\" \n                      className={`transition-all w-full h-10 ${errors.category ? \"border-red-500 bg-red-50/50\" : \"bg-slate-50 border-slate-100\"}`}\n                    >\n                      <SelectValue placeholder=\"Select Category\" />\n                    </SelectTrigger>\n                    <SelectContent id=\"category-select-content\">\n                      {CATEGORIES.filter(c => c.label !== \"All Items\").map(cat => {\n                        const Icon = cat.icon;\n                        return (\n                          <SelectItem key={cat.label} value={cat.label} className=\"py-2\">\n                            <div className=\"flex items-center gap-2\">\n                              <Icon className=\"h-4 w-4\" />\n                              <span>{cat.label}</span>\n                            </div>\n                          </SelectItem>\n                        );\n                      })}\n                    </SelectContent>\n                  </Select>\n                  {errors.category && (\n                    <p className=\"text-[10px] font-bold text-red-500\">Required</p>\n                  )}\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <Label className=\"flex items-center gap-1\">\n                    <BadgeCheck className=\"h-3.5 w-3.5 text-slate-500\" />\n                    Condition\n                  </Label>\n                  <Select \n                    value={condition} \n                    onValueChange={(val: 'new' | 'like_new' | 'used' | 'fair') => setCondition(val)}\n                  >\n                    <SelectTrigger id=\"condition-select\" className=\"bg-slate-50 border-slate-100 h-10 w-full\">\n                      <SelectValue placeholder=\"Select Condition\" />\n                    </SelectTrigger>\n                    <SelectContent id=\"condition-select-content\">\n                      <SelectItem value=\"new\">≡ƒîƒ Brand New</SelectItem>\n                      <SelectItem value=\"like_new\">Γ£¿ Like New</SelectItem>\n                      <SelectItem value=\"used\">≡ƒæî Used</SelectItem>\n                      <SelectItem value=\"fair\">≡ƒö¿ Fair</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              {/* Price Estimator Toggle */}\n              <div className=\"space-y-3\">\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPriceEstimator(!showPriceEstimator)}\n                  className={`flex items-center gap-2 px-4 py-2.5 rounded-xl font-bold text-xs transition-all w-full md:w-auto justify-center ${\n                    showPriceEstimator \n                      ? \"bg-slate-100 text-slate-600 hover:bg-slate-200\" \n                      : \"bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200/50\"\n                  }`}\n                >\n                  <Calculator className=\"w-4 h-4\" />\n                  {showPriceEstimator ? \"Hide Price Estimator\" : \"Help me price this item\"}\n                </button>\n\n                <AnimatePresence>\n                  {showPriceEstimator && (\n                    <motion.div\n                      initial={{ opacity: 0, height: 0 }}\n                      animate={{ opacity: 1, height: 'auto' }}\n                      exit={{ opacity: 0, height: 0 }}\n                      className=\"overflow-hidden\"\n                    >\n                      <div className=\"p-3 rounded-lg border border-slate-200 bg-slate-50/50 space-y-2\">\n                        \n                        <div className=\"space-y-3\">\n                          {/* Paid Price */}\n                          <div className=\"space-y-1\">\n                            <Label htmlFor=\"purchase-price-input\" className=\"text-[10px] uppercase font-bold text-slate-500 flex items-center gap-1\">\n                              <CreditCard className=\"w-3 h-3\" /> Purchase Price (Rs.)\n                            </Label>\n                            <Input \n                              id=\"purchase-price-input\" \n                              type=\"number\" \n                              placeholder=\"Purchase Price\" \n                              value={purchasePrice}\n                              onChange={(e) => {\n                                setPurchasePrice(e.target.value);\n                                if (errors.purchasePrice) setErrors(prev => ({ ...prev, purchasePrice: false }));\n                              }}\n                              className={`h-9 text-sm bg-white ${errors.purchasePrice ? \"border-red-500\" : \"border-slate-200\"}`} \n                            />\n                          </div>\n                          \n                          {/* Date (Month + Year) */}\n                          <div className=\"space-y-1\">\n                            <Label className=\"text-[10px] uppercase font-bold text-slate-500 flex items-center gap-1\">\n                              <Calendar className=\"w-3 h-3\" /> Date\n                            </Label>\n                             <div className=\"flex gap-2 w-full\">\n                              <div className=\"flex-[2] min-w-[100px]\">\n                                <Select value={purchaseMonth} onValueChange={setPurchaseMonth}>\n                                  <SelectTrigger id=\"purchase-month-select\" className=\"h-9 text-xs bg-white border-slate-200 px-2 w-full min-w-[100px]\">\n                                    <SelectValue placeholder=\"Month\" />\n                                  </SelectTrigger>\n\n\n                                   <SelectContent id=\"purchase-month-select-content\">\n                                    {getPurchaseMonthOptions().map(m => (\n                                      <SelectItem key={m.value} value={m.value.toString()} className=\"text-xs\">{m.label}</SelectItem>\n                                    ))}\n                                   </SelectContent>\n\n                                </Select>\n                              </div>\n                              <div className=\"flex-[3] min-w-[110px]\">\n                                <Select \n                                  value={purchaseYear} \n                                  onValueChange={(val) => {\n                                    setPurchaseYear(val);\n                                    if (errors.purchaseYear) setErrors(prev => ({ ...prev, purchaseYear: false }));\n                                  }}\n                                >\n                                  <SelectTrigger \n                                    id=\"purchase-year-select\" \n                                    className={`h-9 text-xs bg-white px-2 w-full min-w-[110px] ${errors.purchaseYear ? \"border-red-500\" : \"border-slate-200\"}`}\n                                  >\n                                    <SelectValue placeholder=\"Year\" />\n                                  </SelectTrigger>\n                                  <SelectContent id=\"purchase-year-select-content\">\n                                    {getPurchaseYearOptions().map(year => (\n                                      <SelectItem key={year} value={year.toString()} className=\"text-xs\">{year}</SelectItem>\n                                    ))}\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n\n                      </div>\n                    </motion.div>\n                  )}\n                </AnimatePresence>\n              </div>\n\n              {/* Price Suggestion + Ask Price in one block */}\n              <AnimatePresence>\n                {priceEstimate && (\n                  <motion.div\n                    id=\"price-estimate-suggestion\"\n                    initial={{ opacity: 0, height: 0 }}\n                    animate={{ opacity: 1, height: 'auto' }}\n                    exit={{ opacity: 0, height: 0 }}\n                    className=\"p-3 rounded-lg bg-amber-50 border border-amber-200\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-lg\">≡ƒÆí</span>\n                      <p className=\"text-sm font-bold text-amber-900\">\n                        Suggested: {formatPriceEstimate(priceEstimate)}\n                      </p>\n                      <span className=\"text-[10px] text-amber-600 ml-auto font-bold\">\n                        {priceEstimate.yearsOwned.toFixed(1)} years old\n                      </span>\n                    </div>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n\n              {/* Ask Price - Now after suggestion */}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"price-input\" className=\"flex items-center justify-between\">\n                  <span className=\"text-[10px] uppercase font-bold text-slate-500 flex items-center gap-1\">\n                    <DollarSign className=\"h-3.5 w-3.5\" />\n                    Your Ask Price (Rs.) <span className=\"text-red-500\">*</span>\n                  </span>\n                  {askPrice && !isNaN(parseFloat(askPrice)) && parseFloat(askPrice) >= 1000000 && (\n                    <span className=\"text-[10px] font-bold text-blue-600\">\n                      Rs. {formatPrice(parseFloat(askPrice))}\n                    </span>\n                  )}\n                </Label>\n                \n                <div className={`flex w-full h-14 rounded-xl relative transition-all ${\n                  errors.askPrice \n                    ? \"border border-red-500 bg-red-50/50\" \n                    : \"border border-slate-200 bg-white hover:border-blue-400 ring-4 ring-blue-500/5 focus-within:ring-blue-500/20 focus-within:border-blue-500\"\n                }`}>\n                  {/* Decrement */}\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      const current = parseFloat(askPrice) || 0;\n                      let step = 100;\n                      if (current >= 100000) step = 5000;\n                      else if (current >= 20000) step = 1000;\n                      else if (current >= 5000) step = 500;\n                      \n                      const newVal = Math.max(0, current - step);\n                      setAskPrice(newVal.toString());\n                      if (errors.askPrice) setErrors(prev => ({ ...prev, askPrice: false }));\n                    }}\n                    className=\"w-14 flex items-center justify-center border-r border-slate-100 text-slate-400 hover:text-blue-600 hover:bg-slate-50 active:bg-slate-100 transition-colors rounded-l-xl\"\n                  >\n                    <Minus className=\"h-5 w-5\" />\n                  </button>\n\n                  <Input \n                    id=\"price-input\" \n                    type=\"number\" \n                    placeholder=\"0\" \n                    value={askPrice}\n                    onChange={(e) => {\n                      setAskPrice(e.target.value);\n                      if (errors.askPrice) setErrors(prev => ({ ...prev, askPrice: false }));\n                    }}\n                    onBlur={() => {\n                      if (errors.askPrice) {\n                        const num = parseFloat(askPrice);\n                        if (!isNaN(num) && num >= LISTING_LIMITS.PRICE.MIN && num <= LISTING_LIMITS.PRICE.MAX) {\n                          setErrors(prev => ({ ...prev, askPrice: false }));\n                        }\n                      }\n                    }}\n                    className=\"flex-1 h-full border-none shadow-none focus-visible:ring-0 text-center text-2xl font-bold bg-transparent\"\n                  />\n\n                  {/* Increment */}\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      const current = parseFloat(askPrice) || 0;\n                      let step = 100;\n                      if (current >= 100000) step = 5000;\n                      else if (current >= 20000) step = 1000;\n                      else if (current >= 5000) step = 500;\n\n                      const newVal = current + step;\n                      setAskPrice(newVal.toString());\n                      if (errors.askPrice) setErrors(prev => ({ ...prev, askPrice: false }));\n                    }}\n                    className=\"w-14 flex items-center justify-center border-l border-slate-100 text-slate-400 hover:text-blue-600 hover:bg-slate-50 active:bg-slate-100 transition-colors rounded-r-xl\"\n                  >\n                    <Plus className=\"h-5 w-5\" />\n                  </button>\n                </div>\n\n                {errors.askPrice && (\n                  <p className=\"text-[10px] font-bold text-red-500\">\n                    Price must be Rs. {LISTING_LIMITS.PRICE.MIN.toLocaleString()} ΓÇô {LISTING_LIMITS.PRICE.MAX.toLocaleString()}\n                  </p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"description-textarea\" className=\"flex items-center justify-between gap-1\">\n                  <div className=\"flex items-center gap-1\">\n                    <AlignLeft className=\"h-3.5 w-3.5 text-slate-500\" />\n                    Description <span className=\"text-red-500\">*</span>\n                  </div>\n                  <span className={cn(\n                    \"text-[10px] font-bold transition-colors\",\n                    description.length > LISTING_LIMITS.DESCRIPTION.MAX ? \"text-red-500\" : \"text-slate-400\"\n                  )}>\n                    {description.length} / {LISTING_LIMITS.DESCRIPTION.MAX}\n                  </span>\n                </Label>\n                <Textarea \n                  id=\"description-textarea\" \n                  placeholder=\"Tell buyers about condition, usage, and any defects...\" \n                  className={`bg-slate-50 border-slate-100 min-h-[120px] transition-all ${errors.description ? \"border-red-500 bg-red-50/50 ring-red-500/20\" : \"\"}`}\n                  value={description}\n                  maxLength={LISTING_LIMITS.DESCRIPTION.MAX}\n                  onChange={(e) => {\n                    const val = e.target.value.slice(0, LISTING_LIMITS.DESCRIPTION.MAX);\n                    setDescription(val);\n                    if (errors.description) setErrors(prev => ({ ...prev, description: false }));\n                  }}\n                />\n                <AnimatePresence>\n                  {errors.description && (\n                    <motion.p \n                      initial={{ opacity: 0, y: -10 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      exit={{ opacity: 0, y: -10 }}\n                      className=\"text-[10px] font-bold text-red-500\"\n                    >\n                      {description.length < LISTING_LIMITS.DESCRIPTION.MIN \n                        ? `Description must be at least ${LISTING_LIMITS.DESCRIPTION.MIN} characters` \n                        : `Description cannot exceed ${LISTING_LIMITS.DESCRIPTION.MAX} characters`}\n                    </motion.p>\n                  )}\n                </AnimatePresence>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"listing-phone-input\" className=\"flex items-center gap-1\">\n                    <Phone className=\"h-3.5 w-3.5 text-slate-500\" />\n                    Phone <span className=\"text-red-500\">*</span>\n                  </Label>\n                  <Input\n                    id=\"listing-phone-input\"\n                    type=\"tel\"\n                    placeholder=\"Enter phone number\"\n                    value={contactPhone}\n                    onChange={(e) => {\n                      setContactPhone(e.target.value);\n                      if (errors.contactPhone) setErrors(prev => ({ ...prev, contactPhone: false }));\n                    }}\n                    className={`transition-all ${errors.contactPhone ? \"border-red-500 bg-red-50/50 ring-red-500/20\" : \"bg-slate-50 border-slate-100\"}`}\n                  />\n                  {errors.contactPhone && (\n                    <p className=\"text-[10px] font-bold text-red-500\">Please enter a valid phone number</p>\n                  )}\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <Label htmlFor=\"listing-whatsapp-input\" className=\"flex items-center gap-1.5\">\n                      <svg className=\"h-3.5 w-3.5 text-slate-500\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                        <path d=\"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.937 3.659 1.432 5.631 1.433h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z\"/>\n                      </svg>\n                      WhatsApp\n                    </Label>\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"text-[10px] text-slate-500 font-bold uppercase tracking-wider\">Same as Phone</span>\n                      <Switch \n                        id=\"whatsapp-same-toggle\"\n                        checked={isWhatsappSameAsPhone}\n                        onCheckedChange={setIsWhatsappSameAsPhone}\n                      />\n                    </div>\n                  </div>\n                  <Input\n                    id=\"listing-whatsapp-input\"\n                    type=\"tel\"\n                    placeholder=\"Enter WhatsApp number\"\n                    value={contactWhatsapp}\n                    disabled={isWhatsappSameAsPhone}\n                    onChange={(e) => setContactWhatsapp(e.target.value)}\n                    className=\"h-11 bg-slate-50 border-slate-100 disabled:opacity-50\"\n                  />\n                </div>\n              </div>\n\n              {/* Location Map Section */}\n              <div className=\"space-y-4\">\n                <Label className=\"text-sm font-semibold text-slate-900 flex items-center gap-1.5\">\n                  <MapPin className=\"h-3.5 w-3.5 text-slate-500\" />\n                  Location <span className=\"text-red-500\">*</span>\n                </Label>\n                <div className={`h-[300px] rounded-xl overflow-hidden border ${errors.location ? 'border-red-500' : 'border-slate-200'} shadow-sm`}>\n                  <MapPicker \n                    initialLocation={location}\n                    onLocationSelect={setLocation}\n                    onGeocodingChange={setIsMapGeocoding}\n                    required\n                  />\n                </div>\n                {errors.location && <p className=\"text-[10px] font-bold text-red-500\">Location is required</p>}\n              </div>\n\n              <div className=\"space-y-4 pt-4\">\n                <h3 id=\"bidding-style-heading\" className=\"text-sm font-semibold text-slate-900\">Bidding Style</h3>\n                \n                <div \n                  id=\"public-auction-option\"\n                  className={`flex items-center justify-between p-3 border rounded-lg transition-colors cursor-pointer ${isPublic ? 'bg-blue-50 border-blue-200' : 'bg-slate-50'}`}\n                  onClick={() => setIsPublic(true)}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <Gavel className={`h-4 w-4 ${isPublic ? 'text-blue-600' : 'text-slate-500'}`} />\n                    <div>\n                      <p className=\"text-sm font-medium\">Public Auction</p>\n                      <p className=\"text-[10px] text-muted-foreground\">Everyone can see the highest bid</p>\n                    </div>\n                  </div>\n                  <div className={`w-4 h-4 rounded-full border ${isPublic ? 'bg-blue-600 border-blue-600' : 'border-slate-300'}`} />\n                </div>\n\n                <div \n                  id=\"hidden-bids-option\"\n                  className={`flex items-center justify-between p-3 border rounded-lg transition-colors cursor-pointer ${!isPublic ? 'bg-blue-50 border-blue-200' : 'bg-slate-50'}`}\n                  onClick={() => setIsPublic(false)}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <EyeOff className={`h-4 w-4 ${!isPublic ? 'text-blue-600' : 'text-slate-500'}`} />\n                    <div>\n                      <p className=\"text-sm font-medium\">Hidden Bids Only</p>\n                      <p className=\"text-[10px] text-muted-foreground\">Only you see the bid amounts</p>\n                    </div>\n                  </div>\n                  <div className={`w-4 h-4 rounded-full border ${!isPublic ? 'bg-blue-600 border-blue-600' : 'border-slate-300'}`} />\n                </div>\n\n                <div className=\"space-y-3 pt-2\">\n                  <Label className=\"text-sm font-semibold text-slate-900 flex items-center gap-1\">\n                    <Clock className=\"h-3.5 w-3.5 text-slate-500\" />\n                    Listing Duration\n                  </Label>\n                  <div className=\"grid grid-cols-3 gap-3\">\n                    {(['24', '168', '720'] as const).map((d) => (\n                      <button\n                        key={d}\n                        id={`duration-btn-${d}`}\n                        onClick={() => setDuration(d)}\n                        className={`py-2 rounded-lg border font-bold text-sm transition-all ${\n                          duration === d \n                            ? 'bg-blue-600 border-blue-600 text-white shadow-md' \n                            : 'bg-white border-slate-200 text-slate-500 hover:border-blue-300 hover:text-blue-600'\n                        }`}\n                      >\n                        {d === '24' ? '24 Hours' : d === '168' ? '7 Days' : '30 Days'}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </motion.div>\n          )}\n          \n          <div className=\"flex flex-row gap-3\">\n            <Button \n              id=\"cancel-listing-btn\"\n              type=\"button\"\n              variant=\"outline\"\n              className=\"flex-1 h-14 text-lg font-semibold border-slate-200 text-slate-600 hover:bg-slate-50\"\n              onClick={() => router.back()}\n              disabled={isUploading || isLoadingItem}\n            >\n              <X className=\"h-5 w-5 mr-2\" />\n              {editingItem ? \"Discard\" : \"Cancel\"}\n            </Button>\n            <Button \n              id=\"post-listing-btn\"\n              className=\"flex-[2] bg-blue-600 hover:bg-blue-700 h-14 text-lg font-bold\"\n              onClick={handleSubmit}\n              disabled={isUploading || isProcessingImages || isLoadingItem || isEditCooldown || isMapGeocoding}\n            >\n              {(isUploading || isProcessingImages || isMapGeocoding) ? (\n                  <Loader2 className=\"h-5 w-5 mr-2 animate-spin\" />\n              ) : editingItem ? (\n                  <Save className=\"h-5 w-5 mr-2\" />\n              ) : (\n                  <Check className=\"h-5 w-5 mr-2\" />\n              )}\n              {isUploading\n                ? \"Uploading...\"\n                : isProcessingImages\n                  ? \"Processing images...\"\n                  : isMapGeocoding\n                    ? \"Locating...\"\n                    : editingItem\n                      ? (isEditCooldown ? `Edit in ${editCooldownLabel || \"1h\"}` : \"Save\")\n                      : \"Post Listing\"}\n            </Button>\n          </div>\n          <div id=\"go-live-note\" className=\"flex justify-center\">\n            <div className=\"rounded-full border border-amber-200 bg-amber-50 px-3 py-1 text-[11px] font-semibold text-amber-800\">\n              {GO_LIVE_NOTE}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport default function ListPage() {\n  return (\n    <Suspense>\n      <ListForm />\n    </Suspense>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\list\\ListPageClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\list\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\p\\[code]\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1329,1332],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1329,1332],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse, type NextRequest } from \"next/server\";\nimport { createClient } from \"@supabase/supabase-js\";\nimport type { Database } from \"@/types/database.types\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || \"\";\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || \"\";\n\nconst isUuid = (value: string) =>\n  /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(value);\n\nconst redirectToProduct = (requestUrl: string, target: string) =>\n  NextResponse.redirect(new URL(`/product/${target}`, requestUrl));\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ code: string }> }\n) {\n  const { code: rawCode } = await params;\n  const code = rawCode?.trim();\n  if (!code) return NextResponse.redirect(new URL(\"/\", request.url));\n\n  if (code.includes(\"-\") || isUuid(code)) {\n    return redirectToProduct(request.url, code);\n  }\n\n  if (!supabaseUrl || !supabaseAnonKey) {\n    return NextResponse.redirect(new URL(\"/\", request.url));\n  }\n\n  const supabase = createClient<Database>(supabaseUrl, supabaseAnonKey, {\n    auth: { persistSession: false }\n  });\n\n  const { data } = await supabase\n    .from(\"marketplace_listings\")\n    .select(\"slug, id\")\n    .ilike(\"slug\", `%-${code}`)\n    .limit(1);\n\n  const listing = Array.isArray(data) ? (data[0] as any) : null;\n  const target = listing?.slug || listing?.id;\n\n  if (!target) {\n    return NextResponse.redirect(new URL(\"/\", request.url));\n  }\n\n  return redirectToProduct(request.url, target);\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\privacy-policy\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\product\\[slug]\\ProductPageClient.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\product\\[slug]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2104,2107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2104,2107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Metadata } from \"next\";\nimport { createClient } from \"@supabase/supabase-js\";\nimport type { Database } from \"@/types/database.types\";\nimport ProductPageClient from \"./ProductPageClient\";\n\nconst baseUrl = (process.env.NEXT_PUBLIC_SITE_URL || \"https://boliyan.pk\").replace(/\\/$/, \"\");\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || \"\";\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || \"\";\n\nconst isUuid = (value: string) =>\n  /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(value);\n\nconst resolveImageUrl = (image?: string | null) => {\n  if (!image) return undefined;\n  if (image.startsWith(\"http\")) return image;\n  const trimmed = image.startsWith(\"/\") ? image : `/${image}`;\n  return `${baseUrl}${trimmed}`;\n};\n\nconst fetchListingMeta = async (slugOrId: string) => {\n  if (!supabaseUrl || !supabaseAnonKey) return null;\n\n  const supabaseServer = createClient<Database>(supabaseUrl, supabaseAnonKey, {\n    auth: { persistSession: false }\n  });\n\n  let query = supabaseServer\n    .from(\"marketplace_listings\")\n    .select(\"id, slug, title, description, images\");\n\n  if (isUuid(slugOrId)) {\n    query = query.eq(\"id\", slugOrId);\n  } else {\n    query = query.eq(\"slug\", slugOrId);\n  }\n\n  const { data } = await query.maybeSingle();\n  if (data) return data;\n\n  let fallbackQuery = supabaseServer\n    .from(\"listings\")\n    .select(\"id, slug, title, description, images\");\n\n  if (isUuid(slugOrId)) {\n    fallbackQuery = fallbackQuery.eq(\"id\", slugOrId);\n  } else {\n    fallbackQuery = fallbackQuery.eq(\"slug\", slugOrId);\n  }\n\n  const { data: fallbackData } = await fallbackQuery.maybeSingle();\n  return fallbackData || null;\n};\n\nexport async function generateMetadata({\n  params\n}: {\n  params: Promise<{ id?: string; slug?: string }>;\n}): Promise<Metadata> {\n  const { id, slug } = await params;\n  const slugOrId = slug || id || \"\";\n  if (!slugOrId) {\n    return {\n      title: \"Product | Boliyan\",\n      openGraph: { title: \"Product | Boliyan\", url: `${baseUrl}/product` }\n    };\n  }\n\n  const listing = (await fetchListingMeta(slugOrId)) as any;\n  const title = listing?.title ? `${listing.title} | Boliyan` : \"Product | Boliyan\";\n  const description = listing?.description || \"Discover listings on Boliyan.\";\n  const productSlug = listing?.slug || listing?.id || slugOrId;\n  const productUrl = `${baseUrl}/product/${productSlug}`;\n  const imageUrl = resolveImageUrl(listing?.images?.[0]);\n\n  return {\n    title,\n    description,\n    openGraph: {\n      title,\n      description,\n      url: productUrl,\n      images: imageUrl ? [{ url: imageUrl, width: 1200, height: 630, alt: listing?.title || \"Boliyan product\" }] : []\n    },\n    twitter: {\n      card: imageUrl ? \"summary_large_image\" : \"summary\",\n      title,\n      description,\n      images: imageUrl ? [imageUrl] : []\n    }\n  };\n}\n\nexport default async function ProductPage({ params }: { params: Promise<{ id?: string; slug?: string }> }) {\n  const resolvedParams = await params;\n  return <ProductPageClient params={resolvedParams} />;\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\profile\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\robots.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\sitemap.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\template.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\terms-of-service\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\app\\user\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\admin\\AdminGuard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ads\\AdCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ads\\AdSenseCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ads\\BannerAd.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\auth\\AuthDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\branding\\BoliyanLogo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\branding\\BoliyanLogomarkLoader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\branding\\DihariLogo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\ActiveFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\BiddingControls.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\CardShell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\CategoryBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\ConditionBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\DealSealAnimation.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\DistanceBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\GamificationBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\GlobalSonic.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\LeafletMap.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\LocationBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\MapPicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\PriceDisplay.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\RatingBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\RollingPrice.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\TimerBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\VerifiedBadge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\WhatsAppIcon.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\common\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\AchievementSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\BuyerStats.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\DashboardTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\ListingActionMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\ListingOffersCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getFuzzyLocationString' is defined but never used.","line":13,"column":99,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":121}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useMemo } from \"react\";\nimport { X, MessageSquare, Phone, Star, ChevronDown, ChevronUp, Tag, Activity, Trophy, Inbox, CheckCircle } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { Bid, Item } from \"@/types\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { CardShell } from \"@/components/common/CardShell\";\nimport { useApp } from \"@/lib/store\";\nimport { useTime } from \"@/context/TimeContext\";\nimport { buildWhatsAppMessageForDeal, calculatePrivacySafeDistance, formatCountdown, formatPrice, getFuzzyLocationString, getWhatsAppUrl, cn } from \"@/lib/utils\";\nimport { WhatsAppIcon } from \"@/components/common/WhatsAppIcon\";\nimport { TimerBadge } from \"@/components/common/TimerBadge\";\nimport { DistanceBadge } from \"@/components/common/DistanceBadge\";\n\ninterface ListingOffersCardProps {\n  item: Item;\n  offers: Bid[];\n}\n\nexport default function ListingOffersCard({ item, offers }: ListingOffersCardProps) {\n  const { user, conversations, acceptBid, rejectBid, startConversation, myLocation } = useApp();\n  const { now } = useTime();\n  \n  const [isExpanded, setIsExpanded] = useState(false);\n  const [processingBidId, setProcessingBidId] = useState<string | null>(null);\n  const router = useRouter();\n\n  const goLiveAt = item.goLiveAt ? new Date(item.goLiveAt).getTime() : null;\n  const isPendingGoLive = goLiveAt !== null && now < goLiveAt;\n  const goLiveCountdown = isPendingGoLive && goLiveAt ? formatCountdown(goLiveAt, now) : null;\n\n  // Sort offers: highest amount first, then by closest distance\n  const sortedOffers = useMemo(() => {\n    return [...offers].sort((a, b) => {\n      // Primary: Higher bid first\n      if (b.amount !== a.amount) return b.amount - a.amount;\n      \n      // Secondary: Closer distance first\n      const distA = calculatePrivacySafeDistance(myLocation || undefined, a.bidder?.location).distance;\n      const distB = calculatePrivacySafeDistance(myLocation || undefined, b.bidder?.location).distance;\n      return distA - distB;\n    });\n  }, [offers, myLocation]);\n\n  const acceptedOffers = sortedOffers.filter(b => b.status === 'accepted');\n  const totalOffers = sortedOffers.length;\n  const bestPrice = sortedOffers[0]?.amount || 0;\n\n  const handleAccept = async (bidId: string) => {\n    if (isPendingGoLive) return;\n    if (processingBidId) return;\n    setProcessingBidId(bidId);\n    try {\n      const convId = await acceptBid(bidId);\n      // Navigate to the new conversation if created\n      if (convId) {\n        router.push(`/inbox?id=${convId}`);\n      }\n    } finally {\n      setProcessingBidId(null);\n    }\n  };\n\n  const handleReject = async (bidId: string) => {\n    if (isPendingGoLive) return;\n    if (processingBidId) return;\n    setProcessingBidId(bidId);\n    try {\n      await rejectBid(bidId);\n    } finally {\n      setProcessingBidId(null);\n    }\n  };\n\n  const getConversation = (bidderId: string) => {\n    if (!user) return undefined;\n    return conversations.find(c => c.itemId === item.id && c.bidderId === bidderId);\n  };\n\n  const handleChat = async (bidderId: string) => {\n    if (isPendingGoLive) return;\n    // First check if conversation already exists\n    const conv = getConversation(bidderId);\n    \n    if (!conv && user) {\n      // Create conversation for previously-accepted bids that don't have one\n      const convId = await startConversation('', item.id, bidderId, item.sellerId);\n      if (convId) {\n        router.push(`/inbox?id=${convId}`);\n        return;\n      }\n    }\n    \n    if (conv) {\n      router.push(`/inbox?id=${conv.id}`);\n    } else {\n      router.push('/inbox');\n    }\n  };\n\n  const handleCall = (phone: string) => {\n    window.location.href = `tel:${phone}`;\n  };\n\n  const renderOfferRow = (bid: Bid) => {\n    const bidder = bid.bidder;\n    if (!bidder) return null;\n\n    const isAccepted = bid.status === 'accepted';\n    const isPending = bid.status === 'pending';\n    const conv = getConversation(bid.bidderId);\n    const canChat = isAccepted && !!conv;\n    const canCall = canChat && !!bidder.phone;\n    const isProcessing = processingBidId === bid.id;\n    const actionsDisabled = isPendingGoLive || isProcessing;\n    const locationInfo = calculatePrivacySafeDistance(myLocation || undefined, bidder.location);\n\n    return (\n      <div \n        key={bid.id} \n        id={`offer-row-${bid.id}`}\n        className=\"@container bg-slate-50 rounded-lg p-3 mb-3 flex flex-col md:flex-row md:items-center gap-3\"\n      >\n        {/* Top Section: Avatar + Info */}\n        <div className=\"flex items-center gap-3 w-full md:w-auto md:flex-1 min-w-0\">\n          {/* Avatar */}\n          <div className=\"w-10 h-10 rounded-full bg-slate-200 overflow-hidden shrink-0 ring-1 ring-white shadow-sm\">\n            {bidder.avatar ? (\n              <img src={bidder.avatar} alt={bidder.name} className=\"w-full h-full object-cover\" />\n            ) : (\n              <div className=\"w-full h-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white text-xs font-bold\">\n                {bidder.name.charAt(0)}\n              </div>\n            )}\n          </div>\n\n          {/* Info - Name + Rating stacked, Price on right */}\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center justify-between gap-2\">\n              <div className=\"min-w-0\">\n                <span className=\"font-bold text-sm text-slate-900 truncate block\">{bidder.name}</span>\n                <div className=\"flex items-center gap-1 mt-0.5\">\n                  <Star className=\"w-3 h-3 fill-amber-400 text-amber-400\" />\n                  <span className=\"text-xs text-slate-600\">{bidder.rating.toFixed(1)}</span>\n                  {locationInfo.distance > 0 && !locationInfo.isOutside && (\n                    <span className=\"text-xs text-slate-500 flex items-center gap-1\">\n                      ΓÇó <DistanceBadge \n                          distance={locationInfo.distance} \n                          duration={locationInfo.duration} \n                          variant=\"inline\" \n                        />\n                    </span>\n                  )}\n                </div>\n              </div>\n            <span \n              className={`font-black price-font leading-none ${bid.amount >= item.askPrice ? 'text-green-600' : 'text-slate-900'}`}\n              style={{ fontSize: 'clamp(1.25rem, 7cqi, 2rem)' }}\n            >\n              Rs. {formatPrice(bid.amount)}\n            </span>\n          </div>\n          </div>\n        </div>\n\n        {/* Actions */}\n        <div className=\"w-full grid grid-cols-2 gap-2 mt-2 md:mt-0 md:w-auto md:flex md:items-center md:gap-2 shrink-0\">\n          {isPending && (\n            <>\n               <Button\n                id={`reject-btn-${bid.id}`}\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-9 w-full md:w-8 md:h-8 text-red-500 hover:text-red-600 hover:bg-red-50 rounded-lg md:rounded-full border border-red-100 md:border-transparent bg-white md:bg-transparent\"\n                 onClick={() => handleReject(bid.id)}\n                 disabled={actionsDisabled}\n                 title=\"Decline\"\n              >\n                <X className=\"w-4 h-4\" />\n                <span className=\"md:hidden ml-2 text-sm font-medium\">Decline</span>\n              </Button>\n              <Button \n                id={`accept-btn-${bid.id}`}\n                size=\"sm\"\n                className=\"h-9 w-full md:w-auto px-3 text-xs font-bold bg-green-600 hover:bg-green-700 rounded-lg shadow-sm\"\n                 onClick={() => handleAccept(bid.id)}\n                 disabled={actionsDisabled}\n              >\n                Accept\n              </Button>\n            </>\n          )}\n          {isAccepted && (\n            <>\n              <Button \n                id={`whatsapp-btn-${bid.id}`}\n                variant=\"outline\"\n                size=\"sm\"\n                disabled={!bidder.phone || actionsDisabled}\n                className={cn(\n                  \"h-9 w-full md:w-auto px-3 text-[10px] md:text-xs font-bold rounded-lg transition-all\",\n                  bidder.phone && !actionsDisabled\n                    ? \"text-emerald-600 border-emerald-200 hover:bg-emerald-50\"\n                    : \"opacity-40 grayscale cursor-not-allowed bg-slate-50 border-slate-200\"\n                )}\n                 onClick={() => {\n                   if (!bidder.phone) return;\n                    const waMessage = buildWhatsAppMessageForDeal({\n                      item,\n                      bidAmount: bid.amount,\n                      myRole: 'seller',\n                      myLocation: myLocation || undefined,\n                      otherUserLocation: bidder.location\n                    });\n                   window.open(getWhatsAppUrl(bidder.whatsapp || bidder.phone!, waMessage), '_blank');\n                 }}\n                 title=\"WhatsApp\"\n              >\n                <WhatsAppIcon className=\"w-3.5 h-3.5 md:w-4 md:h-4 mr-1.5\" />\n                WhatsApp\n              </Button>\n              <Button \n                id={`call-btn-${bid.id}`}\n                variant=\"outline\"\n                size=\"sm\"\n                disabled={!canCall || actionsDisabled}\n                className={cn(\n                  \"h-9 w-full md:w-auto px-3 text-[10px] md:text-xs font-bold rounded-lg transition-all\",\n                  canCall && !actionsDisabled\n                    ? \"text-blue-600 border-blue-200 hover:bg-blue-50\"\n                    : \"opacity-40 grayscale cursor-not-allowed bg-slate-50 border-slate-200\"\n                )}\n                 onClick={() => bidder.phone && handleCall(bidder.phone)}\n                 title=\"Call\"\n              >\n                <Phone className=\"w-3.5 h-3.5 md:w-4 md:h-4 mr-1\" />\n                Call\n              </Button>\n              <Button \n                id={`chat-btn-${bid.id}`}\n                size=\"sm\"\n                className=\"h-9 w-full md:w-auto px-3 text-xs font-bold bg-blue-600 hover:bg-blue-700 rounded-lg shadow-sm col-span-2 md:col-span-1\"\n                 onClick={() => handleChat(bid.bidderId)}\n                 disabled={actionsDisabled}\n              >\n                <MessageSquare className=\"w-3 h-3 mr-1.5\" />\n                Chat\n              </Button>\n            </>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <CardShell \n      id={`listing-offers-card-${item.id}`}\n      className=\"border-slate-100\"\n    >\n      {/* Header - clickable to toggle */}\n      <div \n        id={`listing-offers-header-${item.id}`}\n        className=\"flex cursor-pointer hover:bg-slate-50/50 transition-colors\"\n        onClick={() => setIsExpanded(!isExpanded)}\n      >\n        {/* Left Column */}\n        <div className=\"flex-1 p-4 flex flex-col justify-evenly min-w-0\">\n          <div className=\"flex items-center gap-3 mb-2\">\n            <div className=\"w-10 h-10 rounded-md bg-slate-100 overflow-hidden shrink-0\">\n              {item.images[0] && (\n                <img src={item.images[0]} alt={item.title} className=\"w-full h-full object-cover\" />\n              )}\n            </div>\n            <div className=\"flex flex-col min-w-0\">\n              <h3 className=\"font-bold text-sm text-slate-900 truncate\">{item.title}</h3>\n              <p className=\"text-xs text-slate-500 truncate\">{item.description}</p>\n            </div>\n          </div>\n          <div className=\"flex flex-col gap-2 mt-1\">\n            {/* Ask Price */}\n            <div id={`ask-price-${item.id}`} className=\"flex flex-col items-start\">\n              <span className=\"text-[10px] font-bold uppercase tracking-wider text-slate-500 flex items-center gap-1 mb-0.5\">\n                <Tag className=\"w-3 h-3\" />\n                Asking\n              </span>\n              <span className=\"font-outfit font-bold text-slate-900 text-lg leading-none\">\n                Rs. {formatPrice(item.askPrice)}\n              </span>\n            </div>\n            \n            {/* Status Badge */}\n            <div\n              id={`status-badge-${item.id}`}\n              className={isPendingGoLive ? \"inline-flex items-center gap-1 text-[10px] uppercase font-bold text-amber-700 bg-amber-50 border border-amber-100 px-2 py-0.5 rounded-full w-fit\" : \"inline-flex items-center gap-1 text-[10px] uppercase font-bold text-green-700 bg-green-50 border border-green-100 px-2 py-0.5 rounded-full w-fit\"}\n            >\n               <Activity className={isPendingGoLive ? \"w-3 h-3 text-amber-600\" : \"w-3 h-3\"} />\n               {isPendingGoLive ? `Inactive ┬╖ Live in ${goLiveCountdown || \"1h\"}` : \"Active Listing\"}\n             </div>\n          </div>\n        </div>\n\n        {/* Right Column */}\n        <div className=\"p-2 flex flex-col items-end justify-evenly shrink-0 min-w-[120px]\">\n           <TimerBadge \n             expiryAt={item.expiryAt} \n             variant=\"solid\" \n             className=\"bg-red-600 text-white\" \n           />\n           <div id={`offers-stat-${item.id}`} className=\"flex items-center gap-3 text-xs text-slate-500 mt-1 mb-0.5\">\n             <span className=\"flex items-center gap-1\">\n                <Inbox className=\"w-3 h-3 text-slate-400\" />\n                {totalOffers} Offers\n             </span>\n             {acceptedOffers.length > 0 && (\n                <span className=\"flex items-center gap-1 text-green-600 font-medium\">\n                    <CheckCircle className=\"w-3 h-3\" />\n                    {acceptedOffers.length} Accepted\n                </span>\n             )}\n           </div>\n\n           <div id={`top-offer-${item.id}`} className=\"flex flex-col items-end\">\n              <span className=\"text-[10px] font-bold uppercase tracking-wider text-slate-400 flex items-center gap-1\">\n                <Trophy className=\"w-3 h-3 text-amber-500\" />\n                Top Offer\n              </span>\n              <div id={`best-price-value-${item.id}`} className={`font-black leading-none ${bestPrice >= item.askPrice ? 'text-green-600' : 'text-slate-900'}`} style={{ fontSize: 'clamp(1.5rem, 5vw, 2.25rem)' }}>\n                {bestPrice > 0 ? `Rs. ${formatPrice(bestPrice)}` : 'ΓÇö'}\n              </div>\n           </div>\n           {/* Inline Toggle */}\n           <button\n             type=\"button\"\n             onClick={(e) => {\n               e.stopPropagation();\n               setIsExpanded(!isExpanded);\n             }}\n             className=\"mt-1 flex items-center gap-1 text-xs text-blue-600 hover:text-blue-700 hover:underline transition-colors\"\n           >\n             {isExpanded ? (\n               <>Hide offers <ChevronUp className=\"w-3 h-3\" /></>\n             ) : (\n               <>Show {totalOffers} offers <ChevronDown className=\"w-3 h-3\" /></>\n             )}\n           </button>\n        </div>\n      </div>\n\n      {/* Offers List */}\n      <AnimatePresence>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            className=\"overflow-hidden bg-white\"\n          >\n            <div className=\"p-4 pt-6\">\n              {sortedOffers.length > 0 ? (\n                sortedOffers.map(bid => renderOfferRow(bid))\n              ) : (\n                <div className=\"text-center py-6 text-slate-400 text-sm\">\n                  No offers yet\n                </div>\n              )}\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </CardShell>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\MyBidCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getFuzzyLocationString' is defined but never used.","line":19,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":61}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useState, useMemo } from \"react\";\nimport { Trophy, AlertTriangle, MessageSquare, Phone } from \"lucide-react\";\nimport { useRouter } from \"next/navigation\";\nimport { Bid, Item, User } from \"@/types\";\n\nimport { Button } from \"@/components/ui/button\";\nimport ProductDetailsModal from \"@/components/marketplace/ProductDetailsModal\";\nimport { CardShell, CardBody } from \"@/components/common/CardShell\";\nimport { CategoryBadge } from \"@/components/common/CategoryBadge\";\nimport { ConditionBadge } from \"@/components/common/ConditionBadge\";\nimport { PriceDisplay } from \"@/components/common/PriceDisplay\";\nimport { TimerBadge } from \"@/components/common/TimerBadge\";\nimport { createBiddingConfig } from \"@/types/bidding\";\nimport { WhatsAppIcon } from \"@/components/common/WhatsAppIcon\";\n\nimport { useApp } from \"@/lib/store\";\nimport { buildWhatsAppMessageForDeal, getFuzzyLocationString, getWhatsAppUrl, cn } from \"@/lib/utils\";\n\ninterface MyBidCardProps {\n  item: Item;\n  userBid: Bid;\n  seller: User;\n}\n\nexport default function MyBidCard({ item, userBid, seller }: MyBidCardProps) {\n  const { user, bids, conversations } = useApp();\n  \n  const isLeading = user && item.isPublicBid && item.currentHighBidderId === user.id;\n  const isOutbid = user && item.isPublicBid && item.currentHighBidderId !== user.id && (item.currentHighBid || 0) > userBid.amount;\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const router = useRouter();\n\n  // Unified Bidding Config\n  const biddingConfig = useMemo(() => \n    createBiddingConfig(item, user, bids),\n    [item, user, bids]\n  );\n\n  const acceptedConversation = useMemo(() => {\n    if (!user) return undefined;\n    return conversations.find(conversation =>\n      conversation.itemId === item.id && conversation.bidderId === user.id\n    );\n  }, [conversations, item.id, user]);\n  const isAccepted = userBid.status === 'accepted';\n  const canChat = isAccepted && !!acceptedConversation;\n  const listingPhone = item.contactWhatsapp || seller.whatsapp || item.contactPhone || seller.phone;\n  const canCall = canChat && (!!item.contactPhone || !!seller.phone);\n  \n  const waMessage = buildWhatsAppMessageForDeal({\n    item,\n    bidAmount: userBid.amount,\n    myRole: 'buyer',\n    myLocation: user?.location,\n    otherUserLocation: seller.location\n  });\n\n  const handleChat = (event: React.MouseEvent) => {\n    event.stopPropagation();\n    if (!acceptedConversation) return;\n    router.push(`/inbox?id=${acceptedConversation.id}`);\n  };\n\n  const handleCall = (event: React.MouseEvent) => {\n    event.stopPropagation();\n    if (!listingPhone) return;\n    window.location.href = `tel:${listingPhone}`;\n  };\n\n  return (\n    <>\n{/* Status Badge Logic */}\n        {(() => {\n          let badge = null;\n          if (isAccepted) {\n            badge = (\n              <div id={`status-${item.id}`} className=\"bg-green-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm flex items-center gap-1\">\n                <Trophy className=\"w-3 h-3\" />\n                OFFER ACCEPTED\n              </div>\n            );\n          } else if (isLeading) {\n            badge = (\n              <div id={`status-${item.id}`} className=\"bg-amber-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm flex items-center gap-1\">\n                <Trophy className=\"w-3 h-3\" />\n                HIGHEST BIDDER\n              </div>\n            );\n          } else if (isOutbid) {\n            badge = (\n              <div id={`status-${item.id}`} className=\"bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm flex items-center gap-1 animate-pulse\">\n                <AlertTriangle className=\"w-3 h-3\" />\n                OUTBID\n              </div>\n            );\n          }\n          \n          return (\n            <CardShell \n              id={`my-bid-card-${item.id}`}\n              onClick={() => setIsModalOpen(true)}\n            >\n              <CardBody id={`my-bid-body-${item.id}`}>\n                {/* Image + Seller Info Column */}\n                <div className=\"flex flex-col gap-1.5 shrink-0\">\n                  {/* Image */}\n                  <div id={`my-bid-img-container-${item.id}`} className=\"h-20 w-20 bg-slate-100 rounded-lg overflow-hidden\">\n                    {item.images[0] && (\n                      <img id={`my-bid-img-${item.id}`} src={item.images[0]} alt={item.title} className=\"w-full h-full object-cover\" />\n                    )}\n                  </div>\n                  {/* Seller Info - Inset Style */}\n                  <div className=\"flex flex-col items-center w-20 gap-0.5 py-1.5 px-1 rounded-lg bg-slate-50/50 shadow-inner border border-slate-50\">\n                    <span className=\"text-[10px] font-semibold text-slate-600 truncate max-w-full text-center leading-tight\">\n                      {seller?.name || 'Seller'}\n                    </span>\n                    {seller?.rating !== undefined && seller.rating > 0 && (\n                      <div className=\"flex items-center gap-0.5\">\n                        <span className=\"text-amber-500 text-[9px]\">Γÿà</span>\n                        <span className=\"text-[9px] font-bold text-slate-500\">\n                          {seller.rating.toFixed(1)}\n                          {seller.reviewCount !== undefined && seller.reviewCount > 0 && (\n                            <span className=\"text-slate-400 font-medium\"> ({seller.reviewCount})</span>\n                          )}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* Content */}\n                <div id={`my-bid-content-${item.id}`} className=\"flex-1 min-w-0 flex flex-col justify-between\">\n                  {/* Top Section - Column on mobile, row on lg+ */}\n                  <div className=\"flex flex-col lg:flex-row lg:justify-between lg:items-start gap-1 lg:gap-2\">\n                     {/* Left: Title & Badges */}\n                     <div className=\"flex flex-col gap-1 min-w-0 flex-1\">\n                        <h3 id={`my-bid-title-${item.id}`} className=\"font-bold text-sm text-slate-900 line-clamp-2 lg:line-clamp-1\">{item.title}</h3>\n                        <div className=\"flex items-center gap-2 flex-wrap\">\n                            <CategoryBadge category={item.category} className=\"text-[9px] px-1.5 py-0.5\" />\n                            <ConditionBadge condition={item.condition} className=\"text-[9px] px-1.5 py-0.5\" />\n                        </div>\n                     </div>\n\n                     {/* Right: Timer & Status - Inline on mobile, column on lg+ */}\n                     <div className=\"flex flex-wrap items-center gap-1.5 lg:flex-col lg:items-end\">\n                        {/* Timer */}\n                        <TimerBadge \n                          expiryAt={item.expiryAt} \n                          variant=\"solid\" \n                          className=\"bg-red-600 text-white\" \n                        />\n                        {/* Badge */}\n                        <div id={`my-bid-status-${item.id}`}>{badge}</div>\n                     </div>\n                  </div>\n\n                  {/* Bottom: Price Display (Pushed Right) */}\n                  <PriceDisplay \n                      config={biddingConfig}\n                        askPrice={item.askPrice}\n                        bidCount={item.bidCount}\n                        bidAttemptsCount={item.bidAttemptsCount}\n                        viewMode=\"compact\"\n                      className=\"mt-2 pt-1\"\n                      userCurrentBid={userBid.amount}\n                      itemId={item.id}\n                  />\n                </div>\n              </CardBody>\n\n              {/* Action Footer (Only for Accepted Deals) */}\n              {isAccepted && (\n                  <div id={`my-bid-footer-${item.id}`} className=\"px-3 py-2 bg-green-50 border-t border-green-100 flex flex-wrap items-center justify-between gap-2\">\n                      <span className=\"text-xs font-bold text-green-700 shrink-0\">Offer Accepted! Coordinate:</span>\n                      <div className=\"flex flex-wrap gap-2\">\n                          {canChat && (\n                              <Button id={`my-bid-chat-btn-${item.id}`} size=\"sm\" variant=\"default\" className=\"h-7 text-xs bg-green-600 hover:bg-green-700\" onClick={handleChat}>\n                                  <MessageSquare className=\"w-3 h-3 mr-1\" />\n                                  Chat\n                              </Button>\n                          )}\n                          <Button \n                            id={`my-bid-whatsapp-btn-${item.id}`}\n                            size=\"sm\" \n                            variant=\"outline\" \n                            disabled={!listingPhone}\n                            className={cn(\n                                \"h-7 text-xs transition-all\",\n                                listingPhone \n                                    ? \"border-emerald-200 text-emerald-700 hover:bg-emerald-100\" \n                                    : \"opacity-40 grayscale cursor-not-allowed bg-slate-50 border-slate-200\"\n                            )}\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              if (!listingPhone) return;\n                              window.open(getWhatsAppUrl(listingPhone, waMessage), '_blank');\n                            }}\n                          >\n                              <WhatsAppIcon className=\"w-3 h-3 mr-1\" />\n                              WhatsApp\n                          </Button>\n                          <Button \n                            id={`my-bid-call-btn-${item.id}`}\n                            size=\"sm\" \n                            variant=\"outline\" \n                            disabled={!canCall}\n                            className={cn(\n                                \"h-7 text-xs transition-all\",\n                                canCall \n                                    ? \"border-green-200 text-green-700 hover:bg-green-100\" \n                                    : \"opacity-40 grayscale cursor-not-allowed bg-slate-50 border-slate-200\"\n                            )}\n                            onClick={handleCall}\n                          >\n                              <Phone className=\"w-3 h-3 mr-1\" />\n                              Call\n                          </Button>\n                      </div>\n                  </div>\n              )}\n            </CardShell>\n          );\n        })()}\n\n      <ProductDetailsModal \n        item={item} \n        seller={seller} \n        isOpen={isModalOpen} \n        onClose={setIsModalOpen} \n      />\n    </>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\MyListingsTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\ProfileSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\SellerStats.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\dashboard\\WatchedItemCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\inbox\\ChatWindow.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getFuzzyLocationString' is defined but never used.","line":10,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":78}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useApp } from '@/lib/store';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Send, ArrowLeft, Clock, Lock, Phone, CheckCheck, Check, Handshake, AlertCircle } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { buildWhatsAppMessageForDeal, cn, formatPrice, getFuzzyLocationString, getWhatsAppUrl } from '@/lib/utils';\nimport { Conversation } from '@/types';\nimport { VerifiedBadge } from '@/components/common/VerifiedBadge';\nimport { WhatsAppIcon } from '@/components/common/WhatsAppIcon';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useReviews } from '@/context/ReviewContext';\nimport { sonic } from '@/lib/sonic';\nimport { DealSealAnimation } from '@/components/common/DealSealAnimation';\nimport StarRating from '@/components/profile/StarRating';\nimport { toast } from 'sonner';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\n\ninterface ChatWindowProps {\n  conversationId: string;\n  onBack?: () => void;\n}\n\nexport function ChatWindow({ conversationId, onBack }: ChatWindowProps) {\n  const { user, messages, sendMessage, markAsRead, conversations, bids, subscribeToConversation, unsubscribeFromConversation, confirmExchange, fetchConversation, loadMessages } = useApp();\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const chatContainerRef = useRef<HTMLDivElement>(null);\n  const [inputValue, setInputValue] = useState(\"\");\n  const [timeLeft, setTimeLeft] = useState<string>(\"\");\n  const [isLockedState, setIsLockedState] = useState(false);\n  const { submitReview } = useReviews();\n  const [showSealAnim, setShowSealAnim] = useState(false);\n  const [showMissing, setShowMissing] = useState(false);\n  const [localConversation, setLocalConversation] = useState<Conversation | null>(null);\n  \n  // Vouch State\n  const [vouchRating, setVouchRating] = useState(0);\n  const [vouchSubmitted, setVouchSubmitted] = useState(false);\n  const [isSealDialogOpen, setIsSealDialogOpen] = useState(false);\n  \n  const currentMessages = messages.filter(m => m.conversationId === conversationId);\n  const prevMessageCountRef = useRef(currentMessages.length);\n\n  // Sound feedback for new messages\n  useEffect(() => {\n    if (currentMessages.length > prevMessageCountRef.current) {\n      const lastMsg = currentMessages[currentMessages.length - 1];\n      // Only play if it's from the OTHER user (outbound sound is handled in handleSend)\n      if (lastMsg && lastMsg.senderId !== user?.id) {\n        sonic.pop();\n      }\n    }\n    prevMessageCountRef.current = currentMessages.length;\n  }, [currentMessages, user?.id]);\n\n  // Lazy Subscription Lifecycle\n  useEffect(() => {\n    if (conversationId) {\n        subscribeToConversation(conversationId);\n    }\n    return () => {\n        if (conversationId) {\n            unsubscribeFromConversation(conversationId);\n        }\n    };\n  }, [conversationId, subscribeToConversation, unsubscribeFromConversation]);\n\n  // Load message history on open\n  useEffect(() => {\n    if (!conversationId) return;\n    if (loadMessages) {\n      loadMessages(conversationId);\n    }\n  }, [conversationId, loadMessages]);\n\n  // Fetch Fallback if not in global state\n  useEffect(() => {\n    if (!conversationId || conversations.find(c => c.id === conversationId)) return;\n    \n    // Attempt fetch\n    const loadMissing = async () => {\n        // Need fetchConversation exposed in useApp -> context\n        if (fetchConversation) {\n            const fetched = await fetchConversation(conversationId);\n            if (fetched) {\n                setLocalConversation(fetched);\n            }\n        }\n    };\n    loadMissing();\n  }, [conversationId, conversations, fetchConversation]);\n\n  const conversation = conversations.find(c => c.id === conversationId) || localConversation;\n  const isSeller = user && conversation ? conversation.sellerId === user.id : false;\n  const otherUser = conversation ? (isSeller ? conversation.bidder : conversation.seller) : undefined;\n  const item = conversation?.item;\n  const offerBid = conversation\n    ? bids.find(b => b.itemId === conversation.itemId && b.bidderId === conversation.bidderId)\n    : undefined;\n  const offerPrice = offerBid?.amount ?? item?.currentHighBid;\n\n  const waMessage = buildWhatsAppMessageForDeal({\n    item,\n    bidAmount: typeof offerPrice === 'number' ? offerPrice : null,\n    myRole: isSeller ? 'seller' : 'buyer',\n    myLocation: user?.location,\n    otherUserLocation: otherUser?.location\n  });\n  const priceBlock = item ? (\n    <div className=\"flex flex-col items-end shrink-0\">\n      <span className=\"price-font text-[clamp(0.55rem,1.8vw,0.7rem)] font-black text-slate-400 tracking-[0.2em] uppercase leading-none mb-1\">\n        Ask {formatPrice(item.askPrice)}\n      </span>\n      {typeof offerPrice === 'number' && (\n        <span className=\"price-font text-[clamp(1rem,4.5vw,1.5rem)] font-black text-emerald-600 leading-none tabular-nums\">\n          {formatPrice(offerPrice)}\n        </span>\n      )}\n    </div>\n  ) : null;\n\n  // Handshake Logic\n  const myRole = isSeller ? 'seller' : 'buyer';\n  const iHaveConfirmed = myRole === 'seller' ? !!conversation?.sellerConfirmedAt : !!conversation?.buyerConfirmedAt;\n  const theyHaveConfirmed = myRole === 'seller' ? !!conversation?.buyerConfirmedAt : !!conversation?.sellerConfirmedAt;\n  const isSealed = conversation?.isSealed;\n\n  const isCancelled = item?.status === 'cancelled';\n  const isCompleted = item?.status === 'completed';\n  const isLocked = (!conversation?.expiresAt ? false : isLockedState) || isCancelled || (isCompleted && !isSealed);\n\n  // Trigger Seal Animation\n  useEffect(() => {\n    if (isSealed && !showSealAnim) {\n       // Only trigger if we haven't seen it in this session (simplified)\n       // Ideally we check if 'sealedAt' is very recent\n       const sellerTime = conversation?.sellerConfirmedAt ? new Date(conversation.sellerConfirmedAt).getTime() : 0;\n       const buyerTime = conversation?.buyerConfirmedAt ? new Date(conversation.buyerConfirmedAt).getTime() : 0;\n       const sealedAt = Math.max(sellerTime, buyerTime);\n       const now = new Date().getTime();\n       \n       if (now - sealedAt < 5000) { // Only animate if it happened in last 5s\n          // Use setTimeout to avoid sync state update warning\n          const timer = setTimeout(() => {\n             setShowSealAnim(true);\n             sonic.thud();\n          }, 0);\n          return () => clearTimeout(timer);\n       }\n    }\n  }, [isSealed, conversation, showSealAnim]);\n\n  const handleConfirmExchange = async () => {\n    if (!conversation) return;\n    setIsSealDialogOpen(false);\n    await confirmExchange(conversation.id, myRole);\n    sonic.click();\n    toast.success(\"You confirmed the exchange!\");\n  };\n\n  const handleQuickVouch = async () => {\n    if (vouchRating === 0 || !otherUser || !item) return;\n    \n    const result = await submitReview({\n        reviewedId: otherUser.id,\n        listingId: item.id,\n        conversationId: conversationId,\n        rating: vouchRating,\n        content: \"Verified Exchange (Quick Vouch)\",\n        role: myRole\n    });\n\n    if (result.success) {\n        setVouchSubmitted(true);\n        sonic.chime();\n        toast.success(\"Reputation updated!\");\n    } else {\n        toast.error(\"Failed to submit vouch\");\n    }\n  };\n\n\n  // Lock body scroll to prevent Safari from scrolling page when input focused\n  useEffect(() => {\n    const originalOverflow = document.body.style.overflow;\n    const originalPosition = document.body.style.position;\n    const originalTop = document.body.style.top;\n    const originalWidth = document.body.style.width;\n    const scrollY = window.scrollY;\n\n    document.body.style.overflow = 'hidden';\n    document.body.style.position = 'fixed';\n    document.body.style.top = `-${scrollY}px`;\n    document.body.style.width = '100%';\n\n    return () => {\n      document.body.style.overflow = originalOverflow;\n      document.body.style.position = originalPosition;\n      document.body.style.top = originalTop;\n      document.body.style.width = originalWidth;\n      window.scrollTo(0, scrollY);\n    };\n  }, []);\n\n  // Expiration Logic\n  useEffect(() => {\n    if (!conversation?.expiresAt) {\n      return;\n    }\n\n    const timer = setInterval(() => {\n      const expiry = new Date(conversation.expiresAt!).getTime();\n      const now = new Date().getTime();\n      const diff = expiry - now;\n\n      if (diff <= 0) {\n        setTimeLeft(\"0h 0m 0s\");\n        setIsLockedState(true);\n        clearInterval(timer);\n        return;\n      }\n\n      const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n      const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n      const secs = Math.floor((diff % (1000 * 60)) / 1000);\n\n      const timeStr = days > 0 \n        ? `${days}d ${hours}h ${mins}m` \n        : `${hours}h ${mins}m ${secs}s`;\n      \n      setTimeLeft(timeStr);\n      setIsLockedState(false);\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, [conversation?.expiresAt]);\n\n  useEffect(() => {\n    if (!user || conversation) {\n      if (showMissing) {\n        // Avoid sync state update\n        setTimeout(() => setShowMissing(false), 0);\n      }\n      return;\n    }\n\n    const timer = setTimeout(() => setShowMissing(true), 2500); // Increased timeout to give fetch time\n    return () => clearTimeout(timer);\n  }, [conversation, conversationId, user, showMissing]);\n\n  // Scroll to bottom on new message\n  useEffect(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n    \n    // Mark as read logic\n    const unreadMessages = currentMessages.filter(m => m.senderId !== user?.id && !m.isRead);\n    if (unreadMessages.length > 0) {\n        markAsRead(conversationId);\n    }\n  }, [currentMessages, conversationId, user?.id, markAsRead]);\n\n  const handleRetryFetch = async () => {\n    setShowMissing(false);\n    if (fetchConversation && conversationId) {\n        console.log(\"Manual retry fetching conversation:\", conversationId);\n        const fetched = await fetchConversation(conversationId);\n        if (fetched) {\n            setLocalConversation(fetched);\n        } else {\n            console.error(\"Manual retry failed to find conversation\");\n            toast.error(\"Could not find conversation. It may have been deleted.\");\n            setTimeout(() => setShowMissing(true), 500);\n        }\n    }\n  };\n\n  if (!user) return <div className=\"p-10 text-center\">Please sign in to view chats.</div>;\n  if (!conversation) {\n    return showMissing\n      ? (\n        <div className=\"flex flex-col items-center justify-center h-full p-10 text-center space-y-4\">\n            <div className=\"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mb-2\">\n                <Clock className=\"h-8 w-8 text-red-300\" />\n            </div>\n            <h3 className=\"text-lg font-bold text-slate-900\">Conversation not found</h3>\n            <p className=\"text-sm text-slate-500 max-w-[280px]\">\n               We couldn't load this chat (ID: {conversationId?.slice(0, 8)}...). \n            </p>\n            <div className=\"text-[10px] text-slate-400 bg-slate-50 p-2 rounded border border-slate-100 font-mono mt-2\">\n                User: {user.id.slice(0, 8)}...\n            </div>\n            <Button id=\"chat-retry-btn\" onClick={handleRetryFetch} variant=\"outline\" className=\"mt-4\">\n                Retry Connection\n            </Button>\n            <Button id=\"chat-back-btn\" onClick={onBack || (() => window.history.back())} variant=\"ghost\" className=\"text-slate-400\">\n                Go Back\n            </Button>\n        </div>\n      )\n      : <div className=\"flex items-center justify-center h-full p-10 text-center text-slate-400 animate-pulse\">Loading chat...</div>;\n  }\n\n  const handleSend = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!inputValue.trim() || isLocked) return;\n    sendMessage(conversationId, inputValue);\n    setInputValue(\"\");\n    sonic.pop();\n  };\n\n  return (\n    <div \n      id=\"chat-window\" \n      ref={chatContainerRef}\n      className=\"flex flex-col h-full bg-[#FCFCFD] relative\"\n    >\n      <DealSealAnimation isVisible={showSealAnim} />\n\n      {/* Premium Header */}\n      <header id=\"chat-header\" className=\"flex flex-col border-b shrink-0 bg-white/80 backdrop-blur-xl z-30 sticky top-0\">\n        {/* Row 1: Identity & Context (Desktop Unified / Mobile Identity) */}\n        <div className=\"flex items-center justify-between px-4 pt-4 pb-2 md:pb-3\">\n            <div className=\"flex items-center gap-3 min-w-0\">\n              <div className=\"relative\">\n                <Avatar className=\"h-10 w-10 border shadow-sm ring-2 ring-white\">\n                    <AvatarImage src={otherUser?.avatar} />\n                    <AvatarFallback className=\"bg-slate-100 text-slate-400 font-black text-xs\">{otherUser?.name?.[0] || \"?\"}</AvatarFallback>\n                </Avatar>\n                <div className=\"absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 rounded-full border-[3px] border-white bg-emerald-500 shadow-sm\" />\n              </div>\n              \n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center gap-2 mb-0.5 min-w-0\">\n                    <h3 className=\"font-black text-[15px] text-slate-900 truncate tracking-tight\">{otherUser?.name || \"Unknown\"}</h3>\n                    {otherUser?.isVerified && <VerifiedBadge size=\"sm\" />}\n                    <span className={cn(\n                    \"text-[9px] px-1.5 py-0.5 rounded-full font-black uppercase tracking-tighter shadow-sm shrink-0\",\n                    isSeller ? \"bg-slate-900 text-white\" : \"bg-blue-600 text-white\"\n                    )}>\n                    {isSeller ? \"Buyer\" : \"Seller\"}\n                    </span>\n                </div>\n                \n                <div className=\"flex items-center gap-1.5 min-w-0\">\n                    {item && (\n                    <div className=\"h-4 w-4 rounded-[4px] bg-slate-100 overflow-hidden flex-shrink-0 ring-1 ring-slate-200/50\">\n                        <img src={item.images[0]} alt=\"\" className=\"h-full w-full object-cover\" />\n                    </div>\n                    )}\n                    <div className=\"text-[10px] font-bold text-slate-500 truncate uppercase tracking-tight\">\n                    {item?.title || \"Product\"}\n                    </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Desktop Unified Actions + Price */}\n            <div className=\"hidden md:flex items-center gap-4\">\n                {/* Actions in line on desktop */}\n                {(() => {\n                   const listingWhatsapp = !isSeller ? item?.contactWhatsapp : undefined;\n                   const profileWhatsapp = otherUser?.whatsapp;\n                   const listingPhone = !isSeller ? item?.contactPhone : undefined;\n                   const phone = listingWhatsapp || profileWhatsapp || listingPhone || otherUser?.phone;\n                    const waMessageText = waMessage;\n                   if (!phone && isSealed) return null;\n\n\n                  return (\n                    <div className=\"flex items-center gap-2\">\n                      <Button\n                        id=\"chat-whatsapp-btn-desktop\"\n                        size=\"sm\"\n                        variant=\"outline\"\n                        disabled={!phone}\n                        className={cn(\n                          \"h-9 px-3 text-xs font-bold rounded-full border-slate-200 transition-colors shadow-sm\",\n                          phone \n                            ? \"text-slate-600 hover:bg-emerald-50 hover:text-emerald-600 hover:border-emerald-200\" \n                            : \"opacity-30 grayscale cursor-not-allowed bg-slate-50/50\"\n                        )}\n                        onClick={() => {\n                           if (phone) window.open(getWhatsAppUrl(phone, waMessageText), '_blank');\n                        }}\n                      >\n                        <WhatsAppIcon className=\"h-4 w-4 mr-1.5\" />\n                        WhatsApp\n                      </Button>\n                      <Button\n                        id=\"chat-call-btn-desktop\"\n                        size=\"sm\"\n                        variant=\"outline\"\n                        disabled={!phone}\n                        className={cn(\n                          \"h-9 px-3 text-xs font-bold rounded-full border-slate-200 transition-colors shadow-sm\",\n                          phone \n                            ? \"text-slate-600 hover:bg-green-50 hover:text-green-600 hover:border-green-200\" \n                            : \"opacity-30 grayscale cursor-not-allowed bg-slate-50/50\"\n                        )}\n                        onClick={() => {\n                          if (phone) window.location.href = `tel:${phone}`;\n                        }}\n                      >\n                        <Phone className=\"h-4 w-4 mr-1\" />\n                        Call\n                      </Button>\n\n                      {!isSealed && (\n                        <Button \n                          id=\"chat-seal-btn-desktop\"\n                          size=\"sm\" \n                          onClick={() => setIsSealDialogOpen(true)}\n                          className={cn(\n                            \"h-9 px-3 text-xs font-bold rounded-full shadow-sm transition-all\",\n                            iHaveConfirmed \n                              ? \"bg-emerald-50 text-emerald-600 border border-emerald-100 opacity-100\"\n                              : theyHaveConfirmed \n                                ? \"bg-emerald-600 hover:bg-emerald-700 text-white animate-pulse\" \n                                : \"bg-white text-slate-700 border border-slate-200 hover:bg-slate-50\"\n                          )}\n                          disabled={iHaveConfirmed && !isSealed}\n                        >\n                          {iHaveConfirmed ? (\n                            <Check className=\"h-4 w-4 mr-1.5\" />\n                          ) : (\n                            <Handshake className=\"h-4 w-4 mr-1.5\" />\n                          )}\n                          {iHaveConfirmed ? (theyHaveConfirmed ? \"Sealing Deal\" : \"Exchange Sent\") : \"Mark as Done\"}\n                        </Button>\n                      )}\n                    </div>\n                  );\n               })()}\n               {/* Price in the same row on desktop */}\n               {priceBlock}\n            </div>\n\n            {/* Mobile Row 1 Price (Mobile only) */}\n            <div className=\"md:hidden\">\n              {priceBlock}\n            </div>\n        </div>\n\n        {/* Row 2: Navigation & Actions Cluster (Mobile only) */}\n        <div className=\"flex md:hidden items-center justify-between px-4 pb-3\">\n            <div className=\"flex items-center flex-1\">\n              {onBack && (\n                <Button \n                  id=\"chat-back-btn-mobile\" \n                  variant=\"outline\" \n                  size=\"icon\" \n                  onClick={onBack} \n                  className=\"mr-4 -ml-2 rounded-full h-9 w-9 bg-white border-slate-200 shadow-sm hover:bg-slate-50 transition-colors\"\n                >\n                    <ArrowLeft className=\"h-5 w-5 text-slate-600\" />\n                </Button>\n              )}\n              \n              <div className=\"flex items-center gap-1.5 ml-auto\">\n                {(() => {\n                   const listingWhatsapp = !isSeller ? item?.contactWhatsapp : undefined;\n                   const profileWhatsapp = otherUser?.whatsapp;\n                   const listingPhone = !isSeller ? item?.contactPhone : undefined;\n                   const phone = listingWhatsapp || profileWhatsapp || listingPhone || otherUser?.phone;\n\n                   const waMessageText = waMessage;\n\n                  return (\n                    <>\n                      <Button\n                        id=\"chat-whatsapp-btn\"\n                        size=\"sm\"\n                        variant=\"outline\"\n                        disabled={!phone}\n                        className={cn(\n                          \"h-8 px-2 text-[10px] font-bold rounded-full border-slate-200 transition-colors shadow-sm\",\n                          phone \n                            ? \"text-slate-600 hover:bg-emerald-50 hover:text-emerald-600 hover:border-emerald-200\" \n                            : \"opacity-30 grayscale cursor-not-allowed bg-slate-50/50\"\n                        )}\n                        onClick={() => {\n                           if (phone) window.open(getWhatsAppUrl(phone, waMessageText), '_blank');\n                        }}\n                      >\n                        <WhatsAppIcon className=\"h-3.5 w-3.5 mr-1\" />\n                        WhatsApp\n                      </Button>\n                      <Button\n                        id=\"chat-call-btn\"\n                        size=\"sm\"\n                        variant=\"outline\"\n                        disabled={!phone}\n                        className={cn(\n                          \"h-8 px-2 text-[10px] font-bold rounded-full border-slate-200 transition-colors shadow-sm\",\n                          phone \n                            ? \"text-slate-600 hover:bg-green-50 hover:text-green-600 hover:border-green-200\" \n                            : \"opacity-30 grayscale cursor-not-allowed bg-slate-50/50\"\n                        )}\n                        onClick={() => {\n                          if (phone) window.location.href = `tel:${phone}`;\n                        }}\n                      >\n                        <Phone className=\"h-3.5 w-3.5 mr-1\" />\n                        Call\n                      </Button>\n\n                      {!isSealed && (\n                        <Button \n                          id=\"chat-seal-btn\"\n                          size=\"sm\" \n                          onClick={() => setIsSealDialogOpen(true)}\n                          className={cn(\n                            \"h-8 px-2 text-[10px] font-bold rounded-full shadow-sm transition-all\",\n                            iHaveConfirmed \n                              ? \"bg-emerald-50 text-emerald-600 border border-emerald-100 opacity-100\"\n                              : theyHaveConfirmed \n                                ? \"bg-emerald-600 hover:bg-emerald-700 text-white animate-pulse\" \n                                : \"bg-white text-slate-700 border border-slate-200 hover:bg-slate-50\"\n                          )}\n                          disabled={iHaveConfirmed && !isSealed}\n                        >\n                          {iHaveConfirmed ? (\n                            <Check className=\"h-3.5 w-3.5 mr-1\" />\n                          ) : (\n                            <Handshake className=\"h-3.5 w-3.5 mr-1\" />\n                          )}\n                          {iHaveConfirmed ? (theyHaveConfirmed ? \"Sealing\" : \"Sent\") : \"Done\"}\n                        </Button>\n                      )}\n                    </>\n                  );\n                })()}\n              </div>\n            </div>\n        </div>\n\n        {/* Expiration Logic - Compact Footer of Header */}\n        {timeLeft && !isSealed && (\n            <div className={cn(\n                \"px-4 py-1 flex items-center justify-end gap-2 border-t border-slate-50/50\",\n                isLocked ? \"bg-red-50/30\" : \"bg-white/50\"\n            )}>\n                <div className=\"flex items-center gap-1.5 text-[9px] font-black uppercase tracking-widest text-slate-400\">\n                    <Clock className=\"h-2.5 w-2.5\" />\n                    {isLocked ? (isCancelled ? \"Cancelled\" : (isCompleted ? \"Sold\" : \"Expired\")) : \"Closing in\"}\n                </div>\n                <div className={cn(\n                    \"text-[10px] font-black tabular-nums\",\n                    isLocked ? \"text-red-500\" : \"text-blue-600\"\n                )}>\n                    {isCancelled ? \"N/A\" : (isCompleted ? \"Closed\" : timeLeft)}\n                </div>\n            </div>\n        )}\n      </header>\n\n      {/* Messages Area */}\n      <div \n        id=\"chat-messages\"\n        className=\"flex-1 overflow-y-auto p-3 space-y-3 scrollbar-hide bg-gradient-to-b from-white to-slate-50/30 flex flex-col justify-end\"\n      >\n        <motion.div \n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          className={cn(\n            \"text-center text-[11px] font-black uppercase tracking-widest mx-auto max-w-fit px-4 py-2 rounded-full border shadow-sm\",\n            isLocked \n              ? \"bg-red-50 border-red-100 text-red-600\" \n              : (isSealed ? \"bg-emerald-50 border-emerald-100 text-emerald-600\" : \"bg-blue-50 border-blue-100 text-blue-600\")\n          )}\n        >\n            {isLocked ? (\n              <span className=\"flex items-center gap-2\">\n                <Lock className=\"h-3 w-3\" />\n                {isCancelled ? \"Listing Cancelled ΓÇó Chat Locked\" : (isCompleted ? \"Item Sold ΓÇó Chat Locked\" : \"Discussion expired ΓÇó Chat Locked\")}\n              </span>\n            ) : isSealed ? (\n             <span className=\"flex items-center gap-2\">\n               <Handshake className=\"h-3 w-3\" />\n               Deal Sealed ΓÇó Verified Exchange\n             </span>\n           ) : (\n             <span className=\"flex items-center gap-2\">\n               <VerifiedBadge size=\"sm\" />\n               Secure Channel ΓÇó Arrange your deal\n             </span>\n           )}\n        </motion.div>\n      \n        <AnimatePresence initial={false}>\n          {currentMessages.map((msg) => {\n            const isMe = msg.senderId === user?.id;\n            return (\n              <motion.div\n                key={msg.id}\n                initial={{ opacity: 0, scale: 0.95, y: 20, x: isMe ? 20 : -20 }}\n                animate={{ opacity: 1, scale: 1, y: 0, x: 0 }}\n                transition={{ type: \"spring\", damping: 20, stiffness: 200 }}\n                className={cn(\n                  \"flex flex-col gap-1 max-w-[85%] md:max-w-[70%] w-fit\",\n                  isMe ? \"ml-auto self-end items-end\" : \"mr-auto self-start items-start\"\n                )}\n              >\n                <div className={cn(\n                  \"relative inline-flex w-fit max-w-full px-3 pt-1.5 pb-4 pr-12 text-[12px] md:text-[13px] font-medium leading-snug shadow-sm transition-all\",\n                  isMe \n                    ? \"bg-blue-600 text-white rounded-[18px] rounded-tr-[6px] shadow-blue-200/50\" \n                    : \"bg-white text-slate-800 rounded-[18px] rounded-tl-[6px] ring-1 ring-slate-100 shadow-slate-200/50\"\n                )}>\n                  <span className=\"whitespace-pre-wrap break-words\">{msg.content}</span>\n                  <span className={cn(\n                    \"absolute bottom-1 right-2 flex items-center gap-1 text-[9px] font-bold uppercase tracking-tighter whitespace-nowrap\",\n                    isMe ? \"text-blue-100/90\" : \"text-slate-400\"\n                  )}>\n                    {format(new Date(msg.createdAt), 'h:mm a')}\n                    {isMe && (\n                      <span className=\"flex items-center justify-center\">\n                        {msg.isRead ? (\n                          <CheckCheck className=\"h-3 w-3 text-blue-100/90\" />\n                        ) : (\n                           <Check className=\"h-3 w-3 text-blue-100/70\" />\n                        )}\n                      </span>\n                    )}\n                  </span>\n                </div>\n              </motion.div>\n            );\n          })}\n        </AnimatePresence>\n        <div ref={messagesEndRef} className=\"h-2\" />\n      </div>\n\n      {/* Modern Input Area OR Vouch Bar */}\n      <div id=\"chat-input-area\" className=\"p-4 border-t shrink-0 bg-white/80 backdrop-blur-xl z-30\">\n        \n        {isSealed && !vouchSubmitted ? (\n             /* --- VOUCH BAR --- */\n             <motion.div \n               initial={{ opacity: 0, y: 20 }}\n               animate={{ opacity: 1, y: 0 }}\n               className=\"flex flex-col gap-3 items-center justify-center py-2\"\n             >\n                 <span className=\"text-xs font-bold text-slate-500 uppercase tracking-wide\">\n                     How was {otherUser?.name?.split(' ')[0]}?\n                 </span>\n                 <div className=\"flex items-center gap-4\">\n                     <StarRating \n                        rating={vouchRating} \n                        onRatingChange={(r) => {\n                            setVouchRating(r);\n                            sonic.tick();\n                        }} \n                        size={28} \n                     />\n                 </div>\n                  {vouchRating > 0 && (\n                      <Button \n                         id=\"chat-vouch-confirm-btn\"\n                         size=\"sm\" \n                         onClick={handleQuickVouch}\n                         className=\"w-full bg-slate-900 text-white rounded-xl shadow-lg animate-in zoom-in duration-200\"\n                      >\n                          Confirm Vouch\n                      </Button>\n                  )}\n             </motion.div>\n        ) : isSealed && vouchSubmitted ? (\n             /* --- VOUCH COMPLETE --- */\n             <div className=\"flex items-center justify-center py-4 text-emerald-600 gap-2\">\n                 <CheckCheck className=\"h-5 w-5\" />\n                 <span className=\"font-bold text-sm\">Vouch Submitted. Deal Complete.</span>\n             </div>\n        ) : (\n            /* --- STANDARD INPUT --- */\n            <form onSubmit={handleSend} className=\"flex gap-2 relative max-w-4xl mx-auto\">\n            {isLocked && (\n                <motion.div \n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                className=\"absolute inset-0 bg-white/95 backdrop-blur-sm z-40 flex items-center justify-center rounded-2xl border-2 border-dashed border-red-100\"\n                >\n                 <span className=\"text-xs font-black uppercase tracking-widest text-red-500 flex items-center gap-2\">\n                    <Lock className=\"h-4 w-4\" />\n                    {isCancelled ? \"Listing Cancelled\" : (isCompleted ? \"Item Sold\" : \"Channel Inactive\")}\n                </span>\n                </motion.div>\n            )}\n            <div className=\"flex-1 relative group\">\n                <Input \n                id=\"chat-input-field\"\n                placeholder={isLocked ? \"Chat is read-only\" : \"Type a message...\"} \n                value={inputValue}\n                onChange={(e) => setInputValue(e.target.value)}\n                onKeyDown={(e) => {\n                    if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handleSend(e);\n                    }\n                }}\n                enterKeyHint=\"send\"\n                disabled={isLocked}\n                className=\"flex-1 h-12 bg-slate-50 border-none focus-visible:ring-2 focus-visible:ring-blue-100 focus:bg-white transition-all rounded-[20px] px-5 font-medium text-slate-700 shadow-inner\"\n                />\n            </div>\n            <Button \n                id=\"chat-send-btn\"\n                type=\"submit\" \n                size=\"icon\" \n                disabled={!inputValue.trim() || isLocked} \n                className={cn(\n                \"h-12 w-12 rounded-[20px] shadow-lg transition-all active:scale-y-95\",\n                inputValue.trim() && !isLocked ? \"bg-blue-600 shadow-blue-200\" : \"bg-slate-100\"\n                )}\n            >\n                <Send className={cn(\"h-5 w-5\", inputValue.trim() && !isLocked ? \"text-white\" : \"text-slate-400\")} />\n                <span className=\"sr-only\">Send</span>\n            </Button>\n            </form>\n        )}\n        <div className=\"h-[env(safe-area-inset-bottom)]\" />\n      </div>\n\n      <AnimatePresence>\n        {showMissing && (\n           <motion.div \n             initial={{ opacity: 0, y: 10 }}\n             animate={{ opacity: 1, y: 0 }}\n             className=\"absolute inset-0 flex flex-col items-center justify-center p-8 text-center bg-white z-20\"\n           >\n             <div className=\"w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mb-4\">\n               <Clock className=\"h-8 w-8 text-slate-300\" />\n             </div>\n             <h3 className=\"text-lg font-bold text-slate-900 mb-2\">Connecting...</h3>\n             <p className=\"text-sm text-slate-500 max-w-[240px]\">\n               We're looking for this conversation. If it doesn't appear soon, it may have expired.\n             </p>\n           </motion.div>\n        )}\n      </AnimatePresence>\n\n      <Dialog open={isSealDialogOpen} onOpenChange={setIsSealDialogOpen}>\n        <DialogContent className=\"sm:max-w-[400px]\">\n          <DialogHeader>\n            <div className=\"mx-auto w-12 h-12 bg-emerald-50 rounded-full flex items-center justify-center mb-2\">\n              <Handshake className=\"h-6 w-6 text-emerald-600\" />\n            </div>\n            <DialogTitle className=\"text-center\">Finalize Exchange?</DialogTitle>\n            <DialogDescription className=\"text-center\">\n              Are you sure the exchange for <span className=\"font-bold text-slate-900\">\"{item?.title}\"</span> is complete?\n              This will seal the deal and move the chat to your history.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"p-4 bg-slate-50 rounded-lg border border-slate-100 flex items-start gap-3\">\n             <AlertCircle className=\"h-5 w-5 text-amber-500 shrink-0 mt-0.5\" />\n             <p className=\"text-[11px] text-slate-600 leading-relaxed\">\n               Only confirm if you have already met and settled the payment. This action cannot be undone.\n             </p>\n          </div>\n          <DialogFooter className=\"sm:justify-center gap-3\">\n            <Button\n              id=\"chat-seal-cancel-btn\"\n              variant=\"outline\"\n              onClick={() => setIsSealDialogOpen(false)}\n              className=\"flex-1 rounded-xl\"\n            >\n              Wait, not yet\n            </Button>\n            <Button\n              id=\"chat-seal-confirm-btn\"\n              onClick={handleConfirmExchange}\n              className=\"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl shadow-lg shadow-emerald-200\"\n            >\n              Yes, it's done\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\inbox\\ConversationList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\layout\\BottomNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\layout\\Footer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\layout\\Navbar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":34,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { Plus, LogOut, UserCircle, MessageSquare, Store, LayoutDashboard, BarChart3, MapPin, Bell, Shield, Users, Flag } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport Link from \"next/link\";\nimport { useApp } from \"@/lib/store\";\nimport { usePathname, useSearchParams, useRouter } from \"next/navigation\";\nimport { LocationSelector } from \"@/components/marketplace/LocationSelector\";\nimport { VerifiedBadge } from \"@/components/common/VerifiedBadge\";\n// import { SearchDropdown } from \"./SearchDropdown\";\nimport SearchBar from \"@/components/search/SearchBar\";\nimport { NotificationDropdown } from \"@/components/notifications/NotificationDropdown\";\nimport { useNotifications } from \"@/context/NotificationContext\";\nimport Skeleton from \"@/components/ui/Skeleton\";\nimport { useState, useEffect, useRef } from \"react\";\nimport { motion, AnimatePresence, LayoutGroup } from \"framer-motion\";\n\n\nexport default function Navbar() {\n  const { user, isLoggedIn, logout, items, bids, messages, isLoading, resetFilters, isAdminMode, toggleAdminMode } = useApp();\n  const { unreadCount: notificationUnreadCount } = useNotifications();\n  const pathname = usePathname();\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const currentTab = searchParams.get('tab');\n  const dashboardTab = currentTab || 'offers';\n  const [isVisible, setIsVisible] = useState(true);\n  const lastScrollY = useRef(0);\n\n  // Other notifications\n  const unreadMsgCount = (messages || []).filter(m => !m.isRead && m.senderId !== user?.id).length;\n  \n  const myItems = user ? items.filter(i => i.sellerId === user.id) : [];\n  const receivedBidsCount = bids.filter(b => b.status === 'pending' && myItems.some(i => i.id === b.itemId)).length;\n  \n  const myBidsItems = user ? items.filter(i => bids.some(b => b.bidderId === user.id && b.itemId === i.id)) : [];\n  const currentOutbidCount = user ? myBidsItems.filter(i => i.currentHighBidderId && i.currentHighBidderId !== user.id).length : 0;\n  const dashboardAlertCount = receivedBidsCount + currentOutbidCount;\n\n  useEffect(() => {\n    const controlNavbar = () => {\n      if (typeof window !== 'undefined') {\n        const currentScrollY = window.scrollY;\n        \n        // Disable hide effect for Inbox and restricted views\n        if (pathname === '/inbox' || pathname === '/signin' || pathname === '/signup') {\n          setIsVisible(true);\n          lastScrollY.current = currentScrollY;\n          return;\n        }\n\n        // Show navbar if scrolling up or at the very top\n        // Hide navbar if scrolling down and past 100px\n        if (currentScrollY < lastScrollY.current || currentScrollY < 10) {\n          setIsVisible(true);\n        } else if (currentScrollY > lastScrollY.current && currentScrollY > 100) {\n          setIsVisible(false);\n        }\n\n        lastScrollY.current = currentScrollY;\n      }\n    };\n    \n    // ... existing scroll logic ...\n    \n    if (typeof window !== 'undefined') {\n      window.addEventListener('scroll', controlNavbar);\n      return () => window.removeEventListener('scroll', controlNavbar);\n    }\n  }, [pathname]);\n\n  return (\n    <nav \n      id=\"navbar-01\" \n      suppressHydrationWarning={true}\n      className={cn(\n        \"fixed top-0 left-0 right-0 z-50 w-full border-b bg-white transition-all duration-300\",\n        isVisible ? \"translate-y-0\" : \"-translate-y-full\",\n        isAdminMode && \"border-b-2 border-amber-400 bg-amber-50/30\"\n      )}\n    >\n      <div id=\"navbar-container-02\" className=\"w-full flex h-16 items-center justify-between px-4 lg:px-0\">\n        <LayoutGroup>\n        {/* ... existing navbar content ... */}\n\n        <div id=\"navbar-left-section-03\" className=\"flex items-center gap-4 shrink-0 lg:w-72 lg:justify-center\">\n          <div className=\"flex items-center gap-3\">\n            <Link id=\"navbar-logo-link-04\" href=\"/\" onClick={resetFilters} className=\"group flex items-center gap-2 select-none transition-transform duration-200 active:scale-y-95 active:opacity-80\">\n              {/* Geometric 'Ba' (╪¿) Logomark */}\n              <svg id=\"navbar-logo-svg-05\" viewBox=\"0 0 40 40\" className=\"h-[clamp(32px,4vw,40px)] w-[clamp(32px,4vw,40px)] shrink-0 transition-all duration-300 group-hover:drop-shadow-md\">\n                {/* Ba Curve */}\n                <path\n                  d=\"M32,10 C32,20 28,26 16,26 C12,26 8,24 8,24\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"7\"\n                  fill=\"none\"\n                  strokeLinecap=\"round\"\n                  id=\"navbar-logo-path-06\"\n                  className=\"transition-all duration-300 text-blue-600\"\n                />\n                {/* Dot at bottom */}\n                <circle\n                  cx=\"18\"\n                  cy=\"36\"\n                  r=\"4\"\n                  id=\"navbar-logo-dot-07\"\n                  className=\"transition-all duration-300 fill-blue-600\"\n                />\n              </svg>\n              \n              <div id=\"navbar-brand-name-08\" className=\"flex flex-col items-center justify-center gap-0 py-0.5\">\n                <span id=\"navbar-brand-urdu-09\" className=\"text-[clamp(1.25rem,3vw,1.75rem)] font-black mb-[-2px] transition-all duration-300 font-[family-name:var(--font-noto-urdu)] bg-clip-text text-transparent bg-gradient-to-br from-blue-600 via-blue-500 to-blue-700\">\n                  ╪¿┘ê┘ä█î╪º┌║\n                </span>\n                {/* English: Much smaller, wide spacing */}\n                <span id=\"navbar-brand-english-10\" className=\"text-[clamp(7px,1.2vw,9px)] font-bold tracking-[0.4em] uppercase transition-all duration-300 font-[family-name:var(--font-outfit)] bg-clip-text text-transparent bg-gradient-to-br from-blue-400 to-blue-200 leading-none\">\n                  Boliyan\n                </span>\n              </div>\n            </Link>\n          </div>\n        </div>\n\n        {/* Global Search Bar (Full Width on Mobile) */}\n        <motion.div \n          layout\n          transition={{ type: \"spring\", bounce: 0, duration: 0.4 }}\n          className=\"flex-1 px-3 md:px-6 lg:px-0 lg:pl-10 max-w-4xl flex justify-center lg:justify-start\"\n        >\n          <SearchBar />\n        </motion.div>\n\n        <motion.div \n          layout\n          transition={{ type: \"spring\", bounce: 0.2, duration: 0.6 }}\n          id=\"navbar-right-section-11\" \n          className=\"flex items-center gap-1.5 sm:gap-2 shrink-0 ml-auto lg:pr-6\"\n        >\n          {/* Desktop Location Selector */}\n          <div className=\"hidden md:flex flex-col items-end mr-2\">\n            <span className=\"text-[9px] font-black text-slate-400 uppercase tracking-widest mb-[2px] pr-1 leading-none flex items-center gap-1\">\n              <MapPin className=\"h-2.5 w-2.5\" />\n              YOUR LOCATION\n            </span>\n            <LocationSelector align=\"end\" mode=\"user\" />\n          </div>\n\n          <Button id=\"navbar-sell-btn-12\" asChild className=\"hidden sm:flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-bold px-3 sm:px-4 shadow-lg shadow-blue-100 border-0\">\n            <Link href={isLoggedIn ? \"/list\" : `/signin?redirect=${encodeURIComponent(\"/list\")}`}>\n              <Plus id=\"navbar-sell-plus-icon-13\" className=\"h-4 w-4 text-white\" />\n              <span className=\"hidden lg:inline\">Sell Item</span>\n            </Link>\n          </Button>\n\n          <AnimatePresence mode=\"wait\">\n            {isLoading ? (\n              <motion.div\n                key=\"loading\"\n                layout=\"position\"\n                initial={{ opacity: 0, scale: 0.9 }}\n                animate={{ opacity: 1, scale: 1 }}\n                exit={{ opacity: 0, scale: 0.9 }}\n                transition={{ duration: 0.2 }}\n                id=\"navbar-loading-avatar\"\n                className=\"h-10 w-10\"\n              >\n                <Skeleton className=\"h-10 w-10 rounded-full ring-1 ring-slate-200\" />\n              </motion.div>\n            ) : isLoggedIn && user ? (\n              <motion.div\n                key=\"logged-in\"\n                layout=\"position\"\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                transition={{ duration: 0.3, ease: \"easeOut\" }}\n                className=\"flex items-center\"\n              >\n              {/* Desktop Actions - Hidden in Admin Mode */}\n              {!isAdminMode && (\n              <div className=\"hidden md:flex items-center gap-1 mr-2\">\n                <Button id=\"navbar-market-btn\" asChild variant=\"ghost\" className={cn(\n                  \"flex items-center gap-2 rounded-full px-4 relative transition-colors hover:bg-slate-100/80\",\n                  pathname === '/' ? \"text-blue-600 font-bold\" : \"text-slate-600 font-medium\"\n                )}>\n                  <Link href=\"/\" onClick={resetFilters}>\n                    <Store id=\"navbar-market-icon\" className={cn(\"h-5 w-5\", pathname === '/' && \"stroke-[2.5]\")} strokeWidth={pathname === '/' ? 2.5 : 1.5} />\n                    <span>Market</span>\n                  </Link>\n                </Button>\n\n                <Button id=\"navbar-dash-btn\" asChild variant=\"ghost\" className={cn(\n                  \"flex items-center gap-2 rounded-full px-4 relative transition-colors hover:bg-slate-100/80\",\n                  pathname === '/dashboard' ? \"text-blue-600 font-bold\" : \"text-slate-600 font-medium\"\n                )}>\n                  <Link href={`/dashboard?tab=${dashboardTab}`}>\n                    <LayoutDashboard id=\"navbar-dash-icon\" className={cn(\"h-5 w-5\", pathname === '/dashboard' && \"stroke-[2.5]\")} strokeWidth={pathname === '/dashboard' ? 2.5 : 1.5} />\n                    <span>Dash</span>\n                    {dashboardAlertCount > 0 && (\n                      <span className=\"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-rose-600 text-[10px] font-bold text-white ring-2 ring-white\">\n                        {dashboardAlertCount}\n                      </span>\n                    )}\n                  </Link>\n                </Button>\n\n                <Button id=\"navbar-analytics-btn\" asChild variant=\"ghost\" className={cn(\n                  \"flex items-center gap-2 rounded-full px-4 relative transition-colors hover:bg-slate-100/80\",\n                  pathname === '/dashboard/seller' ? \"text-blue-600 font-bold\" : \"text-slate-600 font-medium\"\n                )}>\n                  <Link href=\"/dashboard/seller\">\n                    <BarChart3 id=\"navbar-analytics-icon\" className={cn(\"h-5 w-5\", pathname === '/dashboard/seller' && \"stroke-[2.5]\")} strokeWidth={pathname === '/dashboard/seller' ? 2.5 : 1.5} />\n                    <span>Analytics</span>\n                  </Link>\n                </Button>\n\n                <Button id=\"navbar-chat-btn\" asChild variant=\"ghost\" className={cn(\n                  \"flex items-center gap-2 rounded-full px-4 relative transition-colors hover:bg-slate-100/80\",\n                  pathname.startsWith('/inbox') ? \"text-blue-600 font-bold\" : \"text-slate-600 font-medium\"\n                )}>\n                  <Link href=\"/inbox\">\n                    <MessageSquare id=\"navbar-chat-icon\" className={cn(\"h-5 w-5\", pathname.startsWith('/inbox') && \"stroke-[2.5]\")} strokeWidth={pathname.startsWith('/inbox') ? 2.5 : 1.5} />\n                    <span>Chat</span>\n                    {unreadMsgCount > 0 && (\n                      <span className=\"absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white ring-2 ring-white\">\n                        {unreadMsgCount}\n                      </span>\n                    )}\n                  </Link>\n                </Button>\n\n              </div>\n              )}\n\n              {/* Admin Navigation (shown when in admin mode) */}\n              {isAdminMode && (\n                <div className=\"hidden md:flex items-center gap-1 mr-2\">\n                  <Button id=\"navbar-admin-reports-btn\" asChild variant=\"ghost\" className={cn(\n                    \"flex items-center gap-2 rounded-full px-4 relative transition-colors hover:bg-amber-50\",\n                    pathname === '/admin/reports' ? \"text-amber-600 font-bold bg-amber-50\" : \"text-slate-600 font-medium\"\n                  )}>\n                    <Link href=\"/admin/reports\">\n                      <Flag id=\"navbar-admin-reports-icon\" className={cn(\"h-5 w-5\", pathname === '/admin/reports' && \"stroke-[2.5]\")} strokeWidth={pathname === '/admin/reports' ? 2.5 : 1.5} />\n                      <span>Reports</span>\n                    </Link>\n                  </Button>\n\n                  <Button id=\"navbar-admin-users-btn\" asChild variant=\"ghost\" className={cn(\n                    \"flex items-center gap-2 rounded-full px-4 relative transition-colors hover:bg-amber-50\",\n                    pathname === '/admin/users' ? \"text-amber-600 font-bold bg-amber-50\" : \"text-slate-600 font-medium\"\n                  )}>\n                    <Link href=\"/admin/users\">\n                      <Users id=\"navbar-admin-users-icon\" className={cn(\"h-5 w-5\", pathname === '/admin/users' && \"stroke-[2.5]\")} strokeWidth={pathname === '/admin/users' ? 2.5 : 1.5} />\n                      <span>Users</span>\n                    </Link>\n                  </Button>\n                </div>\n              )}\n\n              {/* New Notification Dropdown - Hidden below lg (1024px) */}\n              <div className=\"hidden lg:block ml-1 mr-3\">\n                 <NotificationDropdown />\n              </div>\n\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <div className=\"relative\">\n                    <Avatar id=\"navbar-avatar-18\" className=\"h-12 w-12 cursor-pointer ring-2 ring-transparent hover:ring-blue-100 transition-all border shadow-sm\">\n                      <AvatarImage id=\"navbar-avatar-image-19\" src={user.avatar} />\n                      <AvatarFallback id=\"navbar-avatar-fallback-20\">{user.name[0]}</AvatarFallback>\n                    </Avatar>\n                    {/* Notification dot on avatar - shown below lg (1024px) when there are unread notifications */}\n                    {notificationUnreadCount > 0 && (\n                      <span className=\"lg:hidden absolute -top-0.5 -right-0.5 flex h-3 w-3\">\n                        <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75\"></span>\n                        <span className=\"relative inline-flex rounded-full h-3 w-3 bg-blue-600 ring-2 ring-white\"></span>\n                      </span>\n                    )}\n                  </div>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\" className=\"w-56 mt-1 p-2 rounded-2xl shadow-xl border-slate-100\">\n                  <DropdownMenuLabel className=\"font-outfit pb-3\">\n                    <div className=\"flex flex-col gap-0.5\">\n                      <span className=\"font-black text-slate-900 flex items-center gap-1.5\">\n                        {user.name}\n                        {user.isVerified && <VerifiedBadge size=\"sm\" />}\n                      </span>\n                      <span className=\"text-[10px] text-slate-500 font-medium\">Verified User</span>\n                    </div>\n                  </DropdownMenuLabel>\n                  <DropdownMenuSeparator className=\"bg-slate-100\" />\n                  {/* Notifications menu item - shown below lg (1024px) */}\n                  <DropdownMenuItem asChild className=\"lg:hidden rounded-xl py-2.5 cursor-pointer focus:bg-slate-50 focus:text-blue-600\">\n                    <Link id=\"navbar-notifications-link\" href=\"/notifications\" className=\"flex items-center w-full\">\n                      <Bell className=\"mr-2.5 h-4 w-4 opacity-70\" />\n                      Notifications\n                      {notificationUnreadCount > 0 && (\n                        <span className=\"ml-auto flex h-5 min-w-[1.25rem] px-1.5 items-center justify-center rounded-full bg-blue-100 text-[10px] font-bold text-blue-700\">\n                          {notificationUnreadCount}\n                        </span>\n                      )}\n                    </Link>\n                  </DropdownMenuItem>\n                  <DropdownMenuItem asChild className=\"rounded-xl py-2.5 cursor-pointer focus:bg-slate-50 focus:text-blue-600\">\n                    <Link id=\"navbar-profile-link\" href=\"/profile\" className=\"flex items-center w-full\">\n                      <UserCircle className=\"mr-2.5 h-4 w-4 opacity-70\" />\n                      Profile\n                    </Link>\n                  </DropdownMenuItem>\n                  {/* Admin Mode Toggle - only visible to admin users */}\n                  {user.role === 'admin' && (\n                    <>\n                      <DropdownMenuSeparator className=\"bg-slate-100\" />\n                      <DropdownMenuItem \n                        id=\"navbar-admin-toggle\"\n                        onClick={toggleAdminMode}\n                        className={cn(\n                          \"rounded-xl py-2.5 cursor-pointer\",\n                          isAdminMode \n                            ? \"bg-amber-50 text-amber-700 focus:bg-amber-100\" \n                            : \"focus:bg-amber-50 focus:text-amber-700\"\n                        )}\n                      >\n                        <Shield className=\"mr-2.5 h-4 w-4 opacity-70\" />\n                        {isAdminMode ? \"Exit Admin Mode\" : \"Admin Mode\"}\n                        {isAdminMode && (\n                          <span className=\"ml-auto text-[9px] font-bold bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded-full\">\n                            ON\n                          </span>\n                        )}\n                      </DropdownMenuItem>\n                    </>\n                  )}\n                  <DropdownMenuSeparator className=\"bg-slate-100\" />\n                  <DropdownMenuItem \n                    id=\"navbar-logout-btn\"\n                    onClick={() => {\n                      logout();\n                    }}\n                    className=\"rounded-xl py-2.5 cursor-pointer focus:bg-red-50 focus:text-red-600 text-red-500\"\n                  >\n                    <LogOut className=\"mr-2.5 h-4 w-4 opacity-70\" />\n                    Logout\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n              </motion.div>\n            ) : (\n              <motion.div\n                key=\"signed-out\"\n                layout=\"position\"\n                initial={{ opacity: 0, scale: 0.9 }}\n                animate={{ opacity: 1, scale: 1 }}\n                exit={{ opacity: 0, scale: 0.9 }}\n                transition={{ duration: 0.2 }}\n              >\n                <Button id=\"navbar-signin-btn\" asChild className=\"h-11 px-6 bg-blue-600 hover:bg-blue-700 font-bold text-sm shadow-md shadow-blue-200\">\n                  <Link href={`/signin?redirect=${encodeURIComponent(pathname + (searchParams?.toString() ? `?${searchParams.toString()}` : \"\"))}`}>Sign In</Link>\n                </Button>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </motion.div>\n        </LayoutGroup>\n      </div>\n    </nav>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\layout\\ScrollToTop.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\layout\\SearchDropdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\layout\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\CategoryBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\ClearFiltersButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setMpFilter' is assigned a value but never used.","line":28,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":53}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { memo, useMemo } from \"react\";\r\nimport { useMarketplace } from \"@/context/MarketplaceContext\";\r\nimport { useSearch } from \"@/context/SearchContext\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { FilterX } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface ClearFiltersButtonProps {\r\n  className?: string;\r\n  variant?: \"inline\" | \"mobile\";\r\n}\r\n\r\n/**\r\n * ClearFiltersButton - Shows when any non-default filter is active\r\n * \r\n * Default state (no button shown):\r\n * - sortBy: 'trending'\r\n * - category: null (All Items)\r\n * - condition: 'all'\r\n * - listingType: 'all'\r\n * - minPrice: null\r\n * - maxPrice: null\r\n * - search query: empty\r\n */\r\nfunction ClearFiltersButton({ className, variant = \"inline\" }: ClearFiltersButtonProps) {\r\n  const { filters: mpFilters, setFilter: setMpFilter, updateFilters } = useMarketplace();\r\n  const { filters: searchFilters, setFilters: setSearchFilters } = useSearch();\r\n\r\n  // Calculate active filter count\r\n  const activeFilterCount = useMemo(() => {\r\n    let count = 0;\r\n    \r\n    // Sort (non-default if not 'trending')\r\n    if (mpFilters.sortBy !== 'trending') count++;\r\n    \r\n    // Category (non-default if set)\r\n    if (mpFilters.category) count++;\r\n    \r\n    // Condition (non-default if not 'all')\r\n    if (mpFilters.condition !== 'all') count++;\r\n    \r\n    // Listing type (non-default if not 'all')\r\n    if (mpFilters.listingType !== 'all') count++;\r\n    \r\n    // Price range\r\n    if (mpFilters.minPrice !== null) count++;\r\n    if (mpFilters.maxPrice !== null) count++;\r\n    \r\n    // Search query\r\n    if (searchFilters.query?.trim()) count++;\r\n    \r\n    return count;\r\n  }, [mpFilters, searchFilters.query]);\r\n\r\n  const hasActiveFilters = activeFilterCount > 0;\r\n\r\n  const handleClear = () => {\r\n    // Reset marketplace filters\r\n    updateFilters({\r\n      category: null,\r\n      sortBy: 'trending',\r\n      minPrice: null,\r\n      maxPrice: null,\r\n      condition: 'all',\r\n      listingType: 'all',\r\n    });\r\n    \r\n    // Clear search query\r\n    if (searchFilters.query) {\r\n      setSearchFilters({ ...searchFilters, query: '' });\r\n    }\r\n  };\r\n\r\n  const isMobile = variant === \"mobile\";\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {hasActiveFilters && (\r\n        <motion.button\r\n          id=\"clear-filters-btn\"\r\n          initial={{ opacity: 0, scale: 0.8 }}\r\n          animate={{ opacity: 1, scale: 1 }}\r\n          exit={{ opacity: 0, scale: 0.8 }}\r\n          transition={{ duration: 0.2, ease: \"easeOut\" }}\r\n          onClick={handleClear}\r\n          className={cn(\r\n            // Base styles\r\n            \"flex items-center gap-2 font-bold transition-all duration-200 active:scale-[0.98] shrink-0\",\r\n            \r\n            // Mobile variant - full width horizontal bar\r\n            isMobile && [\r\n              \"justify-center py-2.5 px-4 bg-red-50 border border-red-200 rounded-xl\",\r\n              \"hover:bg-red-100 active:bg-red-200\",\r\n              \"shadow-sm hover:shadow-md text-red-600\"\r\n            ],\r\n            \r\n            // Desktop inline variant\r\n            !isMobile && [\r\n              \"px-3 py-1.5 rounded-full border\",\r\n              \"bg-red-50 border-red-200 text-red-600\",\r\n              \"hover:bg-red-100 hover:border-red-300\",\r\n              \"shadow-sm hover:shadow-md\"\r\n            ],\r\n            \r\n            className\r\n          )}\r\n        >\r\n          <FilterX className={cn(\r\n            \"text-red-500\",\r\n            isMobile ? \"h-4 w-4\" : \"h-4 w-4\"\r\n          )} />\r\n          \r\n          <span className=\"text-sm\">\r\n            Clear Filters {activeFilterCount > 1 ? `(${activeFilterCount})` : \"\"}\r\n          </span>\r\n        </motion.button>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n\r\nexport default memo(ClearFiltersButton);\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\FilterSheetContent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\ItemCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\ItemCardSkeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\ListingBadges.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\LocationSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\MarketplaceGrid.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used.","line":3,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { motion, AnimatePresence, LayoutGroup } from \"framer-motion\";\r\nimport { useRef, useState, useEffect, useSyncExternalStore } from \"react\";\r\nimport type { SearchFilters } from \"@/types\";\r\nimport { useMarketplace } from \"@/context/MarketplaceContext\";\r\nimport { useSearch } from \"@/context/SearchContext\";\r\nimport ItemCard from \"./ItemCard\";\r\nimport AdCard from \"@/components/ads/AdCard\";\r\nimport ItemCardSkeleton from \"./ItemCardSkeleton\";\r\nimport EmptyState from \"@/components/ui/EmptyState\";\r\nimport SmartFilterBar, { FILTERS } from \"./SmartFilterBar\";\r\nimport ClearFiltersButton from \"./ClearFiltersButton\";\r\nimport CategoryNav from \"@/components/search/CategoryNav\";\r\nimport { LocationSelector } from \"./LocationSelector\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { useIntersectionObserver } from \"@/hooks/useIntersectionObserver\";\r\n\r\nimport { \r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n} from \"@/components/ui/select\";\r\nimport { LayoutGrid, Grid3x3, Grid2x2, Gavel } from \"lucide-react\";\r\nimport PriceSelector from \"./PriceSelector\";\r\n\r\nimport { ToggleGroup, ToggleGroupItem } from \"@/components/ui/toggle-group\";\r\nimport { CATEGORIES } from \"@/lib/constants\";\r\nimport { NewListingsToast } from \"@/components/ui/NewListingsToast\";\r\nimport { ContinueBrowsingModal } from \"@/components/ui/ContinueBrowsingModal\";\r\n\r\n// Listing type options for dropdown\r\nconst LISTING_TYPES = [\r\n  { id: 'all', label: 'All Types' },\r\n  { id: 'public', label: 'Public Bid' },\r\n  { id: 'hidden', label: 'Hidden Bid' },\r\n] as const;\r\n\r\ntype ViewMode = 'compact' | 'comfortable' | 'spacious';\r\ntype FilterId = typeof FILTERS[number]['id'];\r\n\r\n\r\nconst subscribeToViewport = (callback: () => void) => {\r\n  if (typeof window === \"undefined\") return () => {};\r\n  window.addEventListener(\"resize\", callback);\r\n  return () => window.removeEventListener(\"resize\", callback);\r\n};\r\n\r\nconst getSearchSortFilterId = (sort?: SearchFilters['sortBy']): FilterId => {\r\n  if (sort === 'price_high') return 'luxury';\r\n  if (sort === 'ending_soon') return 'ending_soon';\r\n  if (sort === 'nearest') return 'nearest';\r\n  return 'newest';\r\n};\r\n\r\nconst mapFilterToSearchSort = (id: FilterId): SearchFilters['sortBy'] | null => {\r\n  if (id === 'luxury') return 'price_high';\r\n  if (id === 'ending_soon') return 'ending_soon';\r\n  if (id === 'nearest') return 'nearest';\r\n  if (id === 'watchlist') return null;\r\n  return 'newest';\r\n};\r\n\r\nconst getViewportSnapshot = () => (typeof window !== \"undefined\" ? window.innerWidth >= 768 : false);\r\nconst getServerSnapshot = () => false;\r\n\r\nexport default function MarketplaceGrid() {\r\n  const { items: marketplaceItems, filters: mpFilters, setFilter: setMpFilter, isLoading: mpLoading, isLoadingMore, isRevalidating, hasMore, loadMore, liveFeed } = useMarketplace();\r\n  const { searchResults, isSearching, filters: searchFilters, setFilters: setSearchFilters } = useSearch();\r\n  \r\n  // Live feed toast dismiss state\r\n  const [toastDismissed, setToastDismissed] = useState(false);\r\n\r\n  const isDesktop = useSyncExternalStore(subscribeToViewport, getViewportSnapshot, getServerSnapshot);\r\n  const [manualViewMode, setManualViewMode] = useState<ViewMode | null>(null);\r\n  const viewMode = manualViewMode ?? (isDesktop ? 'comfortable' : 'compact');\r\n  const [isChangingView, setIsChangingView] = useState(false);\r\n  const viewChangeTimerRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Decide which items to show\r\n  // Only switch to search mode when there's an actual TEXT query\r\n  // Category filtering should use MarketplaceContext to avoid double-fetching\r\n  const isSearchActive = (searchFilters.query?.trim().length ?? 0) > 0;\r\n  const displayItems = isSearchActive ? searchResults : marketplaceItems;\r\n  const currentSortId = isSearchActive ? getSearchSortFilterId(searchFilters.sortBy) : mpFilters.sortBy;\r\n  \r\n  // Toast shows when: pending items exist AND user hasn't dismissed\r\n  // After loading pending items, pendingCount goes to 0 which hides toast\r\n  // Effective loading state: \r\n  // We want to show skeletons if we're REALLY loading or if we're briefly transitioning viewMode\r\n  const isLoading = (isSearchActive ? isSearching : mpLoading) || isChangingView;\r\n\r\n  // Handle view mode changes with a clean \"blink\" to skeletons\r\n  const handleViewModeChange = (newMode: ViewMode) => {\r\n    if (newMode === viewMode) return;\r\n    \r\n    // Clear any existing timer\r\n    if (viewChangeTimerRef.current) clearTimeout(viewChangeTimerRef.current);\r\n    \r\n    setIsChangingView(true);\r\n    setManualViewMode(newMode);\r\n    \r\n    // Brief window to show skeletons and allow browser to recalc layout\r\n    viewChangeTimerRef.current = setTimeout(() => {\r\n      setIsChangingView(false);\r\n      viewChangeTimerRef.current = null;\r\n    }, 350); // Balanced for speed and visibility\r\n  };\r\n\r\n  // Cleanup timers on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (viewChangeTimerRef.current) clearTimeout(viewChangeTimerRef.current);\r\n    };\r\n  }, []);\r\n\r\n  // NOTE: Removed duplicate executeSearch trigger.\r\n  // SearchContext.executeSearch is called internally when filters change via its own useEffect.\r\n  // Double-triggering was causing visual \"refresh\" flicker.\r\n  \r\n  \r\n  // Infinite Scroll Trigger\r\n  const loadMoreRef = useRef<HTMLDivElement>(null);\r\n  const entry = useIntersectionObserver(loadMoreRef, {\r\n    threshold: 0,\r\n    rootMargin: '800px', // Aggressive prefetch: Trigger when 800px from bottom (approx 3 screen heights)\r\n  });\r\n\r\n  useEffect(() => {\r\n    // Only load more for MP feed. Search pagination not yet implemented in this phase plan (limited to 50)\r\n    if (!isSearchActive && entry?.isIntersecting && hasMore && !isLoadingMore && !isLoading) {\r\n      loadMore();\r\n    }\r\n  }, [entry, hasMore, isLoadingMore, isLoading, loadMore, isSearchActive]);\r\n\r\n\r\n\r\n\r\n  // Grid class mapping based on view mode\r\n  const getGridClasses = () => {\r\n    switch (viewMode) {\r\n      case 'spacious':\r\n        return \"grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3\";\r\n      case 'comfortable':\r\n        return \"grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4\";\r\n      case 'compact':\r\n      default:\r\n        return \"grid-cols-2 sm:grid-cols-[repeat(auto-fill,minmax(165px,1fr))] md:grid-cols-[repeat(auto-fill,minmax(220px,1fr))]\";\r\n    }\r\n  };\r\n\r\n  const getGridStyle = () => {\r\n    return {};\r\n  };\r\n\r\n  // Helper to sync category changes to MarketplaceContext (not SearchContext)\r\n  // This prevents category changes from interfering with the search query state\r\n  const handleCategoryChange = (val: string | null) => {\r\n      setMpFilter('category', val);\r\n  };\r\n\r\n  return (\r\n    <div id=\"marketplace-grid-root\" className=\"px-4 pb-4 pt-2 md:px-4 md:pb-4 md:pt-2\">\r\n      {/* Subtle Refresh Indicator - shows during background cache revalidation */}\r\n      {isRevalidating && (\r\n        <div id=\"revalidating-indicator\" className=\"fixed top-0 left-0 right-0 z-50 h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-blue-500 animate-pulse\" />\r\n      )}\r\n      {/* Live Feed UI Components */}\r\n      {!toastDismissed && liveFeed.pendingCount > 0 && mpFilters.sortBy === 'newest' && (\r\n        <NewListingsToast\r\n          count={liveFeed.pendingCount}\r\n          onLoad={() => {\r\n            liveFeed.loadPending();\r\n            setToastDismissed(true);\r\n          }}\r\n          onDismiss={() => setToastDismissed(true)}\r\n        />\r\n      )}\r\n      <ContinueBrowsingModal\r\n        open={liveFeed.showContinuePrompt}\r\n        onContinue={liveFeed.continueWatching}\r\n        onPause={liveFeed.pauseUpdates}\r\n      />\r\n      <div className=\"mb-4 md:mb-0 bg-white border border-slate-200/60 shadow-sm rounded-2xl flex flex-col gap-0 md:bg-transparent md:border-0 md:shadow-none\">\r\n        <div className=\"flex flex-col gap-2 pt-2 pb-2 md:py-0\">\r\n          {/* MOBILE: New Enhanced \"Search & Filter\" Mobile Header */}\r\n          <div id=\"mobile-search-filter-container\" className=\"md:hidden flex flex-col gap-2 px-4 mb-2\">\r\n            \r\n            {/* Filter Grid Container */}\r\n            <div className=\"flex flex-col gap-2\">\r\n              \r\n              {/* Clear Filters Row (shown when filters active) */}\r\n              <ClearFiltersButton variant=\"mobile\" className=\"w-full\" />\r\n              \r\n              {/* Row 1: Sort, Category, Type, View */}\r\n              <div className=\"grid grid-cols-4 gap-2\">\r\n                {/* 1. Sort Tab */}\r\n                <Select \r\n                  value={currentSortId}\r\n                  onValueChange={(value) => {\r\n                    if (isSearchActive) {\r\n                      const mappedSort = mapFilterToSearchSort(value as FilterId);\r\n                      if (!mappedSort) return;\r\n                      setSearchFilters({ ...searchFilters, sortBy: mappedSort });\r\n                    } else {\r\n                      setMpFilter('sortBy', value as typeof mpFilters.sortBy);\r\n                    }\r\n                  }}\r\n                >\r\n                  <SelectTrigger id=\"mobile-sort-select\" className=\"!h-auto w-full flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 border-slate-200 rounded-xl hover:bg-slate-100 active:scale-y-95 active:bg-slate-200 transition-all duration-200 ease-in-out [&>span]:w-full [&_svg.lucide-chevron-down]:hidden shadow-sm hover:shadow-md\">\r\n                     {(() => {\r\n                        const activeFilter = FILTERS.find(f => f.id === currentSortId) || FILTERS[0];\r\n                        const Icon = activeFilter.icon;\r\n                        return (\r\n                          <>\r\n                            <Icon className={`h-5 w-5 ${activeFilter.color}`} />\r\n                            <span className=\"text-[10px] font-medium leading-none text-slate-600 truncate w-full text-center\">\r\n                              {activeFilter.label.split(' ')[0]}\r\n                            </span>\r\n                          </>\r\n                        );\r\n                     })()}\r\n                  </SelectTrigger>\r\n                  <SelectContent className=\"z-[200]\" position=\"popper\" sideOffset={4}>\r\n                    {FILTERS.map((f) => (\r\n                      <SelectItem key={f.id} value={f.id} className=\"text-sm\">\r\n                        <span className=\"flex items-center gap-2\">\r\n                          <f.icon className={`h-4 w-4 ${f.color}`} />\r\n                          {f.label}\r\n                        </span>\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n\r\n                {/* 2. Category Tab */}\r\n                <Select \r\n                  value={mpFilters.category || 'All Items'} \r\n                  onValueChange={(value) => handleCategoryChange(value === 'All Items' ? null : value)}\r\n                >\r\n                  <SelectTrigger id=\"mobile-category-select\" className=\"!h-auto w-full flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 border-slate-200 rounded-xl hover:bg-slate-100 active:scale-y-95 active:bg-slate-200 transition-all duration-200 ease-in-out [&>span]:w-full [&_svg.lucide-chevron-down]:hidden shadow-sm hover:shadow-md\">\r\n                     {(() => {\r\n                        const activeCat = CATEGORIES.find(c => c.label === mpFilters.category) || CATEGORIES[0];\r\n                        const Icon = activeCat.icon;\r\n                        return (\r\n                          <>\r\n                            <Icon className=\"h-5 w-5 text-blue-500\" />\r\n                            <span className=\"text-[10px] font-medium leading-none text-slate-600 truncate w-full text-center\">\r\n                              {mpFilters.category ? mpFilters.category.split(' ')[0] : 'Categories'}\r\n                            </span>\r\n                          </>\r\n                        );\r\n                     })()}\r\n                  </SelectTrigger>\r\n                  <SelectContent className=\"z-[200]\" position=\"popper\" sideOffset={4}>\r\n                    {CATEGORIES.map((cat) => (\r\n                      <SelectItem key={cat.label} value={cat.label} className=\"text-sm\">\r\n                        <span className=\"flex items-center gap-2\">\r\n                          <cat.icon className=\"h-4 w-4 text-slate-500\" />\r\n                          {cat.label}\r\n                        </span>\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n\r\n                {/* 3. Type Tab */}\r\n                <Select \r\n                  value={mpFilters.listingType} \r\n                  onValueChange={(value) => setMpFilter('listingType', value as typeof mpFilters.listingType)}\r\n                >\r\n                  <SelectTrigger id=\"mobile-type-select\" className=\"!h-auto w-full flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 border-slate-200 rounded-xl hover:bg-slate-100 active:scale-y-95 active:bg-slate-200 transition-all duration-200 ease-in-out [&>span]:w-full [&_svg.lucide-chevron-down]:hidden shadow-sm hover:shadow-md\">\r\n                     {(() => {\r\n                        return (\r\n                          <>\r\n                             <Gavel className={`h-5 w-5 ${mpFilters.listingType !== 'all' ? 'text-blue-500' : 'text-slate-500'}`} />\r\n                            <span className=\"text-[10px] font-medium leading-none text-slate-600 truncate w-full text-center\">\r\n                              {mpFilters.listingType === 'all' ? 'Type' : mpFilters.listingType === 'public' ? 'Public' : 'Hidden'}\r\n                            </span>\r\n                          </>\r\n                        );\r\n                     })()}\r\n                  </SelectTrigger>\r\n                  <SelectContent className=\"z-[200]\" position=\"popper\" sideOffset={4}>\r\n                    {LISTING_TYPES.map((type) => (\r\n                      <SelectItem key={type.id} value={type.id} className=\"text-sm\">\r\n                        {type.label}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n\r\n                {/* 4. View Toggle (Cycle) */}\r\n                <Button\r\n                  id=\"mobile-view-toggle\"\r\n                  variant=\"outline\"\r\n                  className=\"!h-auto w-full flex flex-col items-center justify-center gap-1 p-2 bg-slate-50 border-slate-200 rounded-xl hover:bg-slate-100 active:scale-y-95 active:bg-slate-200 transition-all duration-200 ease-in-out shadow-sm hover:shadow-md\"\r\n                  onClick={() => {\r\n                    handleViewModeChange(viewMode === 'compact' ? 'spacious' : 'compact');\r\n                  }}\r\n                >\r\n                  {viewMode === 'compact' && <Grid3x3 className=\"h-5 w-5 text-slate-700\" />}\r\n                  {viewMode === 'comfortable' && <Grid2x2 className=\"h-5 w-5 text-slate-700\" />}\r\n                  {viewMode === 'spacious' && <LayoutGrid className=\"h-5 w-5 text-slate-700\" />}\r\n                  \r\n                  <span className=\"text-[10px] font-medium leading-none text-slate-600 truncate w-full text-center\">\r\n                     View\r\n                  </span>\r\n                </Button>\r\n              </div>\r\n\r\n              {/* Row 2: Location, Price */}\r\n              <div className=\"grid grid-cols-2 gap-2\">\r\n                {/* 5. Location (Span 1) */}\r\n                <div className=\"w-full\">\r\n                  <LocationSelector \r\n                    variant=\"mobile-grid\" \r\n                    className=\"w-full\" \r\n                    align=\"start\" \r\n                  />\r\n                </div>\r\n\r\n                {/* 6. Price (Span 1) */}\r\n                <div className=\"w-full\">\r\n                  <PriceSelector />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* DESKTOP: Full Filter Buttons Row */}\r\n          <div id=\"smart-filters-row\" className=\"hidden md:flex items-center gap-4 md:px-0\">\r\n            <LayoutGroup>\r\n              <motion.div layout className=\"flex-1 overflow-x-auto scrollbar-hide flex items-center gap-4\">\r\n                <ClearFiltersButton variant=\"inline\" />\r\n                <motion.div layout>\r\n                  <SmartFilterBar />\r\n                </motion.div>\r\n              </motion.div>\r\n            </LayoutGroup>\r\n\r\n            {/* View Toggle Controls (Desktop) */}\r\n            {/* View Toggle Controls (Desktop) */}\r\n            <ToggleGroup \r\n              id=\"view-mode-toggles\"\r\n              type=\"single\" \r\n              value={viewMode} \r\n              onValueChange={(val) => val && handleViewModeChange(val as ViewMode)}\r\n              className=\"bg-slate-50 h-9 rounded-xl border border-slate-200 shadow-sm shrink-0 overflow-hidden\"\r\n            >\r\n              <ToggleGroupItem \r\n                value=\"compact\" \r\n                aria-label=\"Compact View\" \r\n                className=\"h-full w-10 data-[state=on]:bg-slate-900 data-[state=on]:text-white data-[state=on]:shadow-sm text-slate-500 hover:text-slate-900 hover:bg-slate-100 p-0\"\r\n              >\r\n                <Grid3x3 className=\"h-4 w-4\" />\r\n              </ToggleGroupItem>\r\n              <ToggleGroupItem \r\n                value=\"comfortable\" \r\n                aria-label=\"Comfortable View\"\r\n                className=\"h-full w-10 data-[state=on]:bg-slate-900 data-[state=on]:text-white data-[state=on]:shadow-sm text-slate-500 hover:text-slate-900 hover:bg-slate-100 p-0\"\r\n              >\r\n                <Grid2x2 className=\"h-4 w-4\" />\r\n              </ToggleGroupItem>\r\n              <ToggleGroupItem \r\n                value=\"spacious\" \r\n                aria-label=\"Spacious View\"\r\n                className=\"h-full w-10 data-[state=on]:bg-slate-900 data-[state=on]:text-white data-[state=on]:shadow-sm text-slate-500 hover:text-slate-900 hover:bg-slate-100 p-0\"\r\n              >\r\n                <LayoutGrid className=\"h-4 w-4\" />\r\n              </ToggleGroupItem>\r\n            </ToggleGroup>\r\n          </div>\r\n          \r\n\r\n        </div>\r\n      </div>\r\n\r\n        {/* Category Bar Row */}\r\n        <div id=\"category-bar-row\" className=\"hidden md:block pb-2 md:px-0\">\r\n           <CategoryNav />\r\n        </div>\r\n      \r\n      \r\n      <div \r\n        id=\"marketplace-grid-container\"\r\n        className={`grid gap-3 ${getGridClasses()}`}\r\n        style={getGridStyle()}\r\n      >\r\n        {isLoading ? (\r\n          // Skeletons during Load or View Change\r\n          // No AnimatePresence wrapper -> Instant mount/unmount logic, but we can animate Entry of new items.\r\n          <>\r\n            {Array.from({ length: 8 }).map((_, i) => (\r\n              <div key={`skeleton-initial-${i}`}>\r\n                <ItemCardSkeleton viewMode={viewMode} />\r\n              </div>\r\n            ))}\r\n          </>\r\n        ) : (\r\n          // Actual Content\r\n          <>\r\n            {displayItems.map((item, index) => {\r\n              const seller = item.seller!;\r\n              const isAdSpot = (index + 1) % 6 === 0;\r\n\r\n              return (\r\n                <div key={`container-${item.id}`} className=\"contents\">\r\n                  <motion.div \r\n                    key={item.id}\r\n                    initial={{ opacity: 0 }} \r\n                    animate={{ opacity: 1 }} \r\n                    transition={{ duration: 0.3 }} // Smooth entry\r\n                  >\r\n                    <ItemCard item={item} seller={seller} viewMode={viewMode} />\r\n                  </motion.div>\r\n                  \r\n                  {isAdSpot && (\r\n                    <motion.div\r\n                       key={`ad-card-${index}`}\r\n                       initial={{ opacity: 0 }} \r\n                       animate={{ opacity: 1 }} \r\n                       transition={{ duration: 0.3 }}\r\n                    >\r\n                      <AdCard id={`in-feed-${index}`} viewMode={viewMode} />\r\n                    </motion.div>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n\r\n            {/* Infinite Scroll Skeletons */}\r\n            {isLoadingMore && !isSearchActive && Array.from({ length: 4 }).map((_, i) => (\r\n              <div key={`skeleton-more-${i}`}>\r\n                <ItemCardSkeleton viewMode={viewMode} />\r\n              </div>\r\n            ))}\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* Sentinel for Infinite Scroll - Always render so Ref attaches, but logic handles trigger */}\r\n      <div \r\n        ref={loadMoreRef} \r\n        className=\"h-4 w-full flex items-center justify-center pointer-events-none opacity-0\" \r\n      />\r\n\r\n\r\n      {!isLoading && displayItems.length === 0 && (\r\n        <EmptyState />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\PriceSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\ProductDetailsModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\SmartFilterBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\product-modal\\BiddingDashboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\product-modal\\FullscreenGallery.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\product-modal\\ProductGallery.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\marketplace\\product-modal\\ProductInfo.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\notifications\\NotificationDropdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\notifications\\NotificationItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\profile\\ProfileCompleteness.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\profile\\ReportUserModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\profile\\ReviewForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\profile\\ReviewList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\profile\\StarRating.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\search\\CategoryNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\search\\SearchBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\search\\SearchFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\search\\SimilarItems.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\seller\\DeleteConfirmationDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\seller\\SellerBidCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'conversation' is assigned a value but never used.","line":28,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useMemo } from \"react\";\nimport { Bid, User } from \"@/types\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { MapPin, MessageSquare, Star, Check, X } from \"lucide-react\";\nimport { buildWhatsAppMessageForDeal, calculatePrivacySafeDistance, getFuzzyLocationString, formatPrice, getWhatsAppUrl, cn } from \"@/lib/utils\";\nimport { useApp } from \"@/lib/store\";\nimport { useTime } from \"@/context/TimeContext\";\nimport { useRouter } from \"next/navigation\";\nimport { WhatsAppIcon } from \"@/components/common/WhatsAppIcon\";\nimport { TimerBadge } from \"@/components/common/TimerBadge\";\nimport { DistanceBadge } from \"@/components/common/DistanceBadge\";\nimport Link from \"next/link\";\n\ninterface SellerBidCardProps {\n  bid: Bid;\n  bidder: User;\n}\n\nexport default function SellerBidCard({ bid, bidder }: SellerBidCardProps) {\n  const { rejectBid, acceptBid, conversations, user, itemsById } = useApp();\n  const { now } = useTime();\n  const router = useRouter();\n  \n  const item = itemsById[bid.itemId];\n  const conversation = conversations.find(c => \n    c.itemId === bid.itemId && \n    ((c.sellerId === user?.id && c.bidderId === bidder.id) || \n     (c.bidderId === user?.id && c.sellerId === bidder.id))\n  );\n  \n  // Stable derived values based on bidder profile\n  const { distance, duration, isOutside } = useMemo(() => {\n    return calculatePrivacySafeDistance(user?.location, bidder.location);\n  }, [user?.location, bidder.location]);\n\n  const location = useMemo(() => getFuzzyLocationString(bidder.location.address), [bidder.location.address]);\n\n  const waMessage = buildWhatsAppMessageForDeal({\n    item,\n    bidAmount: bid.amount,\n    myRole: 'seller',\n    myLocation: user?.location,\n    otherUserLocation: bidder.location\n  });\n\n  // Calculate time remaining\n  const expiresAt = useMemo(() => \n    bid.expiresAt ? new Date(bid.expiresAt) : new Date(new Date(bid.createdAt).getTime() + 24 * 60 * 60 * 1000)\n  , [bid.expiresAt, bid.createdAt]);\n\n  const isExpired = bid.status === 'expired' || expiresAt.getTime() <= now;\n  \n  const handleReject = () => {\n    rejectBid(bid.id);\n  };\n\n  const handleAccept = async () => {\n    const convId = await acceptBid(bid.id);\n    if (convId) {\n        router.push(`/inbox?id=${convId}`);\n    }\n  };\n\n  const handleChat = () => {\n    const conv = conversations.find(c => \n      c.itemId === bid.itemId && \n      ((c.sellerId === user?.id && c.bidderId === bidder.id) || \n       (c.bidderId === user?.id && c.sellerId === bidder.id))\n    );\n    \n    if (conv) {\n      router.push(`/inbox?id=${conv.id}`);\n    } else {\n      router.push(\"/inbox\");\n    }\n  };\n\n  if (bid.status === 'rejected') {\n    return null;\n  }\n\n  return (\n    <div id={`bid-card-${bid.id}`} className=\"@container bg-slate-50 border border-slate-200 rounded-xl hover:shadow-md transition-all p-3\">\n      {/* MOBILE Layout */}\n      <div id={`bid-card-mobile-${bid.id}`} className=\"flex flex-col gap-2 md:hidden\">\n        <div id={`bid-card-mobile-top-row-${bid.id}`} className=\"flex items-start justify-between gap-3\">\n          <div id={`bid-card-mobile-user-info-${bid.id}`} className=\"flex items-center gap-2 min-w-0 flex-1\">\n            <Avatar className=\"h-9 w-9 border-2 border-slate-50 shrink-0\">\n              <AvatarImage id={`bidder-avatar-img-mobile-${bid.id}`} src={bidder.avatar} />\n              <AvatarFallback id={`bidder-avatar-fallback-mobile-${bid.id}`}>{bidder.name[0]}</AvatarFallback>\n            </Avatar>\n            \n            <div className=\"min-w-0 flex-1\">\n              <div className=\"flex items-center gap-1.5 flex-wrap\">\n                <Link href={`/user/${bidder.id}`} id={`bidder-name-mobile-${bid.id}`} className=\"font-semibold text-sm text-slate-700 truncate max-w-[120px] hover:text-blue-600 transition-colors\">{bidder.name}</Link>\n                <div id={`bidder-rating-mobile-${bid.id}`} className=\"flex items-center gap-1 bg-amber-50 px-1 py-0.5 rounded-md border border-amber-100 shrink-0\">\n                  <div className=\"flex items-center gap-0.5 text-[10px] text-amber-600 font-black\">\n                      <Star className=\"h-2.5 w-2.5 fill-amber-500\" />\n                      {bidder.rating}\n                  </div>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2 mt-0.5 text-[10px] text-muted-foreground w-full\">\n                  <div id={`bidder-location-mobile-${bid.id}`} className=\"flex items-center gap-0.5 min-w-0 overflow-hidden\">\n                    <MapPin className=\"h-2.5 w-2.5 text-red-400 shrink-0\" />\n                    <span className=\"truncate max-w-[120px]\">{location}</span>\n                  </div>\n              </div>\n            </div>\n          </div>\n\n          <div id={`bid-card-mobile-price-section-${bid.id}`} className=\"text-right shrink-0 flex flex-col items-end\">\n            <span className=\"text-[clamp(0.5625rem,2.25cqi,0.75rem)] font-black uppercase tracking-[0.08em] text-slate-500/80 mb-1\">Bid Amount</span>\n            <p id={`bid-amount-mobile-${bid.id}`} className=\"price-font font-black text-blue-600 leading-none truncate text-[clamp(1rem,5cqi,1.25rem)]\">Rs. {formatPrice(bid.amount)}</p>\n            {!isExpired && (bid.status === 'pending' || bid.status === 'shortlisted') && (\n                 <div className=\"mt-1 flex justify-end\">\n                    <TimerBadge expiryAt={expiresAt.toISOString()} variant=\"solid\" className=\"bg-transparent text-slate-400 p-0 shadow-none animate-none\" />\n                 </div>\n            )}\n            {isExpired && bid.status !== 'accepted' && (\n                <div className=\"text-[9px] font-bold mt-1 text-right text-red-500 uppercase tracking-tighter\">\n                   Expired\n                </div>\n            )}\n            {!isOutside && (\n              <div id={`bid-distance-info-mobile-${bid.id}`} className=\"flex items-center justify-end gap-2 mt-1 text-[10px] text-muted-foreground font-medium whitespace-nowrap\">\n                <DistanceBadge \n                  distance={distance} \n                  duration={duration} \n                  variant=\"inline\" \n                  className=\"bg-slate-100 px-1.5 py-0.5 rounded text-muted-foreground\"\n                  iconClassName=\"h-2.5 w-2.5\"\n                />\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div id={`bid-card-mobile-actions-${bid.id}`} className=\"grid grid-cols-2 gap-3 mt-1\">\n          {bid.status !== 'accepted' && (\n            <Button id={`bid-reject-btn-mobile-${bid.id}`} onClick={handleReject} variant=\"outline\" className=\"w-full h-10 border-slate-200 hover:bg-red-50 hover:text-red-600 hover:border-red-200 text-slate-600 font-semibold\">\n              <X className=\"h-4 w-4 mr-2\" />\n              Reject\n            </Button>\n          )}\n          {bid.status === 'accepted' ? (\n            <div className=\"col-span-2 flex gap-2\">\n              <Button \n                id={`bid-whatsapp-btn-mobile-${bid.id}`} \n                disabled={!bidder.phone && !bidder.whatsapp}\n                className={cn(\n                  \"flex-1 h-10 font-bold transition-all\",\n                  (bidder.phone || bidder.whatsapp)\n                    ? \"bg-emerald-600 hover:bg-emerald-700 text-white\" \n                    : \"bg-slate-100 text-slate-400 grayscale cursor-not-allowed border border-slate-200\"\n                )}\n                onClick={(e) => {\n                  e.stopPropagation();\n                  if (!bidder.phone && !bidder.whatsapp) return;\n                  window.open(getWhatsAppUrl(bidder.whatsapp || bidder.phone || \"\", waMessage), '_blank');\n                }} \n              >\n                <WhatsAppIcon className=\"h-4 w-4 mr-2\" />\n                WhatsApp\n              </Button>\n              <Button id={`bid-chat-btn-mobile-${bid.id}`} onClick={handleChat} className=\"flex-1 h-10 bg-green-600 hover:bg-green-700 font-bold\">\n                <MessageSquare className=\"h-4 w-4 mr-2\" />\n                Chat\n              </Button>\n            </div>\n          ) : (\n            <Button id={`bid-unlock-btn-mobile-${bid.id}`} onClick={handleAccept} className=\"w-full h-10 bg-blue-600 hover:bg-blue-700 font-bold\">\n              <Check className=\"h-4 w-4 mr-2\" />\n              Accept & Chat\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {/* DESKTOP Layout */}\n      <div id={`bid-card-desktop-${bid.id}`} className=\"hidden md:flex flex-row items-center justify-between gap-4\">\n          <div id={`bid-card-desktop-left-${bid.id}`} className=\"flex items-center gap-4\">\n            <Avatar className=\"h-12 w-12 border-2 border-slate-50\">\n              <AvatarImage id={`bidder-avatar-img-desktop-${bid.id}`} src={bidder.avatar} />\n              <AvatarFallback id={`bidder-avatar-fallback-desktop-${bid.id}`}>{bidder.name[0]}</AvatarFallback>\n            </Avatar>\n            \n            <div id={`bidder-info-desktop-${bid.id}`}>\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <Link href={`/user/${bidder.id}`} id={`bidder-name-desktop-${bid.id}`} className=\"font-semibold text-[clamp(0.875rem,3cqi,1rem)] text-slate-700 truncate hover:text-blue-600 transition-colors\">{bidder.name}</Link>\n                  <div id={`bidder-rating-desktop-${bid.id}`} className=\"flex items-center gap-0.5 text-xs text-amber-500 font-bold\">\n                    <Star className=\"h-3 w-3 fill-amber-500\" />\n                    {bidder.rating}\n                  </div>\n                </div>\n                \n                 <div id={`bidder-stats-desktop-${bid.id}`} className=\"flex items-center gap-3 text-[11px] text-muted-foreground\">\n                   <div className=\"flex items-center gap-1\">\n                    <MapPin className=\"h-3 w-3 text-red-400\" />\n                    <span className=\"truncate max-w-[150px]\">{location}</span>\n                  </div>\n                  {!isOutside && (\n                    <DistanceBadge distance={distance} duration={duration} variant=\"inline\" className=\"bg-transparent p-0 text-muted-foreground\" iconClassName=\"h-3 w-3\" />\n                  )}\n                </div>\n            </div>\n          </div>\n\n          <div id={`bid-card-desktop-right-${bid.id}`} className=\"flex items-center gap-6\">\n              <div className=\"text-right\">\n                <span className=\"text-[10px] font-black uppercase tracking-widest text-slate-400 block mb-0.5\">Bid Amount</span>\n                <p id={`bid-amount-desktop-${bid.id}`} className=\"price-font font-black text-xl text-blue-600 leading-none\">Rs. {formatPrice(bid.amount)}</p>\n                {!isExpired && (bid.status === 'pending' || bid.status === 'shortlisted') && (\n                  <div className=\"mt-1.5 flex justify-end\">\n                    <TimerBadge expiryAt={expiresAt.toISOString()} variant=\"solid\" className=\"bg-transparent text-slate-400 p-0 shadow-none animate-none\" />\n                  </div>\n                )}\n                {isExpired && bid.status !== 'accepted' && (\n                  <div className=\"text-[10px] font-bold mt-1.5 text-right text-red-500 uppercase tracking-widest\">\n                    Expired\n                  </div>\n                )}\n              </div>\n\n              <div id={`bid-card-desktop-actions-${bid.id}`} className=\"flex items-center gap-2 border-l border-slate-200 pl-6 py-1\">\n                {bid.status === 'accepted' ? (\n                  <>\n                    <Button \n                      id={`bid-whatsapp-btn-desktop-${bid.id}`}\n                      variant=\"outline\" \n                      onClick={(e) => {\n                        e.stopPropagation();\n                        if (!bidder.phone && !bidder.whatsapp) return;\n                        window.open(getWhatsAppUrl(bidder.whatsapp || bidder.phone || \"\", waMessage), '_blank');\n                      }}\n                      disabled={!bidder.phone && !bidder.whatsapp}\n                      className={cn(\n                        \"h-9 px-4 font-bold transition-all\",\n                        (bidder.phone || bidder.whatsapp)\n                          ? \"bg-emerald-600 hover:bg-emerald-700 text-white\" \n                          : \"bg-slate-100 text-slate-400 grayscale cursor-not-allowed border border-slate-200 shadow-none\"\n                      )}\n                      size=\"sm\" \n                    >\n                      <WhatsAppIcon className=\"h-4 w-4 mr-1\" />\n                      WhatsApp\n                    </Button>\n                    <Button id={`bid-chat-btn-desktop-${bid.id}`} onClick={handleChat} size=\"sm\" className=\"h-9 px-4 bg-green-600 hover:bg-green-700 font-bold text-white\">\n                      <MessageSquare className=\"h-4 w-4 mr-1\" />\n                      Chat\n                    </Button>\n                  </>\n                ) : (\n                  <>\n                    <Button id={`bid-reject-btn-desktop-${bid.id}`} onClick={handleReject} variant=\"ghost\" size=\"sm\" className=\"h-9 w-9 p-0 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg\">\n                      <X className=\"h-5 w-5\" />\n                    </Button>\n                    <Button id={`bid-accept-btn-desktop-${bid.id}`} onClick={handleAccept} size=\"sm\" className=\"h-9 px-4 bg-blue-600 hover:bg-blue-700 font-bold text-white rounded-lg shadow-sm\">\n                      <Check className=\"h-4 w-4 mr-1\" />\n                      Accept\n                    </Button>\n                  </>\n                )}\n              </div>\n          </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\seller\\SellerListingCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\ContinueBrowsingModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\EmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\NewListingsToast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\SafeImage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\Skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\sonner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\toggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\AuthContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":214,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8478,8481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8478,8481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { createContext, useContext, useState, useEffect, useCallback } from \"react\";\nimport { User } from \"@/types\";\nimport { supabase } from \"@/lib/supabase\";\nimport type { User as SupabaseUser } from \"@supabase/supabase-js\";\nimport type { Database } from \"@/types/database.types\";\nimport { useRouter } from \"next/navigation\";\n\ninterface UserLocation {\n  lat: number;\n  lng: number;\n  city: string;\n  address: string;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  myLocation: UserLocation | null;\n  setMyLocation: (location: UserLocation) => void;\n  isLoggedIn: boolean;\n  isLoading: boolean;\n  isAdminMode: boolean;\n  toggleAdminMode: () => void;\n  login: (provider?: 'google' | 'facebook') => Promise<void>;\n  logout: () => Promise<void>;\n  getUser: (id: string) => User | undefined; // Keep for compat, though less useful with real auth\n  updateProfile: (data: Partial<User>) => Promise<void>;\n  isAuthModalOpen: boolean;\n  openAuthModal: () => void;\n  closeAuthModal: () => void;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [myLocation, setMyLocationState] = useState<UserLocation | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isAuthModalOpen, setIsAuthModalOpen] = useState(false);\n  const [isAdminMode, setIsAdminMode] = useState(false);\n  const router = useRouter();\n\n  // Load admin mode preference from localStorage\n  useEffect(() => {\n    try {\n      const saved = localStorage.getItem('boliyan_admin_mode');\n      if (saved === 'true') setIsAdminMode(true);\n    } catch { /* ignore */ }\n  }, []);\n\n  const toggleAdminMode = useCallback(() => {\n    setIsAdminMode(prev => {\n      const next = !prev;\n      try {\n        if (next) {\n          localStorage.setItem('boliyan_admin_mode', 'true');\n        } else {\n          localStorage.removeItem('boliyan_admin_mode');\n        }\n      } catch { /* ignore */ }\n      // Defer navigation to avoid setState-during-render error\n      setTimeout(() => {\n        router.push(next ? '/admin/reports' : '/');\n      }, 0);\n      return next;\n    });\n  }, [router]);\n\n  // Robust Auto-Locate Logic (moved from MarketplaceContext)\n  useEffect(() => {\n    let mounted = true;\n    const locationSetRef = { current: false };\n\n    const saveLocation = (lat: number, lng: number, city: string, isHighAccuracy: boolean = false) => {\n        if (!mounted) return;\n        \n        // Don't downgrade accuracy: If we already have high accuracy (GPS), don't let IP overwrite it\n        if (locationSetRef.current && !isHighAccuracy) return;\n        \n        const loc = { lat, lng, city, address: city }; // Simple address fallback for myLocation\n        setMyLocationState(loc);\n        locationSetRef.current = true;\n        \n        try {\n            localStorage.setItem('boliyan_user_location', JSON.stringify(loc));\n        } catch { /* ignore */ }\n    };\n\n    const fetchIpLocation = async () => {\n        if (locationSetRef.current) return;\n\n        const fetchWithTimeout = async (url: string, timeout = 8000) => {\n            const controller = new AbortController();\n            const id = setTimeout(() => controller.abort(), timeout);\n            try {\n                const response = await fetch(url, { signal: controller.signal });\n                clearTimeout(id);\n                return response;\n            } catch (err) {\n                clearTimeout(id);\n                throw err;\n            }\n        };\n\n        try {\n            const res = await fetchWithTimeout('https://ipapi.co/json/');\n            if (!res.ok) throw new Error('IP API failed');\n            const data = await res.json();\n            if (data.latitude && data.longitude && data.country_code === 'PK') {\n                if (!locationSetRef.current) {\n                    saveLocation(parseFloat(data.latitude), parseFloat(data.longitude), data.city || \"Unknown\", false);\n                }\n                return;\n            }\n        } catch {\n            try {\n                const res = await fetchWithTimeout('https://ipwho.is/');\n                const data = await res.json();\n                if (data.success && data.country_code === 'PK') {\n                    if (!locationSetRef.current) {\n                        saveLocation(parseFloat(data.latitude), parseFloat(data.longitude), data.city || \"Unknown\", false);\n                    }\n                }\n            } catch { /* ignore */ }\n        }\n    };\n\n    const initializeLocation = async () => {\n        try {\n            // 1. Try localStorage\n            const saved = localStorage.getItem('boliyan_user_location');\n            if (saved) {\n                const parsed = JSON.parse(saved);\n                if (parsed.city && parsed.lat && parsed.lng) {\n                    setMyLocationState(parsed);\n                    locationSetRef.current = true;\n                }\n            }\n\n            // 2. Race IP and GPS\n            fetchIpLocation();\n            if ('geolocation' in navigator) {\n                navigator.geolocation.getCurrentPosition(\n                    async (position) => {\n                        if (!mounted) return;\n                        const { latitude, longitude } = position.coords;\n                        try {\n                            const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&zoom=18&addressdetails=1`);\n                            const data = await res.json();\n                            const city = data.address?.city || data.address?.town || data.address?.village || data.address?.suburb || \"Current Location\";\n                            saveLocation(latitude, longitude, city, true);\n                        } catch {\n                            saveLocation(latitude, longitude, \"Current Location\", true);\n                        }\n                    },\n                    () => {},\n                    { timeout: 7000, maximumAge: 0 }\n                );\n            }\n        } catch { /* ignore */ }\n    };\n\n    initializeLocation();\n    return () => { mounted = false; };\n  }, []);\n\n  const setMyLocation = (loc: UserLocation) => {\n    setMyLocationState(loc);\n    try {\n        localStorage.setItem('boliyan_user_location', JSON.stringify(loc));\n    } catch { /* ignore */ }\n  };\n\n  // Fetch full profile data from Supabase 'profiles' table\n    type ProfileRow = Database['public']['Tables']['profiles']['Row'];\n    type ProfileInsert = Database['public']['Tables']['profiles']['Insert'];\n    type ProfileUpdate = Database['public']['Tables']['profiles']['Update'];\n    type ProfileExtras = { is_verified?: boolean; review_count?: number; rating?: number; rating_count?: number; phone?: string; whatsapp?: string; name?: string };\n\n    const fetchProfile = useCallback(async (supabaseUser: SupabaseUser) => {\n        console.log(\"[AuthContext] Fetching profile for:\", supabaseUser.id);\n        setIsLoading(true); // Ensure loading is true while fetching\n        try {\n            const { data: fetchedData, error } = await supabase\n                .from('profiles')\n                .select('*')\n                .eq('id', supabaseUser.id)\n                .single();\n\n            let data = fetchedData as ProfileRow | null;\n\n            console.log(\"[AuthContext] Profile fetch result:\", { hasData: !!data, error });\n\n      // Handle 'Row not found' (PGRST116) or null data\n      if (!data && (error?.code === 'PGRST116' || !error)) {\n          console.warn(\"Profile not found, attempting to create or use fallback...\");\n          const metadata = (supabaseUser.user_metadata || {}) as Record<string, string | undefined>;\n          \n          const fullName = metadata.full_name || \n                           metadata.name || \n                           (metadata.first_name ? `${metadata.first_name} ${metadata.last_name || ''}`.trim() : null) ||\n                           supabaseUser.email?.split('@')[0];\n\n          const newProfile: ProfileInsert = {\n              id: supabaseUser.id,\n              full_name: fullName,\n              avatar_url: metadata.avatar_url || metadata.picture,\n              location: metadata.city // Map city to location\n          };\n\n          // Attempt insertion\n          const { data: inserted, error: insertError } = await (supabase\n              .from('profiles') as any)\n              .insert([newProfile])\n              .select()\n              .single();\n\n          if (!insertError && inserted) {\n             data = inserted as ProfileRow;\n          } else {\n             // Fallback to ephemeral data so the app still works\n              console.error(\"Profile creation failed, using temporary data:\", insertError);\n              data = newProfile as ProfileRow;\n          }\n      } else if (error) {\n        console.error('Error fetching profile:', error);\n        return null; // Stop if genuine DB error\n      }\n\n        if (data) {\n          // Map Supabase profile to App User type\n          // Note: Some fields might need default values if not present in DB yet\n          const profile = data as ProfileRow & ProfileExtras;\n          const locationValue = profile.location;\n          const parsedLocation = typeof locationValue === 'string' && locationValue.trim().startsWith('{')\n            ? JSON.parse(locationValue)\n            : locationValue;\n          const appUser: User = {\n              id: profile.id,\n              name: profile.full_name || profile.name || supabaseUser.email?.split('@')[0] || 'User',\n              avatar: profile.avatar_url || `https://api.dicebear.com/7.x/avataaars/svg?seed=${profile.id}`,\n              isVerified: profile.is_verified || false,\n              // Default/Fallback values for fields not yet in DB schema or optional\n              phone: profile.phone || undefined,\n              whatsapp: profile.whatsapp || undefined,\n              rating: profile.rating || 0,\n              reviewCount: profile.review_count || profile.rating_count || 0,\n              location: parsedLocation\n                ? (typeof parsedLocation === 'string'\n                    ? { lat: 0, lng: 0, address: parsedLocation, city: parsedLocation }\n                    : parsedLocation)\n                : { lat: 24.8607, lng: 67.0011, address: \"Karachi, Pakistan\", city: \"Karachi\" },\n              badges: [], // TODO: Fetch badges from a relation if needed\n              stats: {\n                  bidsAcceptedByMe: 0,\n                  myBidsAccepted: 0\n              },\n              emailVerified: ['google', 'facebook'].includes(supabaseUser.app_metadata.provider || '') || !!supabaseUser.email_confirmed_at,\n              role: (profile.role as 'user' | 'admin') || 'user',\n          };\n\n          // Determine profile completeness - strictly check DB fields\n          appUser.profileComplete = !!profile.full_name && !!profile.phone && !!profile.location;\n\n          setUser(appUser);\n        }\n    } catch (err) {\n      console.error('Unexpected error fetching profile:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Use a ref to track the last processed user ID to avoid race conditions \n  // and stale closures in the onAuthStateChange listener.\n  const lastProcessedUserId = React.useRef<string | null>(null);\n\n  useEffect(() => {\n    // Consolidate auth initialization to a single listener.\n    // onAuthStateChange fires 'INITIAL_SESSION' immediately on mount, \n    // managing both initial load and subsequent updates.\n    \n    const {\n      data: { subscription },\n    } = supabase.auth.onAuthStateChange((_event, session) => {\n      console.log(\"[AuthContext] Auth state change:\", _event, session?.user?.id);\n\n      if (session?.user) {\n         // Check against Ref to strictly deduplicate fetches\n         if (session.user.id !== lastProcessedUserId.current) {\n            console.log(\"[AuthContext] New user detected, fetching profile...\");\n            lastProcessedUserId.current = session.user.id;\n            setIsLoading(true);\n            fetchProfile(session.user);\n         } else {\n            // Same user, no action needed unless we want to silent re-validate\n            console.log(\"[AuthContext] User already processed, skipping fetch\");\n         }\n      } else {\n        console.log(\"[AuthContext] No session user, clearing state\");\n        lastProcessedUserId.current = null;\n        setUser(null);\n        setIsLoading(false);\n      }\n    });\n\n    return () => subscription.unsubscribe();\n  }, [fetchProfile]);\n\n  const login = async (provider: 'google' | 'facebook' = 'google') => {\n    // Redirect to OAuth provider\n    const { error } = await supabase.auth.signInWithOAuth({\n      provider,\n      options: {\n        redirectTo: `${window.location.origin}/auth/callback`,\n      },\n    });\n    if (error) console.error(`${provider} login failed:`, error);\n  };\n\n  const logout = async () => {\n    await supabase.auth.signOut();\n    setUser(null);\n    router.push('/');\n  };\n\n  const getUser = (id: string) => {\n    // Compatibility stub: In real app, we can't sync fetch other users easily here.\n    // For now, return current user if ID matches, else undefined.\n    return user?.id === id ? user : undefined;\n  };\n\n  const updateProfile = async (data: Partial<User>) => {\n    if (!user) return;\n\n    const updates: ProfileUpdate = {};\n    if (data.name) updates.full_name = data.name;\n    if (data.avatar) updates.avatar_url = data.avatar;\n    if (data.phone) updates.phone = data.phone;\n    if (data.whatsapp !== undefined) updates.whatsapp = data.whatsapp;\n    if (data.location?.city) updates.location = data.location.city;\n\n    const { error } = await supabase\n      .from('profiles')\n      .update(updates)\n      .eq('id', user.id);\n\n    if (error) {\n      console.error('[AuthContext] Update failed:', error);\n      throw error;\n    }\n\n    // Update local state\n    setUser(prev => {\n      if (!prev) return null;\n      const updated = { ...prev, ...data };\n      // Recalculate completeness\n      updated.profileComplete = !!updated.name && !!updated.phone && !!updated.location;\n      return updated;\n    });\n  };\n\n  const openAuthModal = () => setIsAuthModalOpen(true);\n  const closeAuthModal = () => setIsAuthModalOpen(false);\n\n  return (\n    <AuthContext.Provider value={{ \n      user, \n      myLocation,\n      setMyLocation,\n      isLoggedIn: !!user, \n      isLoading,\n      isAdminMode: isAdminMode && user?.role === 'admin', // Only true if user is actually admin\n      toggleAdminMode,\n      login, \n      logout, \n      getUser,\n      updateProfile,\n      isAuthModalOpen,\n      openAuthModal,\n      closeAuthModal\n    }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\ChatContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\DashboardContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ListingWithBidCount' is defined but never used.","line":47,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2237,2240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2237,2240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\r\nimport { supabase } from '@/lib/supabase';\r\nimport { useApp } from '@/lib/store';\r\nimport { DashboardState, ManagedListing, SellerMetric } from '@/types/dashboard';\r\nimport type { Database } from '@/types/database.types';\r\n\r\ninterface DashboardContextType extends DashboardState {\r\n  refreshDashboard: () => Promise<void>;\r\n  updateListingStatus: (itemId: string, status: 'active' | 'completed' | 'cancelled') => Promise<void>;\r\n  deleteListing: (itemId: string) => Promise<void>;\r\n}\r\n\r\nconst DashboardContext = createContext<DashboardContextType | undefined>(undefined);\r\n\r\nexport function DashboardProvider({ children }: { children: React.ReactNode }) {\r\n  const { user } = useApp();\r\n  const [state, setState] = useState<DashboardState>({\r\n    metrics: [],\r\n    listings: [],\r\n    isLoading: true,\r\n    error: null,\r\n  });\r\n\r\n  const fetchDashboardData = useCallback(async () => {\r\n    if (!user) return;\r\n\r\n    setState(prev => ({ ...prev, isLoading: true, error: null }));\r\n\r\n    try {\r\n      // 1. Fetch Seller's Listings\r\n      const { data: listingsData, error: listingsError } = await supabase\r\n        .from('listings')\r\n        .select(`\r\n          *,\r\n          bids:bids(count)\r\n        `)\r\n        .eq('seller_id', user.id)\r\n        .order('created_at', { ascending: false });\r\n\r\n      if (listingsError) throw listingsError;\r\n\r\n      // Transform to ManagedListing\r\n      // Note: view_count might not exist yet in DB, defaulting to mock random for demo if missing\r\n      type ListingRow = Database['public']['Tables']['listings']['Row'];\r\n      type ListingWithBidCount = ListingRow & { bids?: { count: number }[]; view_count?: number | null };\r\n\r\n      const isValidCondition = (value: string | null | undefined): value is ManagedListing['condition'] =>\r\n        value === 'new' || value === 'like_new' || value === 'used' || value === 'fair';\r\n\r\n      const isValidStatus = (value: string | null | undefined): value is ManagedListing['status'] =>\r\n        value === 'active' || value === 'completed' || value === 'cancelled' || value === 'hidden';\r\n\r\n      const listings: ManagedListing[] = (listingsData as any[] || []).map((item) => ({\r\n        ...item,\r\n        // Manual mapping from Snake Case (DB) to Camel Case (App)\r\n        sellerId: item.seller_id || '',\r\n        askPrice: item.asked_price,\r\n        isPublicBid: item.auction_mode === 'visible',\r\n        createdAt: item.created_at || new Date().toISOString(),\r\n        category: item.category || 'Other',\r\n        listingDuration: 720, // Default to 30 days\r\n        expiryAt: new Date(Date.now() + 2592000000).toISOString(), // 30 day mock expiry\r\n        description: item.description || '', // Ensure string\r\n        condition: isValidCondition(item.condition) ? item.condition : 'used',\r\n        status: isValidStatus(item.status) ? item.status : 'active',\r\n        goLiveAt: item.go_live_at || undefined,\r\n        lastEditedAt: item.last_edited_at || undefined,\r\n        slug: item.slug ?? undefined,\r\n        \r\n        images: item.images || [], // Ensure array\r\n        seller: user, // user is seller\r\n        bidCount: item.bids?.[0]?.count || 0,\r\n        bidAttemptsCount: item.bids?.[0]?.count || 0,\r\n        views: item.view_count ?? Math.floor(Math.random() * 50) + 10, // Mock if missing\r\n        unreadBids: 0, // TODO: Implement unread logic with notifications\r\n        lastActivity: item.created_at || new Date().toISOString(), // separate activity field later?\r\n        \r\n        // Moderation fields for rejection badge\r\n        moderationStatus: (item as { moderation_status?: string }).moderation_status as ManagedListing['moderationStatus'],\r\n        rejectionReason: (item as { rejection_reason?: string }).rejection_reason || undefined,\r\n      }));\r\n\r\n      // 2. Calculate Metrics\r\n      const activeListings = listings.filter(l => l.status === 'active');\r\n      const soldListings = listings.filter(l => l.status === 'completed');\r\n      \r\n      const totalBids = listings.reduce((acc, curr) => acc + ((curr.bidAttemptsCount ?? curr.bidCount) || 0), 0);\r\n      \r\n      const successRate = user.sellerSuccessRate ?? 100;\r\n\r\n      const metrics: SellerMetric[] = [\r\n        { label: 'Success Rate', value: successRate, icon: 'ShieldCheck', color: successRate >= 90 ? 'text-emerald-500' : 'text-amber-500' },\r\n        { label: 'Active Listings', value: activeListings.length, icon: 'Package', color: 'text-blue-500' },\r\n        { label: 'Total Bids', value: totalBids, icon: 'Gavel', color: 'text-orange-500' },\r\n        { label: 'Items Sold', value: soldListings.length, icon: 'CheckCircle', color: 'text-green-500' },\r\n      ];\r\n\r\n      setState({\r\n        listings,\r\n        metrics,\r\n        isLoading: false,\r\n        error: null,\r\n      });\r\n\r\n    } catch (err: unknown) {\r\n      console.error('Error loading dashboard:', err);\r\n      const message = err instanceof Error ? err.message : 'Unknown error';\r\n      setState(prev => ({ ...prev, isLoading: false, error: message }));\r\n    }\r\n  }, [user]);\r\n\r\n  // Initial fetch\r\n  useEffect(() => {\r\n    if (user) {\r\n      fetchDashboardData();\r\n    }\r\n  }, [user, fetchDashboardData]);\r\n\r\n  const updateListingStatus = async (itemId: string, status: 'active' | 'completed' | 'cancelled') => {\r\n    try {\r\n      const { error } = await supabase.rpc('update_listing_fields', {\r\n        p_listing_id: itemId,\r\n        p_status: status,\r\n        p_title: null\r\n      });\r\n\r\n      if (error) throw error;\r\n      \r\n      // Optimistic update\r\n      setState(prev => ({\r\n        ...prev,\r\n        listings: prev.listings.map(l => l.id === itemId ? { ...l, status } : l)\r\n      }));\r\n      \r\n      // Refresh to confirm and update metrics\r\n      fetchDashboardData();\r\n\r\n    } catch (error: unknown) {\r\n      console.error('Failed to update status:', error);\r\n      // Revert or show toast (for now just log)\r\n    }\r\n  };\r\n\r\n  const deleteListing = async (itemId: string) => {\r\n     // Soft delete as cancelled\r\n     await updateListingStatus(itemId, 'cancelled');\r\n  };\r\n\r\n\r\n  return (\r\n    <DashboardContext.Provider value={{ \r\n      ...state, \r\n      refreshDashboard: fetchDashboardData,\r\n      updateListingStatus,\r\n      deleteListing\r\n    }}>\r\n      {children}\r\n    </DashboardContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useDashboard() {\r\n  const context = useContext(DashboardContext);\r\n  if (context === undefined) {\r\n    throw new Error('useDashboard must be used within a DashboardProvider');\r\n  }\r\n  return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\MarketplaceContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\NotificationContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NotificationRow' is defined but never used.","line":127,"column":6,"nodeType":null,"messageId":"unusedVar","endLine":127,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3990,3993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3990,3993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { createContext, useContext, useEffect, useState, useCallback, ReactNode } from 'react';\r\nimport { toast } from 'sonner';\r\nimport type { Notification } from '@/types/notification';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { resolveNotificationLink } from '@/lib/notifications';\r\nimport { supabase } from '@/lib/supabase';\r\nimport type { Database } from '@/types/database.types';\r\n\r\ninterface NotificationContextType {\r\n  notifications: Notification[];\r\n  unreadCount: number;\r\n  isLoading: boolean;\r\n  markAsRead: (id: string) => Promise<void>;\r\n  markAllAsRead: () => Promise<void>;\r\n  refreshNotifications: () => Promise<void>;\r\n}\r\n\r\nconst NotificationContext = createContext<NotificationContextType | undefined>(undefined);\r\nconst NOTIFICATION_POOL_LIMIT = 15;\r\n\r\nexport function NotificationProvider({ children }: { children: ReactNode }) {\r\n  const { user } = useAuth();\r\n  const [notifications, setNotifications] = useState<Notification[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n//   const supabase = createClient();\r\n\r\n  // Fetch notifications\r\n  const refreshNotifications = useCallback(async () => {\r\n    if (!user?.id) {\r\n      setNotifications([]);\r\n      setIsLoading(false);\r\n      return;\r\n    }\r\n\r\n    const { data, error } = await supabase\r\n      .from('notifications')\r\n      .select('*')\r\n      .eq('user_id', user.id)\r\n      .order('created_at', { ascending: false })\r\n      .limit(NOTIFICATION_POOL_LIMIT);\r\n\r\n    if (!error && data) {\r\n      setNotifications(data.map(transformNotification));\r\n    }\r\n    setIsLoading(false);\r\n  }, [user]);\r\n\r\n  // Real-time subscription\r\n  useEffect(() => {\r\n    if (!user?.id) return;\r\n\r\n    const timer = setTimeout(() => {\r\n      refreshNotifications();\r\n    }, 0);\r\n\r\n    const channel = supabase\r\n      .channel('notifications')\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: 'INSERT',\r\n          schema: 'public',\r\n          table: 'notifications',\r\n          filter: `user_id=eq.${user.id}`,\r\n        },\r\n        (payload) => {\r\n          const newNotification = transformNotification(payload.new as Record<string, unknown>);\r\n          setNotifications((prev) => [newNotification, ...prev].slice(0, NOTIFICATION_POOL_LIMIT));\r\n\r\n          const resolvedLink = resolveNotificationLink(newNotification);\r\n          toast(newNotification.title, {\r\n            description: newNotification.body,\r\n            action: resolvedLink ? {\r\n              label: 'View',\r\n              onClick: () => window.location.href = resolvedLink\r\n            } : undefined,\r\n          });\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      clearTimeout(timer);\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [user, refreshNotifications]);\r\n\r\n  const markAsRead = async (id: string) => {\r\n    await supabase\r\n      .from('notifications')\r\n      .update({ is_read: true })\r\n      .eq('id', id);\r\n    setNotifications((prev) =>\r\n      prev.map((n) => (n.id === id ? { ...n, isRead: true } : n))\r\n    );\r\n  };\r\n\r\n  const markAllAsRead = async () => {\r\n    if (!user) return;\r\n    await supabase\r\n      .from('notifications')\r\n      .update({ is_read: true })\r\n      .eq('user_id', user.id);\r\n    setNotifications((prev) => prev.map((n) => ({ ...n, isRead: true })));\r\n  };\r\n\r\n  const unreadCount = notifications.filter((n) => !n.isRead).length;\r\n\r\n  return (\r\n    <NotificationContext.Provider\r\n      value={{ notifications, unreadCount, isLoading, markAsRead, markAllAsRead, refreshNotifications }}\r\n    >\r\n      {children}\r\n    </NotificationContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useNotifications() {\r\n  const context = useContext(NotificationContext);\r\n  if (!context) throw new Error('useNotifications must be used within NotificationProvider');\r\n  return context;\r\n}\r\n\r\n// Transform DB snake_case to camelCase\r\ntype NotificationRow = Database['public']['Tables']['notifications']['Row'];\r\n\r\nfunction transformNotification(row: any): Notification {\r\n  return {\r\n    id: row.id as string,\r\n    userId: row.user_id as string,\r\n    type: row.type as Notification['type'],\r\n    title: row.title as string,\r\n    body: row.body as string | undefined,\r\n    link: row.link as string | undefined,\r\n    isRead: !!row.is_read,\r\n    metadata: (row.metadata as Notification['metadata']) || {},\r\n    createdAt: row.created_at as string,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\ReviewContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\SearchContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\TimeContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\context\\ViewportContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useBidRealtime.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useBidding.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useIntersectionObserver.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useListingsPolling.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useReducedMotion.ts","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useReducedMotion.ts:16:5\n  14 |     const mediaQuery = window.matchMedia(\"(prefers-reduced-motion: reduce)\");\n  15 |     // eslint-disable-next-line react-hooks/set-state-in-effect\n> 16 |     setPrefersReducedMotion(mediaQuery.matches);\n     |     ^^^^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  17 |\n  18 |     const handleChange = (event: MediaQueryListEvent) => {\n  19 |       setPrefersReducedMotion(event.matches);","line":16,"column":5,"nodeType":null,"endLine":16,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\hooks\\useTrackVisibility.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\bidding.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\cache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\cardSizes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\constants\\locations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\depreciation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\locations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\notifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\processListingImage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\profileScore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\realtime-dom.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\searchUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\sonic.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\store-helpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\store.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\supabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\transform.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\uploadImage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\proxy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\bidding.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\dashboard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\database.types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\heic2any.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\notification.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\VSCode\\Boliyan\\apps\\web\\src\\types\\review.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
ESLint found too many warnings (maximum: 0).
